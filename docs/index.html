<!DOCTYPE html>
<html lang="nl">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-CBK65KDJHX');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handreiking</title>
    <style>
        :root {
            /* Light mode - 90s inspired earth tones */
            --bg-primary: #f5f0e8;
            --bg-secondary: #e8e0d0;
            --bg-tertiary: #d8cfc0;
            --text-primary: #2c2416;
            --text-secondary: #4a3f30;
            --text-muted: #6b5d4d;
            --accent: #8b4513;
            --accent-light: #cd853f;
            --border-light: #c0b8a8;
            --border-dark: #887868;
            --shadow-light: #ffffff;
            --shadow-dark: #a09080;
            --link: #5d4037;
            --success: #2e7d32;
            --warning: #f57c00;
            --header-bg: linear-gradient(180deg, #d4c4b0 0%, #c8b8a0 50%, #bca890 100%);
            --menu-bg: #ebe3d8;
            --card-bg: #faf8f5;
            --bevel-light: #ffffff;
            --bevel-dark: #9a8a7a;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1814;
            --bg-secondary: #252118;
            --bg-tertiary: #302a20;
            --text-primary: #e8e0d0;
            --text-secondary: #c8c0b0;
            --text-muted: #9a9080;
            --accent: #cd853f;
            --accent-light: #daa06d;
            --border-light: #3a342a;
            --border-dark: #4a443a;
            --shadow-light: #302a20;
            --shadow-dark: #0a0806;
            --link: #daa06d;
            --success: #66bb6a;
            --warning: #ffb74d;
            --header-bg: linear-gradient(180deg, #302a20 0%, #282218 50%, #201a10 100%);
            --menu-bg: #222018;
            --card-bg: #2a2418;
            --bevel-light: #3a342a;
            --bevel-dark: #0a0806;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Classic 90s beveled frame effect */
        .bevel-raised {
            border: 2px solid;
            border-color: var(--bevel-light) var(--bevel-dark) var(--bevel-dark) var(--bevel-light);
            box-shadow:
                inset 1px 1px 0 var(--shadow-light),
                inset -1px -1px 0 var(--shadow-dark);
        }

        .bevel-inset {
            border: 2px solid;
            border-color: var(--bevel-dark) var(--bevel-light) var(--bevel-light) var(--bevel-dark);
            box-shadow:
                inset 1px 1px 3px var(--shadow-dark),
                inset -1px -1px 0 var(--shadow-light);
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: var(--header-bg);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease;
            border-bottom: 3px solid;
            border-color: var(--bevel-dark);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        header.hidden {
            transform: translateY(-100%);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            display: none;
            background: var(--bg-secondary);
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 20px;
        }

        .logo {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 1px 1px 0 var(--shadow-light);
            letter-spacing: 1px;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #file-selector {
             background: var(--bg-secondary);
             color: var(--text-primary);
             border: none;
             padding: 8px 16px;
             cursor: pointer;
             font-family: inherit;
             font-size: 0.95em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 65px;
            left: 0;
            width: 280px;
            height: calc(100vh - 65px);
            background: var(--menu-bg);
            overflow-y: auto;
            padding: 15px 0 60px 0;
            transition: transform 0.3s ease;
            z-index: 900;
            border-right: 2px solid var(--border-dark);
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 10px 20px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
        }

        .nav-item {
            display: block;
            padding: 10px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            font-size: 0.9em;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-left-color: var(--accent-light);
        }

        .nav-item.active {
            background: var(--bg-secondary);
            color: var(--accent);
            border-left-color: var(--accent);
            font-weight: bold;
        }

        .nav-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            text-align: center;
            line-height: 24px;
            margin-right: 8px;
            font-size: 0.8em;
            font-weight: bold;
        }

        /* Groep kleuren - Liturgisch/Kerkelijk (01, Bijbelteksten) */
        .nav-group-liturgisch .nav-number {
            background: #d4af37;
            color: #f5f0e8;
        }

        /* Groep kleuren - Contextueel (02-07) */
        .nav-group-contextueel .nav-number {
            background: #7a9b6f;
            color: #f5f0e8;
        }

        /* Groep kleuren - Exegese (08a, 08c) */
        .nav-group-exegese .nav-number {
            background: #6b8ba8;
            color: #f5f0e8;
        }

        /* Groep kleuren - Homiletiek (12a-13d) */
        .nav-group-homiletiek .nav-number {
            background: #9b7a9e;
            color: #f5f0e8;
        }

        /* Groep kleuren - Gebeden (14a-14d) */
        .nav-group-gebeden .nav-number {
            background: #c67a7a;
            color: #f5f0e8;
        }

        /* Groep kleuren - Liturgische Elementen (15a-15e) */
        .nav-group-liturgische-elementen .nav-number {
            background: #c88f5f;
            color: #f5f0e8;
        }

        /* Groep kleuren - Preekschetsen (16-19) */
        .nav-group-preekschetsen .nav-number {
            background: #8b6f47;
            color: #f5f0e8;
        }

        /* Groep headers in menu */
        .nav-group-header {
            padding: 8px 20px 4px 20px;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            opacity: 0.6;
            font-weight: 600;
            margin-top: 12px;
        }
        .nav-group-header:first-child {
            margin-top: 0;
        }

        .nav-toggle {
            float: right;
            font-size: 0.7em;
            transition: transform 0.2s;
        }

        .nav-item.expanded .nav-toggle {
            transform: rotate(90deg);
        }

        .nav-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: var(--bg-primary);
        }

        .nav-submenu.open {
            max-height: 1000px;
        }

        .nav-subitem {
            display: block;
            padding: 6px 20px 6px 52px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8em;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-subitem:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-left-color: var(--accent-light);
        }

        .nav-subitem.active {
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .subsection-anchor {
            scroll-margin-top: 80px;
        }

        /* Main content */
        main {
            margin-left: 280px;
            margin-top: 65px;
            padding: 30px;
            min-height: calc(100vh - 65px);
            transition: margin 0.3s ease;
        }

        main.full-width {
            margin-left: 0;
        }

        /* Content wrapper for max-width */
        .content-wrapper {
            max-width: none;
        }

        /* Section layout with info panel */
        .section-layout {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 30px;
            align-items: flex-start;
        }

        .section-main-content {
            flex: 1 1 auto;
            min-width: 0;
        }

        .section-info-panel {
            flex: 0 0 450px;
            width: 450px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
            position: sticky;
            top: 85px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            opacity: 0.65;
        }

        .section-info-title {
            font-weight: bold;
            font-size: 0.9em;
            color: var(--accent);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-info-text {
            font-size: 0.9em;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        @media (max-width: 1100px) {
            .section-info-panel {
                flex: 0 0 260px;
                width: 260px;
            }
        }

        @media (max-width: 900px) {
            .section-layout {
                flex-direction: column;
            }

            .section-info-panel {
                flex: none;
                width: 100%;
                position: static;
                max-height: none;
            }
        }

        /* Welcome screen */
        .welcome {
            text-align: center;
            padding: 80px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome h1 {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .welcome p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .welcome-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        /* Content sections */
        .section {
            background: var(--card-bg);
            margin-bottom: 30px;
            padding: 25px;
            scroll-margin-top: 80px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .section-number {
            width: 40px;
            height: 40px;
            background: var(--accent);
            color: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Section number kleuren - Liturgisch/Kerkelijk */
        .section-group-liturgisch .section-number {
            background: #d4af37;
            color: #f5f0e8;
        }

        /* Section number kleuren - Contextueel */
        .section-group-contextueel .section-number {
            background: #7a9b6f;
            color: #f5f0e8;
        }

        /* Section number kleuren - Exegese */
        .section-group-exegese .section-number {
            background: #6b8ba8;
            color: #f5f0e8;
        }

        /* Section number kleuren - Homiletiek */
        .section-group-homiletiek .section-number {
            background: #9b7a9e;
            color: #f5f0e8;
        }

        /* Section number kleuren - Gebeden */
        .section-group-gebeden .section-number {
            background: #c67a7a;
            color: #f5f0e8;
        }

        /* Section number kleuren - Liturgische Elementen */
        .section-group-liturgische-elementen .section-number {
            background: #c88f5f;
            color: #f5f0e8;
        }

        /* Section number kleuren - Preekschetsen */
        .section-group-preekschetsen .section-number {
            background: #8b6f47;
            color: #f5f0e8;
        }

        .section-title {
            font-size: 1.4em;
            color: var(--text-primary);
        }

        .section-meta {
            font-size: 0.85em;
            color: var(--text-muted);
            margin-left: auto;
        }

        /* Data display */
        .data-group {
            margin-bottom: 25px;
        }

        .data-group-title {
            font-size: 1.1em;
            color: var(--accent);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px dashed var(--border-light);
        }

        .data-item {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .data-item:nth-child(odd) {
            background: var(--bg-tertiary);
        }

        .data-label {
            font-weight: bold;
            color: var(--text-secondary);
            min-width: 220px;
            flex-shrink: 0;
        }

        .data-value {
            color: var(--text-primary);
            flex: 1;
        }

        .data-value a {
            color: var(--link);
        }

        /* Nested objects */
        .nested-object {
            background: var(--bg-primary);
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid var(--accent-light);
        }

        .nested-title {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
        }

        /* Arrays */
        .array-list {
            list-style: none;
            padding: 0;
        }

        .array-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-light);
        }

        .array-item:nth-child(odd) {
            background: var(--bg-tertiary);
        }

        /* Tags */
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: var(--accent);
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
        }

        /* Lied items */
        .lied-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
            margin: 10px 0;
        }

        .lied-item {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-left: 4px solid var(--accent);
        }

        .lied-nummer {
            font-weight: bold;
            color: var(--accent);
            font-size: 1em;
        }
        .lied-info-icon {
            color: var(--accent-light);
            text-decoration: none;
            font-size: 0.85em;
            margin-left: 4px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        .lied-info-icon:hover {
            opacity: 1;
            color: var(--accent);
        }

        .lied-titel {
            font-style: italic;
            margin: 3px 0;
            font-size: 0.95em;
        }

        .lied-regel {
            color: var(--text-muted);
            font-size: 0.85em;
        }

        .lied-toelichting {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px dashed var(--border-light);
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 15px;
            right: 40px;
            width: 30px;
            height: 30px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-top.visible {
            opacity: 0.9;
            visibility: visible;
        }

        .scroll-top:hover {
            opacity: 1;
            background: var(--accent-light);
        }

        /* File input hidden */
        #file-input {
            display: none;
        }

        /* Meta info box */
        .meta-box {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .meta-box h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .meta-box .gemeente {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .meta-box .datum {
            font-size: 1.4em;
            margin: 10px 0;
        }

        .meta-box .adres {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .meta-box a {
            color: white;
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.visible {
                transform: translateX(0);
            }

            main {
                margin-left: 0;
            }

            .data-item {
                flex-direction: column;
            }

            .data-label {
                min-width: auto;
                margin-bottom: 4px;
            }
        }

        @media (max-width: 600px) {
            header {
                padding: 10px 15px;
            }

            .logo {
                font-size: 1.1em;
            }

            .load-btn span {
                display: none;
            }

            main {
                padding: 15px;
            }

            .section {
                padding: 15px;
            }

            .section-header {
                flex-wrap: wrap;
            }

            .section-meta {
                width: 100%;
                margin-left: 0;
                margin-top: 10px;
            }
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-muted);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid var(--border-light);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-toggle::after {
            content: 'â˜€ï¸';
            position: absolute;
            left: 3px;
            top: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        [data-theme="dark"] .theme-toggle::after {
            content: 'ðŸŒ™';
            left: 27px;
        }

        /* Quote blocks */
        .quote-block {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent);
            padding: 15px 20px;
            margin: 15px 0;
            font-style: italic;
        }

        /* Grid layout for cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .card-grid-narrow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        /* Compact nested card */
        .nested-card {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-left: 3px solid var(--accent-light);
        }

        .nested-card-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 0.95em;
            margin-bottom: 6px;
        }

        .nested-card-content {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        /* Inline data pairs */
        .data-pairs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .data-pair {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: 4px;
        }

        .data-pair-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-pair-value {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Table-like display for lezingen */
        .lezing-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 4px solid var(--accent);
            display: flex;
            flex-direction: column;
        }

        .lezing-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .lezing-ref {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--accent);
        }

        .lezing-thema {
            margin-top: 8px;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.95em;
            flex-grow: 1;
        }

        /* Hoorder cards */
        .hoorder-card {
            background: var(--bg-secondary);
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid var(--border-light);
        }

        .hoorder-naam {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .hoorder-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .hoorder-detail {
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        /* Gebed blocks */
        .gebed-block {
            background: var(--bg-secondary);
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
            font-style: italic;
            line-height: 1.8;
        }

        .gebed-titel {
            font-weight: bold;
            font-style: normal;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* Stage directions / instructions */
        .instruction {
            font-style: italic;
            color: var(--text-muted);
        }

        /* Search terms */
        .search-term {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--link);
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 5px;
        }

        /* Focus en functie cards */
        .focus-card {
            background: var(--bg-secondary);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid var(--accent);
        }

        .focus-card-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .focus-card-number {
            width: 36px;
            height: 36px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        .focus-card-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .focus-card-type {
            display: inline-block;
            padding: 2px 10px;
            background: var(--accent-light);
            color: white;
            border-radius: 12px;
            font-size: 0.75em;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .focus-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        /* More compact layout for kindermoment */
        .focus-card .focus-sections {
            grid-template-columns: repeat(2, 1fr);
        }

        @media (max-width: 900px) {
            .focus-sections {
                grid-template-columns: 1fr;
            }
        }

        .focus-section {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 4px;
        }

        .focus-section-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .focus-section-content {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .focus-toelichting {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-light);
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        /* Bijbelteksten */
        .bijbel-perikoop {
            background: var(--bg-secondary);
            padding: 20px 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
        }

        .bijbel-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .bijbel-boek-badge {
            background: var(--accent);
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        .bijbel-referentie {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .bijbel-verzen {
            line-height: 1.9;
            font-size: 1.05em;
        }

        .bijbel-vers {
            margin-bottom: 8px;
            text-align: justify;
            hyphens: auto;
        }

        .bijbel-vers-nummer {
            display: inline-block;
            font-size: 0.7em;
            font-weight: bold;
            color: var(--accent);
            vertical-align: super;
            margin-right: 3px;
            min-width: 1.5em;
        }

        .bijbel-vers-tekst {
            color: var(--text-primary);
        }

        /* Grondtekst styling (Hebreeuws/Grieks) */
        .bijbel-perikoop[data-language="Hebreeuws"] .bijbel-verzen {
            direction: rtl;
            text-align: right;
            font-family: 'SBL Hebrew', 'Ezra SIL', 'Times New Roman', serif;
            font-size: 1.2em;
            line-height: 2.2;
        }

        .bijbel-perikoop[data-language="Hebreeuws"] .bijbel-vers-nummer {
            direction: ltr;
            margin-left: 8px;
            margin-right: 0;
        }

        .bijbel-perikoop[data-language="Grieks"] .bijbel-verzen {
            font-family: 'SBL Greek', 'Gentium Plus', 'Times New Roman', serif;
            font-size: 1.1em;
            line-height: 2.0;
        }

        .bijbel-grondtekst-badge {
            background: #5d4037;
        }

        .bijbel-language-tag {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-left: 10px;
            font-style: italic;
        }

        .bijbel-lezing-type {
            margin-left: auto;
            font-size: 0.85em;
            font-style: italic;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 4px;
        }

        /* Gebeden styling */
        .gebed-card {
            background: var(--bg-secondary);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
        }

        .gebed-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .gebed-type-badge {
            background: var(--accent);
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .gebed-aanspraak {
            font-size: 1.2em;
            font-weight: bold;
            font-style: italic;
            color: var(--text-primary);
        }

        .gebed-tekst {
            font-size: 1.05em;
            line-height: 1.9;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .gebed-tekst p {
            margin-bottom: 12px;
        }

        .gebed-echo {
            margin-top: 15px;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-light);
            font-size: 0.9em;
            font-style: italic;
            color: var(--text-muted);
        }

        .gebed-echo-label {
            font-weight: bold;
            font-style: normal;
            color: var(--accent);
            margin-right: 8px;
        }

        .gebed-intenties {
            margin: 15px 0;
        }

        .gebed-intentie {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-light);
        }

        .gebed-intentie-voor {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .gebed-intentie-tekst {
            color: var(--text-secondary);
            font-style: italic;
        }

        .gebed-cirkels {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }

        .gebed-cirkel {
            padding: 15px;
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent);
        }

        .gebed-cirkel-header {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .gebed-cirkel-themas {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .gebed-cirkel-thema {
            background: var(--bg-secondary);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .gebed-cirkel-tekst {
            font-style: italic;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .gebed-instructie {
            font-style: italic;
            color: var(--text-muted);
            margin: 15px 0;
            text-align: center;
        }

        .gebed-onze-vader {
            background: var(--bg-tertiary);
            padding: 20px;
            margin-top: 15px;
            font-style: italic;
            line-height: 1.8;
            text-align: center;
            border: 1px solid var(--border-light);
        }

        .gebeden-meta {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-light);
        }

        .gebeden-meta-title {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .gebeden-technieken {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .gebeden-techniek {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 3px solid var(--accent-light);
        }

        .gebeden-techniek-naam {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .gebeden-techniek-items {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .gebeden-techniek-items li {
            margin-bottom: 4px;
        }

        /* Representatieve Hoorders */
        .hoorder-card {
            background: var(--bg-secondary);
            margin-bottom: 30px;
            border-left: 5px solid var(--accent);
            overflow: hidden;
        }

        .hoorder-header {
            background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 70%, black 30%));
            color: white;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .hoorder-nummer {
            background: rgba(255,255,255,0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .hoorder-intro {
            flex: 1;
        }

        .hoorder-naam {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
            color: inherit;
        }

        .hoorder-meta {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .hoorder-kernschets {
            padding: 20px 25px;
            background: var(--bg-tertiary);
            font-style: italic;
            font-size: 1.05em;
            line-height: 1.7;
            border-bottom: 1px solid var(--border-light);
        }

        .hoorder-content {
            padding: 20px 25px;
        }

        .hoorder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .hoorder-groep {
            background: var(--bg-tertiary);
            padding: 15px;
            border-left: 3px solid var(--accent-light);
        }

        .hoorder-groep-titel {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hoorder-item {
            margin-bottom: 8px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .hoorder-item-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .hoorder-item-value {
            color: var(--text-primary);
        }

        .hoorder-lijst {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .hoorder-lijst li {
            padding: 4px 0;
            padding-left: 15px;
            position: relative;
        }

        .hoorder-lijst li::before {
            content: "â€¢";
            color: var(--accent);
            position: absolute;
            left: 0;
        }

        .hoorder-schrift {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
        }

        .hoorder-schrift-titel {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1em;
        }

        .hoorder-schrift-item {
            margin-bottom: 12px;
        }

        .hoorder-schrift-label {
            font-weight: 600;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 3px;
        }

        .hoorder-schrift-tekst {
            font-style: italic;
            line-height: 1.6;
        }

        .hoorder-vraag {
            margin-top: 15px;
            padding: 15px;
            background: var(--accent);
            color: white;
            font-style: italic;
            text-align: center;
            font-size: 1.05em;
        }

        /* Motivaction cards */
        .motivaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .motivaction-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 4px solid var(--accent);
        }

        .motivaction-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .motivaction-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.05em;
        }

        .motivaction-percentage {
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .motivaction-kenmerken {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .motivaction-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 10px;
            margin-bottom: 4px;
        }

        .motivaction-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .motivaction-tag {
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Homiletische Plot */
        .plot-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .plot-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-left: 5px solid var(--accent);
            position: relative;
        }

        .plot-card:nth-child(1) { border-left-color: #e57373; }
        .plot-card:nth-child(2) { border-left-color: #ffb74d; }
        .plot-card:nth-child(3) { border-left-color: #fff176; }
        .plot-card:nth-child(4) { border-left-color: #81c784; }
        .plot-card:nth-child(5) { border-left-color: #64b5f6; }

        .plot-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .plot-badge {
            min-width: 50px;
            height: 50px;
            padding: 0 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            flex-shrink: 0;
        }

        .plot-card:nth-child(1) .plot-badge { background: #e57373; }
        .plot-card:nth-child(2) .plot-badge { background: #ffb74d; }
        .plot-card:nth-child(3) .plot-badge { background: #fff176; color: var(--text-primary); }
        .plot-card:nth-child(4) .plot-badge { background: #81c784; }
        .plot-card:nth-child(5) .plot-badge { background: #64b5f6; }

        .plot-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .plot-doel {
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.9em;
            margin-top: 4px;
        }

        .plot-content {
            font-size: 0.95em;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .plot-content > div {
            margin-bottom: 10px;
        }

        .plot-content strong {
            color: var(--text-primary);
        }

        /* Buttrick Moves & Structures */
        .buttrick-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .buttrick-intro,
        .buttrick-conclusie {
            background: var(--bg-secondary);
            padding: 20px;
            border-left: 5px solid var(--accent);
        }

        .buttrick-intro-header,
        .buttrick-conclusie-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .buttrick-intro-badge,
        .buttrick-conclusie-badge {
            min-width: 50px;
            height: 50px;
            padding: 0 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            color: white;
            flex-shrink: 0;
            background: var(--accent);
        }

        .buttrick-intro-title,
        .buttrick-conclusie-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .buttrick-intro-subtitle,
        .buttrick-conclusie-subtitle {
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .buttrick-text {
            line-height: 1.8;
            color: var(--text-primary);
            font-size: 1.02em;
        }

        .buttrick-move {
            background: var(--bg-secondary);
            padding: 20px;
            border-left: 5px solid var(--accent);
            position: relative;
        }

        /* Move kleuren - warm/koud spectrum */
        .buttrick-move:nth-child(1) { border-left-color: #7986cb; }
        .buttrick-move:nth-child(2) { border-left-color: #4db6ac; }
        .buttrick-move:nth-child(3) { border-left-color: #aed581; }
        .buttrick-move:nth-child(4) { border-left-color: #ffb74d; }
        .buttrick-move:nth-child(5) { border-left-color: #ff8a65; }
        .buttrick-move:nth-child(6) { border-left-color: #f06292; }

        .buttrick-move-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .buttrick-move-badge {
            min-width: 50px;
            height: 50px;
            padding: 0 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            flex-shrink: 0;
        }

        .buttrick-move:nth-child(1) .buttrick-move-badge { background: #7986cb; }
        .buttrick-move:nth-child(2) .buttrick-move-badge { background: #4db6ac; }
        .buttrick-move:nth-child(3) .buttrick-move-badge { background: #689f38; }
        .buttrick-move:nth-child(4) .buttrick-move-badge { background: #f57c00; }
        .buttrick-move:nth-child(5) .buttrick-move-badge { background: #ff8a65; }
        .buttrick-move:nth-child(6) .buttrick-move-badge { background: #f06292; }

        .buttrick-move-info {
            flex: 1;
        }

        .buttrick-move-kernidee {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .buttrick-move-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .buttrick-move-tag {
            display: inline-block;
            padding: 3px 10px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .buttrick-move-tag.strategy {
            background: var(--accent);
            color: white;
        }

        .buttrick-move-content {
            margin-top: 15px;
        }

        .buttrick-move-section {
            margin-bottom: 15px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .buttrick-move-section-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .buttrick-move-section-text {
            line-height: 1.7;
            color: var(--text-primary);
        }

        .buttrick-perspectief {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .buttrick-perspectief-item {
            background: var(--bg-tertiary);
            padding: 8px;
            border-radius: 4px;
        }

        .buttrick-perspectief-label {
            font-size: 0.7em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .buttrick-perspectief-value {
            font-size: 0.85em;
            color: var(--text-primary);
        }

        .buttrick-verbinding {
            margin-top: 12px;
            padding: 10px;
            background: var(--bg-primary);
            border-left: 3px solid var(--accent-light);
            font-size: 0.9em;
            font-style: italic;
            color: var(--text-muted);
        }

        .buttrick-beelden {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .buttrick-beeld-tag {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }

        /* Preekschetsen (SÃ¶lle/JÃ¼ngel) */
        .preek-card {
            background: var(--bg-secondary);
            padding: 30px;
            border-left: 5px solid var(--accent);
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .preek-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-light);
        }

        .preek-titel {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .preek-schrift {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .preek-kerntekst {
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-weight: 500;
            color: var(--text-primary);
            font-style: italic;
        }

        .preek-intro {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-primary);
        }

        .preek-onderdeel {
            margin-bottom: 30px;
        }

        .preek-onderdeel-titel {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--border-light);
        }

        .preek-tekst {
            font-size: 1.05em;
            line-height: 1.8;
            color: var(--text-primary);
            white-space: pre-wrap; /* Behoudt enters */
        }

        .preek-gebed {
            background: var(--bg-tertiary);
            padding: 25px;
            border-left: 4px solid var(--accent-light);
            font-style: italic;
            margin-top: 40px;
        }

        .preek-gebed-titel {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            font-style: normal;
        }

        .preek-meta {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
            font-size: 0.9em;
            color: var(--text-muted);
        }

        /* Kalender */
        .kalender-dag {
            background: var(--bg-secondary);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .kalender-dag.preekzondag {
            border-left-color: var(--success);
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.1) 0%, var(--bg-secondary) 100%);
        }

        .kalender-datum {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .kalender-dag.preekzondag .kalender-datum {
            color: var(--success);
        }

        .kalender-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .kalender-item {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 4px;
        }

        .kalender-item-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .kalender-item-content {
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .kalender-item-content ul {
            margin: 0;
            padding-left: 16px;
        }

        .kalender-item-content li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <header id="header">
        <div class="header-left">
            <button class="menu-toggle bevel-raised" id="menu-toggle">â˜°</button>
            <div class="logo">Handreiking</div>
        </div>
        <div class="header-center">
             <select id="file-selector" class="bevel-raised"></select>
             <input type="file" id="file-input" accept=".json" style="display: none;">
             <button id="load-custom-btn" class="icon-btn bevel-raised" title="Laad aangepast bestand">ðŸ“</button>
        </div>
        <div class="header-right">
            <div class="theme-toggle" id="theme-toggle" title="Donkere modus"></div>
            <a href="https://github.com/wmotte/voorbereiding" target="_blank" class="icon-btn bevel-raised" title="GitHub">i</a>
        </div>
    </header>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">Secties</div>
        <div id="nav-items">
            <!-- Nav items will be inserted here -->
        </div>
    </nav>

    <main id="main-content">
        <div class="welcome">
            <div class="welcome-icon">ðŸ“–</div>
            <h1>Welkom</h1>
            <p>Kies een analyse uit het menu hierboven om te beginnen.</p>
        </div>
    </main>

    <button class="scroll-top" id="scroll-top" title="Naar boven">&#9650;</button>

    <script>
        // State
        let jsonData = null;
        let sectionInfo = null;
        let liedboekUrls = {};
        let lastScrollTop = 0;
        let sidebarVisible = window.innerWidth > 900;

        // DOM elements
        const header = document.getElementById('header');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const navItems = document.getElementById('nav-items');
        const fileSelector = document.getElementById('file-selector');
        const themeToggle = document.getElementById('theme-toggle');
        const menuToggle = document.getElementById('menu-toggle');
        const scrollTopBtn = document.getElementById('scroll-top');
        
        // List of available JSON files
        const jsonFiles = [
            
	    { file: "Ede_25_dec_2025.json", label: "Ede (Kerst 2025, De Gelderhorst (Verzorgingstehuis))" },
            { file: "Den_Haag_28_dec_2025.json", label: "Den Haag (28 december 2025, De Kloosterkerk)" },
            { file: "s_Gravenzande_4_jan_2026.json", label: "'s-Gravenzande (4 januari 2026, NoorderBrug)" },
            
            { file: "Waddinxveen_11_jan_2026.json", label: "Waddinxveen (11 januari 2026, De Bethelkerk)" }, // [1]
            { file: "Gouda_25_jan_2026.json", label: "Gouda (25 januari 2026, De Pauluskerk)" },             // [2]
           
            { file: "Ameide_1_feb_2026.json", label: "Ameide (1 februari 2026, Sionkerk)" },

            { file: "Waddinxveen_15_feb_2026.json", label: "Waddinxveen (15 februari 2026, De Rank)" }, // [3]
            { file: "Waarder_22_feb_2026.json", label: "Waarder (22 februari 2026, PG)" }, // [4]
            { file: "Reeuwijk_8_mrt_2026.json", label: "Reeuwijk (8 maart 2026, De Ark)" }, // [5]

        ];

        // Section titles mapping
        const sectionTitles = {
            '00_meta': 'Metadata',
            '01_zondag_kerkelijk_jaar': 'Kerkelijk jaar',
            '02_sociaal_maatschappelijke_context': 'Sociaal-maatschappelijk',
            '03_waardenorientatie': 'WaardenoriÃ«ntatie',
            '04_geloofsorientatie': 'GeloofsoriÃ«ntatie',
            '05_interpretatieve_synthese': 'Interpretatieve synthese',
            '06_actueel_wereldnieuws': 'Actueel wereldnieuws',
            '07_politieke_orientatie': 'Politieke oriÃ«ntatie',
            '08a_exegese': 'Structuralistische exegese',
            
            '08c_commentaries': 'Commentarenwijsheid',
            '08b_liedsuggesties_database': 'Passende liederen',
            '08_liedsuggesties_database': 'Passende liederen',
            '09_kunst_cultuur': 'Kunst & cultuur',
            '10_focus_en_functie': 'Focus & functie',
            '11_kalender': 'Kalender',
            '12_representatieve_hoorders': 'Representatieve hoorders',
            
            '13_homiletische_analyse': 'Lowry\u2019s loop',
            '13_homiletische_analyse_buttrick': 'Moves & structures',
            '13b_homiletische_illustraties': 'Homiletische illustraties',
            '13c_homiletische_fundering_chapell': 'Chapells expositie',

            '14_klassieke_retorica': 'Retorische insteek',
            '14_gebeden': 'Gebeden (klassiek)',
            '14_gebeden_profetisch': 'Gebeden (profetisch)',
            '14_gebeden_dialogisch': 'Gebeden (dialogisch)',
            '14_gebeden_eenvoudig': 'Gebeden (B1-niveau)',
            '15_kindermoment': 'Kindermoment',
            '15_bezinningsmoment': 'Moment van bezinning',
            '16_preek_solle': 'Preekschets (politiek)',
            '17_preek_jungel': 'Preekschets (christologisch)',
            '18_preek_brueggemann': 'Preekschets (profetisch)',
            '19_preek_noordmans': 'Preekschets (kritisch)',
            '20_midjourney_prompts': 'Beeldgeneratie (prompts)',
            'Bijbelteksten': 'Bijbelteksten'
        };

        // Load section info
        async function loadSectionInfo() {
            try {
                const response = await fetch('section_info.json');
                if (response.ok) {
                    sectionInfo = await response.json();
                }
            } catch (err) {
                console.error('Could not load section_info.json:', err);
            }
        }
        loadSectionInfo();

        // Load Liedboek Compendium URLs
        async function loadLiedboekUrls() {
            try {
                const response = await fetch('urls_liedboekcompendium.txt');
                if (response.ok) {
                    const text = await response.text();
                    const lines = text.split('\n');
                    lines.forEach(line => {
                        const match = line.match(/^(.+?)\s*=>\s*(.+)$/);
                        if (match) {
                            liedboekUrls[match[1].trim()] = match[2].trim();
                        }
                    });
                }
            } catch (err) {
                console.error('Could not load urls_liedboekcompendium.txt:', err);
            }
        }
        loadLiedboekUrls();

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        });

        // Menu toggle (mobile)
        menuToggle.addEventListener('click', () => {
            sidebarVisible = !sidebarVisible;
            sidebar.classList.toggle('visible', sidebarVisible);
        });
        
        // File loading from selector
        fileSelector.addEventListener('change', () => loadFile(fileSelector.value));

        async function loadFile(fileName) {
             if (!fileName) return;

             mainContent.innerHTML = '<div class="loading">Bestand laden...</div>';

             try {
                 // Ensure section info is loaded first
                 if (!sectionInfo) {
                     await loadSectionInfo();
                 }
                 // Ensure liedboek URLs are loaded
                 if (Object.keys(liedboekUrls).length === 0) {
                     await loadLiedboekUrls();
                 }

                 const response = await fetch(fileName);
                 if (!response.ok) {
                    throw new Error(`Bestand niet gevonden: ${response.statusText}`);
                 }
                 jsonData = await response.json();
                 renderContent();
             } catch (err) {
                 mainContent.innerHTML = `<div class="welcome"><h1>Fout</h1><p>Kon bestand niet laden: ${err.message}</p></div>`;
             }
        }

        // Helper function to convert BHS/NA28 book codes to NBV21 codes
        function bhs2nbv21(bookOriginal) {
            if (!bookOriginal) return null;
            const mapping = {
                // BHS (Hebrew) to NBV21
                'Genesis': 'GEN', 'Exodus': 'EXO', 'Leviticus': 'LEV', 'Numeri': 'NUM', 'Deuteronomium': 'DEU',
                'Josua': 'JOS', 'Judices': 'JDG', 'Ruth': 'RUT',
                'Samuel_I': '1SA', 'Samuel_II': '2SA', 'Reges_I': '1KI', 'Reges_II': '2KI',
                'Chronica_I': '1CH', 'Chronica_II': '2CH', 'Esra': 'EZR', 'Nehemia': 'NEH',
                'Esther': 'EST', 'Iob': 'JOB', 'Psalmi': 'PSA', 'Proverbia': 'PRO',
                'Ecclesiastes': 'ECC', 'Canticum': 'SNG', 'Jesaia': 'ISA', 'Jeremia': 'JER',
                'Threni': 'LAM', 'Ezechiel': 'EZK', 'Daniel': 'DAN', 'Hosea': 'HOS',
                'Joel': 'JOL', 'Amos': 'AMO', 'Obadia': 'OBA', 'Jona': 'JON', 'Micha': 'MIC',
                'Nahum': 'NAM', 'Habakuk': 'HAB', 'Zephania': 'ZEP', 'Haggai': 'HAG',
                'Sacharia': 'ZEC', 'Maleachi': 'MAL',
                // NA28 (Greek) - already uses NBV21-like codes
                'MAT': 'MAT', 'MRK': 'MRK', 'LUK': 'LUK', 'JHN': 'JHN', 'ACT': 'ACT',
                'ROM': 'ROM', '1CO': '1CO', '2CO': '2CO', 'GAL': 'GAL', 'EPH': 'EPH',
                'PHP': 'PHP', 'COL': 'COL', '1TH': '1TH', '2TH': '2TH', '1TI': '1TI',
                '2TI': '2TI', 'TIT': 'TIT', 'PHM': 'PHM', 'HEB': 'HEB', 'JAS': 'JAS',
                '1PE': '1PE', '2PE': '2PE', '1JN': '1JN', '2JN': '2JN', '3JN': '3JN',
                'JUD': 'JUD', 'REV': 'REV'
            };
            return mapping[bookOriginal] || null;
        }

        // Map kindermoment types to more appropriate theological/pedagogical names
        function mapKindermomentType(type) {
            const typeMapping = {
                'Gek': 'Verrassend',
                'Gek/Onconventioneel': 'Verrassend',
                'Bizar': 'Bijzonder',
                'Klassiek': 'Traditioneel',
                'Actief': 'Interactief',
                'Ernstig': 'Bezinnend'
            };
            return typeMapping[type] || type;
        }

        function getSearchUrl(query, context) {
            const safeContext = (context || '').toLowerCase();
            const encoded = encodeURIComponent(query);

            // Contexts that should default to Web search
            const webContexts = ['muziek', 'literatuur', 'hedendaags', 'klassiek', 'liturgisch', 'modern', 'nederlands', 'poezie', 'roman', 'boeken', 'liederen', 'songs'];

            // Contexts that should default to Video search
            const videoContexts = ['film_documentaire', 'films', 'video', 'documentaire', 'movie', 'film'];

            if (webContexts.includes(safeContext)) {
                return `https://duckduckgo.com/?origin=funnel_home_google&t=h_&q=${encoded}&ia=web`;
            }

            if (videoContexts.includes(safeContext)) {
                return `https://duckduckgo.com/?origin=funnel_home_google&t=h_&q=${encoded}&ia=videos&iax=videos`;
            }

            return `https://duckduckgo.com/?origin=funnel_home_google&t=h_&q=${encoded}&ia=images&iax=images`;
        }

        // Determine menu group class based on section key
        function getMenuGroupClass(key) {
            // Groep 1: Liturgisch/Kerkelijk
            if (key === '01_zondag_kerkelijk_jaar' || key === 'Bijbelteksten') {
                return 'nav-group-liturgisch';
            }
            // Groep 2: Contextueel
            if (['02_sociaal_maatschappelijke_context', '03_waardenorientatie', '04_geloofsorientatie',
                 '05_interpretatieve_synthese', '06_actueel_wereldnieuws', '07_politieke_orientatie'].includes(key)) {
                return 'nav-group-contextueel';
            }
            // Groep 3: Exegese
            if (key === '08a_exegese' || key === '08_exegese' || key === '08c_commentaries') {
                return 'nav-group-exegese';
            }
            // Groep 4: Homiletiek
            if (['12_representatieve_hoorders', '10_focus_en_functie', '13c_homiletische_fundering_chapell',
                 '13_homiletische_analyse', '13_homiletische_analyse_buttrick',
                 '13b_homiletische_illustraties', '14_klassieke_retorica'].includes(key)) {
                return 'nav-group-homiletiek';
            }
            // Groep 5: Gebeden
            if (['14_gebeden', '14_gebeden_profetisch', '14_gebeden_dialogisch', '14_gebeden_eenvoudig'].includes(key)) {
                return 'nav-group-gebeden';
            }
            // Groep 6: Liturgische Elementen
            if (['15_bezinningsmoment', '15_kindermoment', '09_kunst_cultuur', '11_kalender', '20_midjourney_prompts',
                 '08b_liedsuggesties_database'].includes(key)) {
                return 'nav-group-liturgische-elementen';
            }
            // Groep 7: Preekschetsen
            if (['16_preek_solle', '17_preek_jungel', '18_preek_brueggemann', '19_preek_noordmans'].includes(key)) {
                return 'nav-group-preekschetsen';
            }
            return ''; // Default: geen specifieke groep klasse
        }

        // Get group name for section
        function getGroupName(key) {
            if (key === '01_zondag_kerkelijk_jaar' || key === 'Bijbelteksten') {
                return 'Liturgisch';
            }
            if (['02_sociaal_maatschappelijke_context', '03_waardenorientatie', '04_geloofsorientatie',
                 '05_interpretatieve_synthese', '06_actueel_wereldnieuws', '07_politieke_orientatie'].includes(key)) {
                return 'Contextueel';
            }
            if (key === '08a_exegese' || key === '08_exegese' || key === '08c_commentaries') {
                return 'Exegese';
            }
            if (['12_representatieve_hoorders', '10_focus_en_functie', '13c_homiletische_fundering_chapell',
                 '13_homiletische_analyse', '13_homiletische_analyse_buttrick',
                 '13b_homiletische_illustraties', '14_klassieke_retorica'].includes(key)) {
                return 'Homiletiek';
            }
            if (['14_gebeden', '14_gebeden_profetisch', '14_gebeden_dialogisch', '14_gebeden_eenvoudig'].includes(key)) {
                return 'Gebeden';
            }
            if (['15_bezinningsmoment', '15_kindermoment', '09_kunst_cultuur', '11_kalender', '20_midjourney_prompts',
                 '08b_liedsuggesties_database', '08_liedsuggesties_database'].includes(key)) {
                return 'Liturgische Elementen';
            }
            if (['16_preek_solle', '17_preek_jungel', '18_preek_brueggemann', '19_preek_noordmans'].includes(key)) {
                return 'Preekschetsen';
            }
            return null;
        }

        // Render all content
        function renderContent() {
            if (!jsonData) return;

            let html = '';

            // Render meta box first
            if (jsonData['00_meta']) {
                const meta = jsonData['00_meta'];
                const metaKey = '00_meta';
                
                let infoPanelHtml = '';
                if (sectionInfo && sectionInfo[metaKey]) {
                    infoPanelHtml = `
                        <div class="section-info-panel">
                            <div class="section-info-title">Algemene informatie</div>
                            <div class="section-info-text">${processText(sectionInfo[metaKey])}</div>
                        </div>
                    `;
                }

                html += `
                    <div class="section-layout" style="margin-bottom: 30px;">
                        <div class="section-main-content">
                            <div class="meta-box bevel-raised" style="margin-bottom: 0;">
                                <h1>${escapeHtml(meta.plaatsnaam || 'Liturgische Analyse')}</h1>
                                <div class="gemeente">${escapeHtml(meta.gemeente || '')}</div>
                                <div class="datum">${escapeHtml(meta.datum || '')}</div>
                                <div class="adres">${escapeHtml(meta.adres || '')}</div>
                                ${meta.website ? `<a href="${escapeHtml(meta.website)}" target="_blank">${escapeHtml(meta.website)}</a>` : ''}
                            </div>
                        </div>
                        ${infoPanelHtml}
                    </div>
                `;
            }

            // Build nav and content
            let navHtml = '';
            const allSections = Object.keys(jsonData).filter(k => k !== '00_meta');

            // Check if Bijbelteksten exists
            const hasBijbelteksten = allSections.includes('Bijbelteksten');

            // Separate Bijbelteksten from other sections if it exists
            let otherSections = allSections;
            if (hasBijbelteksten) {
                otherSections = allSections.filter(k => k !== 'Bijbelteksten');
            }

            // Determine the highest number from sections that have numeric prefixes
            const numberedSections = otherSections.filter(k => /^(\d+)_/.test(k));
            const highestNum = numberedSections.length > 0
                ? Math.max(...numberedSections.map(k => parseInt(k.match(/^(\d+)_/)[1])))
                : 0;

            // Initialize counter for unnumbered sections
            let unnumberedCounter = highestNum + 1;

            // Sort other sections using a custom function
            function customSectionSort(a, b) {
                const extractParts = (key) => {
                    const match = key.match(/^(\d+)([a-z]?)_?.*$/);
                    if (match) {
                        const num = parseInt(match[1]);
                        const letter = match[2] || '';
                        return { num, letter };
                    }
                    return { num: Infinity, letter: key };
                };

                const partsA = extractParts(a);
                const partsB = extractParts(b);

                if (partsA.num !== partsB.num) {
                    return partsA.num - partsB.num;
                }

                if (partsA.letter !== partsB.letter) {
                    return partsA.letter.localeCompare(partsB.letter);
                }

                return a.localeCompare(b);
            }
            let sortedOtherSections = otherSections.sort(customSectionSort);

            // Custom sort for the 14_gebeden group to ensure 14a, 14b, 14c order
            const prayerKeys = ['14_gebeden', '14_gebeden_profetisch', '14_gebeden_dialogisch', '14_gebeden_eenvoudig'];
            if (prayerKeys.every(k => sortedOtherSections.includes(k))) {
                // Remove them from their current positions
                sortedOtherSections = sortedOtherSections.filter(k => !prayerKeys.includes(k));
                // Find the index where 14_gebeden would have been or just before 15_kindermoment
                let insertIndex = sortedOtherSections.findIndex(k => k > '14');
                if (insertIndex === -1) insertIndex = sortedOtherSections.length;
                sortedOtherSections.splice(insertIndex, 0, ...prayerKeys);
            }

            // Build the final sections array: [Bijbelteksten as second item]
            let sections = [];
            if (otherSections.length > 0) {
                // Add Bijbelteksten if it exists
                if (hasBijbelteksten) {
                    sections.push('Bijbelteksten');
                }
                sections = sections.concat(otherSections);
            } else if (hasBijbelteksten) {
                sections.push('Bijbelteksten');
            }
            
            // Create a map of keys to their calculated display numbers
            const sectionNumberMap = {};
            let tempUnnumberedCounter = highestNum + 1; // Use a temporary counter

            // Correct mapping for sorting order
            const keyToSortNum = {
                '01_zondag_kerkelijk_jaar': '01',
                'Bijbelteksten': '02',

                '02_sociaal_maatschappelijke_context': '03',
                '03_waardenorientatie': '04',
                '04_geloofsorientatie': '05',
                '05_interpretatieve_synthese': '06',
                '06_actueel_wereldnieuws': '07',
                '07_politieke_orientatie': '08',

                '08a_exegese': '09',
                '08c_commentaries': '10',

                '12_representatieve_hoorders': '11',
                '10_focus_en_functie': '12',
                '13_homiletische_analyse': '13',
                '13_homiletische_analyse_buttrick': '14',
                '13b_homiletische_illustraties': '15',
                '13c_homiletische_fundering_chapell': '16',
                '14_klassieke_retorica': '17',

                '14_gebeden': '18',
                '14_gebeden_profetisch': '19',
                '14_gebeden_dialogisch': '20',
                '14_gebeden_eenvoudig': '21',

                '15_kindermoment': '22',
                '15_bezinningsmoment': '23',
                '09_kunst_cultuur': '24',
                '11_kalender': '25',
                '08b_liedsuggesties_database': '26',
                '20_midjourney_prompts': '27',

                '16_preek_solle': '28',
                '17_preek_jungel': '29',
                '18_preek_brueggemann': '30',
                '19_preek_noordmans': '31'
            };

            // Create section number map for sorting
            const sectionSortMap = {};

            sections.forEach(key => {
                // Sort number (for ordering sections)
                if (keyToSortNum[key]) {
                    sectionSortMap[key] = keyToSortNum[key];
                } else {
                    const numMatch = key.match(/^(\d+)/);
                    sectionSortMap[key] = numMatch ? numMatch[1].padStart(2, '0') : String(tempUnnumberedCounter++).padStart(2, '0');
                }
            });

            // Now sort the sections array based on the sort numbers
            sections.sort((a, b) => {
                const numA = sectionSortMap[a];
                const numB = sectionSortMap[b];
                return numA.localeCompare(numB, undefined, { numeric: true, sensitivity: 'base' });
            });

            // After sorting, assign sequential display numbers (1, 2, 3, etc.)
            sections.forEach((key, index) => {
                sectionNumberMap[key] = String(index + 1);
            });

            let lastGroupName = null;
            sections.forEach((key, index) => {
                const title = sectionTitles[key] || formatKey(key);
                const num = sectionNumberMap[key]; // Sequential number

                const sectionData = jsonData[key];

                // Add group header if entering a new group
                const currentGroupName = getGroupName(key);
                if (currentGroupName && currentGroupName !== lastGroupName) {
                    navHtml += `<div class="nav-group-header">${currentGroupName}</div>`;
                    lastGroupName = currentGroupName;
                }


                // Special handling for Bijbelteksten - show bible references as submenu
                let subSections = [];
                let subSectionLabels = {};

                if (key === 'Bijbelteksten') {
                    // Get liturgical order from lezingen section
                    const lezingenOrder = [];
                    const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen;
                    if (lezingen) {
                        // Define liturgical order
                        const orderKeys = ['eerste_lezing', 'psalm', 'epistel', 'evangelie'];
                        orderKeys.forEach(lezingKey => {
                            if (lezingen[lezingKey]) {
                                const lez = lezingen[lezingKey];
                                // Map Dutch book names to codes
                                const boekCode = getBoekCode(lez.boek || lez.referentie);
                                const hoofdstuk = lez.hoofdstuk || lez.nummer;
                                if (boekCode && hoofdstuk) {
                                    lezingenOrder.push({ book: boekCode, chapter: hoofdstuk });
                                }
                            }
                        });
                    }

                    // Collect all perikopen with their liturgical order
                    const allPerikopen = [];

                    const vertalingLabels = { 'grondtekst': 'Grondtekst', 'nbv21': 'NBV21', 'naardense_bijbel': 'NB' };
                    ['grondtekst', 'nbv21', 'naardense_bijbel'].forEach(vertaling => {
                        if (sectionData[vertaling] && Array.isArray(sectionData[vertaling])) {
                            sectionData[vertaling].forEach(perikoop => {
                                // Grondtekst uses book_original, NBV21/NB use book
                                const bookCode = perikoop.book || perikoop.book_original;
                                const eersteVers = perikoop.verses[0]?.verse || 1;
                                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                                const verzen = eersteVers === laatsteVers ? String(eersteVers) : `${eersteVers}-${laatsteVers}`;
                                const vertalingLabel = vertalingLabels[vertaling] || vertaling;

                                // For grondtekst, convert book_original to NBV21 code
                                const normalizedBookCode = bhs2nbv21(bookCode) || bookCode;

                                // Find liturgical order index
                                let orderIndex = lezingenOrder.findIndex(l => {
                                    return l.book === normalizedBookCode && l.chapter === perikoop.chapter;
                                });
                                // Fallback: match by book only (fixes split chapters like Sefanja 2 & 3)
                                if (orderIndex === -1) {
                                     orderIndex = lezingenOrder.findIndex(l => l.book === normalizedBookCode);
                                }
                                if (orderIndex === -1) orderIndex = 999; // Unknown goes to end

                                allPerikopen.push({
                                    vertaling: vertalingLabel,
                                    vertalingKey: vertaling,
                                    book: bookCode,
                                    normalizedBook: normalizedBookCode,
                                    book_nl: perikoop.book_nl,
                                    chapter: perikoop.chapter,
                                    verzen: verzen,
                                    orderIndex: orderIndex,
                                    subKey: `${bookCode}-${perikoop.chapter}-${vertaling}`
                                });
                            });
                        }
                    });

                    // Sort by: 1) liturgical order, 2) translation order, 3) chapter
                    const vertalingOrder = { 'grondtekst': 0, 'nbv21': 1, 'naardense_bijbel': 2 };
                    allPerikopen.sort((a, b) => {
                        if (a.orderIndex !== b.orderIndex) return a.orderIndex - b.orderIndex;
                        if (a.vertalingKey !== b.vertalingKey) {
                             return (vertalingOrder[a.vertalingKey] || 99) - (vertalingOrder[b.vertalingKey] || 99);
                        }
                        return a.chapter - b.chapter;
                    });

                    // Group adjacent pericopes of same translation and book (Navigation Menu)
                    const groupedPerikopen = [];
                    let currentGroup = null;

                    allPerikopen.forEach(perikoop => {
                        if (currentGroup && 
                            currentGroup.vertalingKey === perikoop.vertalingKey && 
                            currentGroup.book === perikoop.book) {
                            // Merge with current group
                            currentGroup.parts.push({chapter: perikoop.chapter, verzen: perikoop.verzen});
                        } else {
                            // Start new group
                            currentGroup = {
                                ...perikoop,
                                parts: [{chapter: perikoop.chapter, verzen: perikoop.verzen}]
                            };
                            groupedPerikopen.push(currentGroup);
                        }
                    });

                    // Build submenu items from grouped list
                    groupedPerikopen.forEach(item => {
                        const boekNaam = item.book_nl || getBijbelboekNaam(item.book);
                        
                        // Build combined reference string
                        const refParts = item.parts.map(part => `${part.chapter}:${part.verzen}`);
                        // Simple join: "2:3; 3:12-13"
                        // Optimization: if chapters are same, combine? (Not strictly needed for Sefanja case)
                        const refString = refParts.join('; ');

                        const label = `${boekNaam} ${refString} (${item.vertaling})`;
                        // Use the subKey of the FIRST item in the group as the anchor
                        subSections.push(item.subKey);
                        subSectionLabels[item.subKey] = label;
                    });
                } else if (key === '12_representatieve_hoorders') {
                    // Special handling for Representatieve Hoorders - show persona names and ages
                    if (sectionData.personas && Array.isArray(sectionData.personas)) {
                        sectionData.personas.forEach((persona, index) => {
                            const naam = persona.naam ?
                                (typeof persona.naam === 'object' ?
                                    `${persona.naam.voornaam || ''} ${persona.naam.achternaam || ''}`.trim() :
                                    persona.naam) :
                                `Hoorder ${persona.nummer || index + 1}`;
                            const leeftijd = persona.leeftijd ? `${persona.leeftijd} jaar` : '';
                            const label = leeftijd ? `${naam} (${leeftijd})` : naam;

                            subSections.push(`personas-${persona.nummer || (index + 1)}`);
                            subSectionLabels[`personas-${persona.nummer || (index + 1)}`] = label;
                        });
                    }
                } else if (key === '10_focus_en_functie') {
                    // Special handling for Focus & Functie - show option names
                    if (sectionData.opties && Array.isArray(sectionData.opties)) {
                        sectionData.opties.forEach((optie, index) => {
                            const titel = optie.korte_titel || `Optie ${index + 1}`;
                            const nummer = optie.nummer ? `${optie.nummer}. ` : '';
                            const label = `${nummer}${titel}`;

                            subSections.push(`optie-${optie.nummer || (index + 1)}`);
                            subSectionLabels[`optie-${optie.nummer || (index + 1)}`] = label;
                        });
                    }
                } else if (key === '11_kalender') {
                    // Special handling for Kalender - show day names/dates
                    if (sectionData.dagen && Array.isArray(sectionData.dagen)) {
                        sectionData.dagen.forEach((dag, index) => {
                            const datum = dag.datum || `Dag ${index + 1}`;
                            // Extract just the day and month part if it's in full format like "Zondag 4 januari 2026"
                            const cleanDatum = datum.replace(/^\w+\s/, ''); // Remove day name (Zondag, Maandag, etc.)

                            subSections.push(`dag-${index + 1}`);
                            subSectionLabels[`dag-${index + 1}`] = cleanDatum;
                        });
                    }
                } else if (key === '08a_exegese') {
                    // Special handling for Exegese - show scripture references
                    if (sectionData.per_lezing && Array.isArray(sectionData.per_lezing)) {
                        sectionData.per_lezing.forEach((lezing, index) => {
                            const referentie = lezing.referentie || `Lezing ${index + 1}`;

                            subSections.push(`lezing-${index + 1}`);
                            subSectionLabels[`lezing-${index + 1}`] = referentie;
                        });
                    }
                } else if (key === '08c_commentaries') {
                    // Special handling for Commentaries - show parts
                    const labels = {
                        'exegese_eerste_lezing': 'Eerste Lezing',
                        'exegese_evangelielezing': 'Evangelielezing',
                        'reflectie': 'Reflectie'
                    };
                    ['exegese_eerste_lezing', 'exegese_evangelielezing', 'reflectie'].forEach(subKey => {
                        if (sectionData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = labels[subKey];
                        }
                    });
                } else if (key === '15_kindermoment') {
                    // Special handling for Kindermoment - show the three kindermoment option titles
                    if (sectionData.kindermoment_opties && Array.isArray(sectionData.kindermoment_opties)) {
                        sectionData.kindermoment_opties.forEach((optie, index) => {
                            const titel = optie.titel || `Kindermoment Optie ${index + 1}`;
                            const type = optie.type ? mapKindermomentType(optie.type) : '';
                            const label = type ? `${type}: ${titel}` : titel;

                            subSections.push(`kindermoment-${index + 1}`);
                            subSectionLabels[`kindermoment-${index + 1}`] = label;
                        });
                    }
                } else if (key === '15_bezinningsmoment') {
                    // Special handling for Bezinningsmoment - show the options
                    if (sectionData.kindermoment_opties && Array.isArray(sectionData.kindermoment_opties)) {
                        sectionData.kindermoment_opties.forEach((optie, index) => {
                            const titel = optie.titel || `Optie ${index + 1}`;
                            const type = optie.type ? mapKindermomentType(optie.type) : '';
                            const label = type ? `${type}: ${titel}` : titel;

                            subSections.push(`kindermoment-${index + 1}`);
                            subSectionLabels[`kindermoment-${index + 1}`] = label;
                        });
                    }
                } else if (key === '14_gebeden' || key === '14_gebeden_profetisch' || key === '14_gebeden_dialogisch' || key === '14_gebeden_eenvoudig') {
                    // Special handling for Gebeden - show specific prayer types
                    const gebeden = sectionData.gebeden || {};
                    const gebedOrder = ['drempelgebed', 'kyrie', 'epiclese', 'dankgebed', 'voorbeden'];
                    const gebedTitles = {
                        'drempelgebed': 'Drempelgebed',
                        'kyrie': 'Kyrie',
                        'epiclese': 'Epiclese',
                        'dankgebed': 'Dankgebed',
                        'voorbeden': 'Voorbeden'
                    };

                    gebedOrder.forEach(prayerType => {
                        if (gebeden[prayerType]) {
                            subSections.push(`gebeden-${prayerType}`);
                            subSectionLabels[`gebeden-${prayerType}`] = gebedTitles[prayerType] || prayerType;
                        }
                    });
                } else if (key === '13_homiletische_analyse') {
                    // Special handling for Homiletische Analyse (Lowry) - rename items
                    const subKeyOrder = ['tekstkeuze', 'homiletical_plot'];
                    const labelMap = {
                        'tekstkeuze': 'Tekstkeuze',
                        'homiletical_plot': 'De 5 Stadia (Lowry)',
                    };

                    subKeyOrder.forEach(subKey => {
                        if (sectionData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = labelMap[subKey];
                        }
                    });
                } else if (key === '13_homiletische_analyse_buttrick') {
                    // Special handling for Homiletische Analyse (Buttrick) - Moves & Structures
                    const subKeyOrder = ['tekstkeuze', 'introductie', 'moves', 'conclusie', 'beweging_samenvatting', 'contextuele_integratie'];
                    const labelMap = {
                        'tekstkeuze': 'Tekstkeuze',
                        'introductie': 'Introductie',
                        'moves': 'Moves',
                        'conclusie': 'Conclusie',
                        'beweging_samenvatting': 'Beweging',
                        'contextuele_integratie': 'Context'
                    };

                    subKeyOrder.forEach(subKey => {
                        if (sectionData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = labelMap[subKey];
                        }
                    });
                } else if (key === '13b_homiletische_illustraties') {
                    // Special handling for Homiletische Illustraties - show illustration titles
                    if (sectionData.illustraties && Array.isArray(sectionData.illustraties)) {
                        sectionData.illustraties.forEach((illustratie, index) => {
                            const titel = illustratie.titel || `Illustratie ${illustratie.nummer || index + 1}`;
                            const nummer = illustratie.nummer || (index + 1);

                            subSections.push(`illustratie-${nummer}`);
                            subSectionLabels[`illustratie-${nummer}`] = titel;
                        });
                    }
                } else if (key === '13c_homiletische_fundering_chapell') {
                    // Special handling for Chapell - show main sections
                    const chapellData = sectionData.homiletische_fundering_chapell || sectionData;
                    const subKeyOrder = ['gcf', 'christocentrische_duiding', 'motivatie_genade', 'expositorisch_raamwerk'];
                    const labelMap = {
                        'gcf': 'GCF',
                        'christocentrische_duiding': 'Christocentrisch',
                        'motivatie_genade': 'Genade',
                        'expositorisch_raamwerk': 'Raamwerk'
                    };

                    subKeyOrder.forEach(subKey => {
                        if (chapellData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = labelMap[subKey];
                        }
                    });
                } else if (key === '14_klassieke_retorica') {
                    // Special handling for Klassieke Retorica - show main sections
                    const subKeyOrder = ['meta', 'aristotelische_appeals', 'klassieke_dispositio', 'monroes_motivated_sequence', 'retorische_figuren', 'praktische_tips'];
                    const labelMap = {
                        'meta': 'Meta',
                        'aristotelische_appeals': 'Aristotelische Appeals',
                        'klassieke_dispositio': 'Klassieke Dispositio',
                        'monroes_motivated_sequence': 'Monroe\'s Sequence',
                        'retorische_figuren': 'Retorische Figuren',
                        'praktische_tips': 'Praktische Tips'
                    };

                    subKeyOrder.forEach(subKey => {
                        if (sectionData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = labelMap[subKey];
                        }
                    });
                } else if (key === '08b_liedsuggesties_database' || key === '08_liedsuggesties_database') {
                    // Special handling for Liedsuggesties - provide custom labels for liedboeken
                    const liedboekLabels = {
                        'liedboek_2013': 'Liedboek (2013)',
                        'weerklank': 'Weerklank',
                        'weerklank_psalmen': 'Weerklank (Psalmen)',
                        'hemelhoog': 'Hemelhoog',
                        'op_toonhoogte': 'Op Toonhoogte (2015)'
                    };

                    Object.keys(sectionData).forEach(subKey => {
                        if (!subKey.startsWith('_') && subKey !== 'analyse' && sectionData[subKey]) {
                            subSections.push(subKey);
                            subSectionLabels[subKey] = liedboekLabels[subKey] || formatKey(subKey);
                        }
                    });
                } else {
                    // Default: get subsections from top-level keys
                    subSections = Object.keys(sectionData)
                        .filter(k => !k.startsWith('_'))
                        .filter(k => {
                            const val = sectionData[k];
                            return val !== null && val !== undefined;
                        })
                        .filter(k => {
                            // Skip 'kerkelijke_context' and 'bronnen_gebruikt' in sociaal-maatschappelijke context
                            if ((k === 'kerkelijke_context' || k === 'bronnen_gebruikt') && key === '02_sociaal_maatschappelijke_context') return false;
                            return true;
                        })
                        .slice(0, 12); // Limit to 12 subsections
                }

                const groupClass = getMenuGroupClass(key);
                navHtml += `
                    <div class="nav-group ${groupClass}">
                        <div class="nav-item" data-section="${key}" data-has-submenu="${subSections.length > 0}">
                            <span class="nav-number">${num}</span>
                            ${escapeHtml(title)}
                            ${subSections.length > 0 ? '<span class="nav-toggle">â–¶</span>' : ''}
                        </div>
                        ${subSections.length > 0 ? `
                            <div class="nav-submenu" data-section="${key}">
                                ${subSections.map(subKey => `
                                    <a href="#section-${key}-${subKey}" class="nav-subitem" data-section="${key}" data-subsection="${subKey}">
                                        ${escapeAndSmartQuotes(subSectionLabels[subKey] || formatKey(subKey))}
                                    </a>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;

                html += renderSection(key, sectionData, num);
            });

            navItems.innerHTML = navHtml;
            mainContent.innerHTML = html;

            // Add click handlers to nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const sectionKey = item.dataset.section;
                    const hasSubmenu = item.dataset.hasSubmenu === 'true';

                    // Toggle submenu
                    if (hasSubmenu) {
                        item.classList.toggle('expanded');
                        const submenu = item.nextElementSibling;
                        if (submenu && submenu.classList.contains('nav-submenu')) {
                            submenu.classList.toggle('open');
                        }
                    }

                    // Navigate to section
                    const section = document.getElementById(`section-${sectionKey}`);
                    if (section) {
                        section.scrollIntoView({ behavior: 'smooth' });
                    }

                    // Close sidebar on mobile
                    if (window.innerWidth <= 900) {
                        sidebar.classList.remove('visible');
                        sidebarVisible = false;
                    }
                });
            });

            // Add click handlers to nav subitems
            document.querySelectorAll('.nav-subitem').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const sectionKey = item.dataset.section;
                    const subKey = item.dataset.subsection;

                    // Try to find the subsection element
                    let target = document.getElementById(`section-${sectionKey}-${subKey}`);
                    if (!target) {
                        // Fallback to main section
                        target = document.getElementById(`section-${sectionKey}`);
                    }

                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }

                    // Close sidebar on mobile
                    if (window.innerWidth <= 900) {
                        sidebar.classList.remove('visible');
                        sidebarVisible = false;
                    }
                });
            });
        }

        function renderSection(key, data, num) {
            let title = sectionTitles[key] || formatKey(key);
            // Add location name to Politieke oriÃ«ntatie title
            if (key === '07_politieke_orientatie' && jsonData && jsonData['00_meta']?.plaatsnaam) {
                title = `${title} (${jsonData['00_meta'].plaatsnaam})`;
            }
            // Use the pre-calculated number from the main loop
            const sectionNum = num;
            const meta = data._meta || {};
            const generatedAt = meta.generated_at ? new Date(meta.generated_at).toLocaleString('nl-NL') : '';

            let contentHtml = '';

            // Render data without _meta
            const dataToRender = { ...data };
            delete dataToRender._meta;

            // Special handling for Bijbelteksten - render in liturgical order
            if (key === 'Bijbelteksten') {
                contentHtml = renderBijbeltekstenSection(dataToRender);
            } else if (key === '14_gebeden' || key === '14_gebeden_profetisch' || key === '14_gebeden_dialogisch' || key === '14_gebeden_eenvoudig') {
                contentHtml = renderGebedenSection(dataToRender);
            } else if (key === '16_preek_solle' || key === '17_preek_jungel' || key === '18_preek_brueggemann' || key === '19_preek_noordmans') {
                contentHtml = renderPreekschetsSection(dataToRender, key);
            } else if (key === '13b_homiletische_illustraties') {
                contentHtml = renderIllustratiesSection(dataToRender);
            } else if (key === '12_representatieve_hoorders') {
                contentHtml = renderHoordersSection(dataToRender);
            } else if (key === '08_exegese' || key === '08a_exegese') {
                contentHtml = renderExegeseSection(dataToRender, key);
            } else if (key === '08c_commentaries') {
                contentHtml = renderCommentariesSection(dataToRender, key);
            } else if (key === '14_klassieke_retorica') {
                contentHtml = renderKlassiekeRetorica(dataToRender, key);
            } else if (key === '13c_homiletische_fundering_chapell') {
                contentHtml = renderChapellBrug(dataToRender);
            } else if (key === '01_zondag_kerkelijk_jaar') {
                contentHtml = renderObjectWithIds(dataToRender, key);
            } else if (key === '15_kindermoment' || key === '15_bezinningsmoment') {
                contentHtml = renderObjectWithIds(dataToRender, key);
            } else {
                contentHtml = renderObjectWithIds(dataToRender, key);
            }

            // Generate info panel if section info is available
            let infoPanelHtml = '';
            if (sectionInfo && sectionInfo[key]) {
                infoPanelHtml = `
                    <div class="section-info-panel">
                        <div class="section-info-title">Over deze sectie</div>
                        <div class="section-info-text">${smartQuotes(escapeHtml(sectionInfo[key]))}</div>
                    </div>
                `;
            }

            // Get group class for color coding
            const groupClass = getMenuGroupClass(key).replace('nav-group-', 'section-group-');

            return `
                <section class="section bevel-raised ${groupClass}" id="section-${key}">
                    <div class="section-header">
                        <div class="section-number">${sectionNum}</div>
                        <h2 class="section-title">${escapeHtml(title)}</h2>
                        ${generatedAt ? `<div class="section-meta">Gegenereerd: ${escapeHtml(generatedAt)}</div>` : ''}
                    </div>
                    <div class="section-layout">
                        <div class="section-main-content">
                            ${contentHtml}
                        </div>
                        ${infoPanelHtml}
                    </div>
                </section>
            `;
        }

        // Render Commentaries section
        function renderCommentariesSection(data, sectionKey) {
            let html = '';
            
            const renderPart = (partKey, partTitle) => {
                const part = data[partKey];
                if (!part) return '';
                
                let partHtml = `<div id="section-${sectionKey}-${partKey}" class="subsection-anchor"></div>`;
                partHtml += `<div class="data-group">`;
                partHtml += `<div class="data-group-title">${escapeHtml(partTitle)}</div>`;
                
                partHtml += `<div class="nested-object" style="background: var(--bg-secondary); border-left-color: var(--accent);">`;
                
                if (part.schriftgedeelte) {
                    partHtml += `<div class="data-item" style="background: var(--bg-tertiary);"><div class="data-label">Schriftgedeelte</div><div class="data-value">${processText(part.schriftgedeelte)}</div></div>`;
                }
                
                if (part.titel) {
                    partHtml += `<h3 style="margin: 15px 0 10px 0; color: var(--accent);">${processText(part.titel)}</h3>`;
                }
                
                if (part.korte_samenvatting) {
                    partHtml += `<div class="quote-block" style="background: var(--bg-tertiary); margin-bottom: 20px;">${processText(part.korte_samenvatting)}</div>`;
                }
                
                if (part.tekst) {
                    partHtml += `<div class="preek-tekst" style="margin-bottom: 20px;">${processText(part.tekst)}</div>`;
                }
                
                if (part.gebruikte_bronnen && Array.isArray(part.gebruikte_bronnen)) {
                    partHtml += `<div style="margin-top:15px; padding-top: 15px; border-top: 1px dashed var(--border-light);"><strong>Gebruikte commentaren:</strong><ul style="margin-top: 10px; margin-left: 20px;">`;
                    part.gebruikte_bronnen.forEach(bron => {
                        partHtml += `<li>${processText(bron)}</li>`;
                    });
                    partHtml += `</ul></div>`;
                }
                
                partHtml += `</div></div>`;
                return partHtml;
            };
            
            html += renderPart('exegese_eerste_lezing', 'Exegese Eerste Lezing');
            html += renderPart('exegese_evangelielezing', 'Exegese Evangelielezing');
            
            if (data.reflectie) {
                html += `<div id="section-${sectionKey}-reflectie" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Reflectie & Synthese</div>`;
                
                html += `<div class="nested-object" style="background: var(--bg-secondary); border-left-color: var(--accent);">`;

                if (data.reflectie.theologische_lijnen && Array.isArray(data.reflectie.theologische_lijnen)) {
                    html += `<strong>Theologische lijnen uit de commentaren:</strong><ul style="margin-top: 10px; margin-left: 20px; margin-bottom: 20px;">`;
                    data.reflectie.theologische_lijnen.forEach(lijn => {
                        html += `<li>${processText(lijn)}</li>`;
                    });
                    html += `</ul>`;
                }
                
                if (data.reflectie.homiletische_potentie) {
                    html += `<div style="margin-top:15px; padding-top: 15px; border-top: 1px dashed var(--border-light);"><strong>Homiletische potentie:</strong><div class="preek-tekst" style="margin-top: 10px;">${processText(data.reflectie.homiletische_potentie)}</div></div>`;
                }
                
                html += `</div></div>`;
            }
            
            return html;
        }

        // Render object with IDs for navigation
        function renderObjectWithIds(obj, sectionKey) {
            if (!obj || typeof obj !== 'object') {
                return `<div class="data-value">${formatValue(obj)}</div>`;
            }

            let html = '';
            const entries = Object.entries(obj).filter(([k, v]) => {
                // Skip metadata
                if (k.startsWith('_')) return false;
                if (v === null || v === undefined) return false;
                // Skip 'analyse' in liedsuggesties sections
                if (k === 'analyse' && (sectionKey === '08b_liedsuggesties_database' || sectionKey === '08_liedsuggesties_database')) return false;
                // Skip 'kerkelijke_context' and 'bronnen_gebruikt' in sociaal-maatschappelijke context
                if ((k === 'kerkelijke_context' || k === 'bronnen_gebruikt') && sectionKey === '02_sociaal_maatschappelijke_context') return false;
                return true;
            });

            for (const [key, value] of entries) {
                const anchor = `<div id="section-${sectionKey}-${key}" class="subsection-anchor"></div>`;
                html += anchor + renderSingleEntry(key, value, sectionKey);
            }

            return html;
        }

        function renderObject(obj, parentKey = '') {
            if (!obj || typeof obj !== 'object') {
                return `<div class="data-value">${formatValue(obj)}</div>`;
            }

            let html = '';

            // Analyze object structure for smart rendering
            const entries = Object.entries(obj).filter(([k, v]) => !k.startsWith('_') && v !== null && v !== undefined);

            // Check if this object has multiple child objects with simple string values (good for grid)
            const childObjects = entries.filter(([k, v]) => typeof v === 'object' && v !== null && !Array.isArray(v));
            const simpleValues = entries.filter(([k, v]) => typeof v !== 'object');

            // If we have multiple simple string values, render as compact data pairs
            if (simpleValues.length >= 3 && simpleValues.length <= 8 && childObjects.length === 0) {
                const shortValues = simpleValues.filter(([k, v]) => String(v).length < 100 && typeof v !== 'boolean');
                if (shortValues.length >= 3) {
                    html += `<div class="data-pairs">`;
                    shortValues.forEach(([key, value]) => {
                        if (key === 'zoekterm') {
                            html += `<div class="data-pair"><div class="data-pair-label">${escapeHtml(formatKey(key))}</div><div class="data-pair-value"><a href="${getSearchUrl(value, parentKey)}" target="_blank" class="search-term" title="Zoek op DuckDuckGo">${processText(value)}</a></div></div>`;
                        } else {
                            html += `<div class="data-pair"><div class="data-pair-label">${escapeHtml(formatKey(key))}</div><div class="data-pair-value">${formatValue(value)}</div></div>`;
                        }
                    });
                    html += `</div>`;

                    // Render remaining non-simple values normally
                    const remaining = entries.filter(([k, v]) => typeof v === 'object' || String(v).length >= 100);
                    for (const [key, value] of remaining) {
                        html += renderSingleEntry(key, value, parentKey);
                    }
                    return html;
                }
            }

            // If we have multiple child objects, render as grid cards
            if (childObjects.length >= 2 && childObjects.length <= 6) {
                // Check if child objects are simple enough for cards
                const simpleChildObjects = childObjects.filter(([k, v]) => {
                    const childEntries = Object.entries(v).filter(([ck, cv]) => !ck.startsWith('_'));
                    return childEntries.every(([ck, cv]) => typeof cv !== 'object' || Array.isArray(cv));
                });

                if (simpleChildObjects.length >= 2) {
                    // Render simple values first
                    for (const [key, value] of simpleValues) {
                        html += renderSingleEntry(key, value, parentKey);
                    }

                    // Render child objects as grid
                    html += `<div class="card-grid">`;
                    for (const [key, value] of simpleChildObjects) {
                        html += `<div class="nested-card">`;
                        html += `<div class="nested-card-title">${escapeHtml(formatKey(key))}</div>`;
                        html += `<div class="nested-card-content">${renderObjectCompact(value, key)}</div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;

                    // Render remaining complex objects normally
                    const complexChildObjects = childObjects.filter(([k]) => !simpleChildObjects.find(([sk]) => sk === k));
                    for (const [key, value] of complexChildObjects) {
                        html += renderSingleEntry(key, value, parentKey);
                    }
                    return html;
                }
            }

            // Default rendering
            for (const [key, value] of entries) {
                html += renderSingleEntry(key, value, parentKey);
            }

            return html;
        }

        function renderSingleEntry(key, value, parentKey) {
            let html = '';
            const formattedKey = formatKey(key);

            // Filter out boolean fields (like geen_eisenlijst, diagnose_remedie_klopt)
            if (typeof value === 'boolean') {
                return '';
            }

            // Filter out metadata fields from Midjourney prompts section
            if (parentKey === '20_midjourney_prompts') {
                const hiddenFields = ['preek_titel', 'schriftlezing', 'liturgische_periode', 'kernthema'];
                if (hiddenFields.includes(key)) {
                    return '';
                }
            }

            // Replace string "null" values with placeholder text
            if (value === 'null' || value === 'NULL') {
                value = 'geen gegevens beschikbaar';
            }

            // Special rendering for specific keys
            const songbookKeys = ['liedsuggesties', 'liedboek_2013', 'weerklank', 'weerklank_psalmen', 'hemelhoog', 'op_toonhoogte'];
            if (songbookKeys.includes(key) || key.includes('lied')) {
                return renderLiedsuggesties(key, value);
            }

            if (key === 'lezingen') {
                return renderLezingen(value);
            }

            if (key === 'hoorders' || parentKey === '12_representatieve_hoorders') {
                if (Array.isArray(value) && value.length > 0 && typeof value[0] === 'object' && value[0].naam) {
                    return renderHoorders(value);
                }
            }

            if (key === 'gebeden' && Array.isArray(value)) {
                return renderGebeden(value);
            }

            // Kindermoment opties
            if (key === 'kindermoment_opties' && (parentKey === '15_kindermoment' || parentKey === '15_bezinningsmoment')) {
                return renderKindermoment(value, parentKey);
            }

            // Positie kerkelijk jaar - combine leesrooster_jaar with dominant_evangelie
            if (key === 'positie_kerkelijk_jaar' && parentKey === '01_zondag_kerkelijk_jaar') {
                return renderPositieKerkelijkJaar(value);
            }

            // Focus en functie opties
            if (key === 'opties' && parentKey === '10_focus_en_functie') {
                return renderFocusFunctie(value);
            }

            // Motivaction milieus
            if (key === 'waarschijnlijk_aanwezig' || key === 'motivaction_milieus') {
                if (Array.isArray(value) && value.length > 0 && value[0].milieu) {
                    return renderMotivaction(key, value);
                }
            }

            // Kalender dagen
            if (key === 'dagen' && Array.isArray(value) && value.length > 0 && value[0].datum) {
                return renderKalender(value);
            }

            // Homiletische Plot
            if (key === 'homiletical_plot' || key === 'homiletische_plot') {
                return renderHomiletischePlot(value);
            }

            // Buttrick Moves & Structures
            if (key === 'moves' && Array.isArray(value) && value.length > 0 && value[0].kernidee) {
                return renderButtrickMoves({ moves: value });
            }

            // Preekschets onderdelen (SÃ¶lle, JÃ¼ngel, Noordmans)
            if (key === 'preek_onderdelen' && typeof value === 'object') {
                return renderPreekOnderdelen(value);
            }

            // Bijbelteksten (Naardense Bijbel, NBV21 en Grondtekst)
            if ((key === 'naardense_bijbel' || key === 'nbv21' || key === 'grondtekst') && Array.isArray(value)) {
                return renderBijbelteksten(key, value);
            }

            if (Array.isArray(value)) {
                html += `<div class="data-group">`;
                // Hide title for midjourney_prompts array
                if (key !== 'midjourney_prompts') {
                    html += `<div class="data-group-title">${escapeHtml(formattedKey)}</div>`;
                }
                html += renderArray(value, key);
                html += `</div>`;
            } else if (typeof value === 'object') {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="nested-object">`;
                html += renderObject(value, key);
                html += `</div></div>`;
            } else if (key === 'zoekterm') {
                html += `<div class="data-item">`;
                html += `<div class="data-label">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="data-value"><a href="${getSearchUrl(value, parentKey)}" target="_blank" class="search-term" title="Zoek op DuckDuckGo">${processText(value)}</a></div>`;
                html += `</div>`;
            } else if (key === 'prompt_en') {
                // Special rendering for English Midjourney prompts in monospace font
                html += `<div class="data-item">`;
                html += `<div class="data-label">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="data-value"><span class="search-term">${processText(value)}</span></div>`;
                html += `</div>`;
            } else {
                // For 'categorie' field, replace underscores with spaces
                let displayValue = value;
                if (key === 'categorie' && typeof value === 'string') {
                    displayValue = formatKey(value);
                }
                html += `<div class="data-item">`;
                html += `<div class="data-label">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="data-value">${formatValue(displayValue)}</div>`;
                html += `</div>`;
            }
            return html;
        }

        function renderObjectCompact(obj, context) {
            if (!obj || typeof obj !== 'object') {
                return formatValue(obj);
            }

            let html = '';
            for (const [key, value] of Object.entries(obj)) {
                if (key.startsWith('_')) continue;
                if (value === null || value === undefined) continue;
                if (typeof value === 'boolean') continue;

                // Replace string "null" values
                let displayValue = value;
                if (value === 'null' || value === 'NULL') {
                    displayValue = 'geen gegevens beschikbaar';
                }

                // For 'categorie' field, replace underscores with spaces
                if (key === 'categorie' && typeof value === 'string') {
                    displayValue = formatKey(value);
                }

                if (Array.isArray(value)) {
                    if (value.every(v => typeof v === 'string')) {
                        html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                    } else {
                        html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += renderArray(value, key);
                    }
                } else if (typeof value === 'object') {
                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                    html += `<div style="margin-left: 10px;">${renderObjectCompact(value, key)}</div>`;
                } else if (key === 'zoekterm') {
                    html += `<div style="margin-bottom: 4px;"><a href="${getSearchUrl(displayValue, context)}" target="_blank" class="search-term" title="Zoek op DuckDuckGo">${processText(displayValue)}</a></div>`;
                } else {
                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${formatValue(displayValue)}</div>`;
                }
            }
            return html;
        }

        function renderArray(arr, parentKey = '') {
            if (arr.length === 0) return '<div class="data-value">Geen items</div>';

            // Check if it's a simple array of strings
            if (arr.every(item => typeof item === 'string' || typeof item === 'number')) {
                // Check if short enough for tags
                if (arr.every(item => String(item).length < 40) && arr.length <= 10) {
                    return `<div class="tag-list">${arr.map(item => `<span class="tag">${processText(String(item))}</span>`).join('')}</div>`;
                }
                return `<ul class="array-list">${arr.map(item => `<li class="array-item">${processText(String(item))}</li>`).join('')}</ul>`;
            }

            // Array of objects - check if suitable for grid
            if (arr.every(item => typeof item === 'object') && arr.length >= 1) {
                // Check if objects are simple enough for grid cards
                const isSimpleObjects = arr.every(item => {
                    const entries = Object.entries(item).filter(([k]) => !k.startsWith('_'));
                    // Relaxed check: Allow nested objects if they are not excessive
                    const hasHugeNesting = entries.some(([k, v]) =>
                        typeof v === 'object' &&
                        v !== null &&
                        !Array.isArray(v) &&
                        Object.keys(v).length > 6
                    );
                    return entries.length <= 12 && !hasHugeNesting;
                });

                if (isSimpleObjects) {
                    let html = `<div class="card-grid">`;
                    arr.forEach(item => {
                        // Try to find a title field
                        const titleKey = Object.keys(item).find(k =>
                            ['titel', 'naam', 'name', 'title', 'gebeurtenis', 'trend', 'milieu'].includes(k.toLowerCase())
                        );
                        const title = titleKey ? item[titleKey] : null;

                        html += `<div class="nested-card">`;
                        if (title && typeof title === 'string') {
                            html += `<div class="nested-card-title">${processText(title)}</div>`;
                        }
                        html += `<div class="nested-card-content">`;

                        for (const [key, value] of Object.entries(item)) {
                            if (key.startsWith('_')) continue;
                            if (key === titleKey) continue; // Skip title, already shown
                            if (value === null || value === undefined) continue;
                            if (typeof value === 'boolean') continue;

                            if (key === 'zoekterm') {
                                html += `<div style="margin-top: 6px;"><a href="${getSearchUrl(value, parentKey)}" target="_blank" class="search-term" title="Zoek op DuckDuckGo">${processText(value)}</a></div>`;
                            } else if (Array.isArray(value)) {
                                if (value.every(v => typeof v === 'string') && value.length <= 5) {
                                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                                } else {
                                     html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                                     html += renderArray(value, key);
                                }
                            } else if (typeof value === 'object') {
                                // Handle nested objects (like relevante_scene)
                                html += `<div style="margin-top: 8px; padding-top: 4px; border-top: 1px dashed var(--border-light);"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                                html += `<div style="margin-left: 0; padding-left: 0;">${renderObjectCompact(value, parentKey)}</div>`;
                            } else {
                                // For 'categorie' field, replace underscores with spaces
                                let displayValue = value;
                                if (key === 'categorie' && typeof value === 'string') {
                                    displayValue = formatKey(value);
                                }
                                // Special formatting for prompt_en in monospace font
                                if (key === 'prompt_en') {
                                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> <span class="search-term">${processText(String(displayValue))}</span></div>`;
                                } else {
                                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${formatValue(displayValue)}</div>`;
                                }
                            }
                        }

                        html += `</div></div>`;
                    });
                    html += `</div>`;
                    return html;
                }
            }

            // Default: render each object normally
            return arr.map((item, i) => {
                if (typeof item === 'object') {
                    return `<div class="nested-object">${renderObject(item, parentKey)}</div>`;
                }
                return `<div class="array-item">${formatValue(item)}</div>`;
            }).join('');
        }

        function renderLiedsuggesties(key, value) {
            let html = `<div class="data-group">`;
            
            // Custom titles
            const titles = {
                'liedboek_2013': 'Liedboek (2013)',
                'weerklank': 'Weerklank',
                'weerklank_psalmen': 'Weerklank (Psalmen)',
                'hemelhoog': 'Hemelhoog',
                'op_toonhoogte': 'Op Toonhoogte (2015)'
            };
            const title = titles[key] || formatKey(key);
            
            html += `<div class="data-group-title">${escapeHtml(title)}</div>`;

            // Helper to render grid of songs
            const isLiedboek2013 = (key === 'liedboek_2013');
            const renderGrid = (list) => {
                let gridHtml = `<div class="lied-grid">`;
                list.forEach(lied => {
                    if (typeof lied === 'object') {
                        gridHtml += `<div class="lied-item">`;
                        // Determine fields based on structure (new vs old)
                        const nummer = lied.nummer;
                        const titel = lied.titel;
                        const regel = lied.eerste_regel; // Old
                        const toelichting = lied.toelichting || lied.match_detail; // New fallback
                        const typeMatch = lied.type_match; // New
                        const suggestie = lied.suggestie_gebruik; // New

                        if (typeMatch) gridHtml += `<div style="float:right; font-size:0.7em; background:var(--accent-light); color:white; padding:2px 6px; border-radius:4px;">${processText(typeMatch)}</div>`;

                        // Add nummer with optional info icon for Liedboek 2013
                        if (nummer) {
                            let nummerHtml = `<div class="lied-nummer">${processText(nummer)}`;
                            if (isLiedboek2013 && liedboekUrls[nummer]) {
                                nummerHtml += ` <a href="${liedboekUrls[nummer]}" target="_blank" rel="noopener noreferrer" class="lied-info-icon" title="Achtergrondinformatie op Liedboek Compendium">\u24d8</a>`;
                            }
                            nummerHtml += `</div>`;
                            gridHtml += nummerHtml;
                        }

                        if (titel) gridHtml += `<div class="lied-titel">${processText(titel)}</div>`;
                        if (regel) gridHtml += `<div class="lied-regel">\u201c${processText(regel)}\u201d</div>`;
                        
                        if (suggestie) gridHtml += `<div style="font-size:0.85em; color:var(--accent); margin-top:4px;">Suggestie: ${processText(suggestie)}</div>`;
                        
                        if (toelichting) gridHtml += `<div class="lied-toelichting">${processText(toelichting)}</div>`;
                        gridHtml += `</div>`;
                    }
                });
                gridHtml += `</div>`;
                return gridHtml;
            };

            if (Array.isArray(value)) {
                // NEW STRUCTURE: Direct array of songs
                html += renderGrid(value);
            } else if (typeof value === 'object' && value !== null) {
                // OLD STRUCTURE: nested categories
                for (const [category, liederen] of Object.entries(value)) {
                    if (category.startsWith('_')) continue;
                    if (!Array.isArray(liederen)) continue;

                    html += `<div style="margin-top: 15px; margin-bottom: 8px;"><strong>${escapeHtml(formatKey(category))}</strong></div>`;
                    html += renderGrid(liederen);
                }
            }

            html += `</div>`;
            return html;
        }

        function renderLezingen(value) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Lezingen</div>`;

            // Collect main readings for grid
            let gridCards = [];
            let altLezingen = null;
            let samenhang = null;

            for (const [key, lezing] of Object.entries(value)) {
                if (key.startsWith('_')) continue;

                if (key === 'thematische_samenhang') {
                    samenhang = lezing;
                    continue;
                }

                if (key === 'alternatieve_lezingen' && Array.isArray(lezing)) {
                    altLezingen = lezing;
                    continue;
                }

                if (typeof lezing !== 'object') continue;

                let card = `<div class="lezing-card">`;
                card += `<div class="lezing-label">${escapeHtml(formatKey(key))}</div>`;
                if (lezing.referentie) card += `<div class="lezing-ref">${processText(lezing.referentie)}</div>`;
                if (lezing.thema) card += `<div class="lezing-thema">${processText(lezing.thema)}</div>`;
                if (lezing.antifoon) card += `<div class="lezing-thema">Antifoon: \u201c${processText(lezing.antifoon)}\u201d</div>`;
                card += `</div>`;
                gridCards.push(card);
            }

            // Render main readings in grid
            if (gridCards.length > 0) {
                html += `<div class="card-grid">${gridCards.join('')}</div>`;
            }

            // Thematische samenhang
            if (samenhang && typeof samenhang === 'string') {
                html += `<div class="quote-block"><strong>Thematische samenhang:</strong><br>${processText(samenhang)}</div>`;
            }

            // Alternative readings
            if (altLezingen && altLezingen.length > 0) {
                html += `<div style="margin-top: 15px;"><strong>Alternatieve lezingen</strong></div>`;
                html += `<div class="card-grid">`;
                altLezingen.forEach(alt => {
                    html += `<div class="lezing-card">`;
                    html += `<div class="lezing-ref">${processText(alt.referentie || '')}</div>`;
                    if (alt.reden) html += `<div class="lezing-thema">${processText(alt.reden)}</div>`;
                    html += `</div>`;
                });
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        function renderHoorders(hoorders) {
            let html = '';

            hoorders.forEach(hoorder => {
                html += `<div class="hoorder-card">`;
                // Handle naam as object with voornaam/achternaam or as string
                let naamText = 'Onbekend';
                if (hoorder.naam) {
                    if (typeof hoorder.naam === 'object') {
                        naamText = [hoorder.naam.voornaam, hoorder.naam.achternaam].filter(Boolean).join(' ');
                    } else {
                        naamText = hoorder.naam;
                    }
                }
                html += `<div class="hoorder-naam">${processText(naamText)}</div>`;

                html += `<div class="hoorder-details">`;
                if (hoorder.leeftijd) html += `<div class="hoorder-detail"><strong>Leeftijd:</strong> ${processText(String(hoorder.leeftijd))}</div>`;
                if (hoorder.beroep) html += `<div class="hoorder-detail"><strong>Beroep:</strong> ${processText(hoorder.beroep)}</div>`;
                if (hoorder.gezinssituatie) html += `<div class="hoorder-detail"><strong>Gezin:</strong> ${processText(hoorder.gezinssituatie)}</div>`;
                if (hoorder.kerkelijke_betrokkenheid) html += `<div class="hoorder-detail"><strong>Kerkelijk:</strong> ${processText(hoorder.kerkelijke_betrokkenheid)}</div>`;
                html += `</div>`;

                // Other fields
                for (const [key, value] of Object.entries(hoorder)) {
                    if (['naam', 'leeftijd', 'beroep', 'gezinssituatie', 'kerkelijke_betrokkenheid'].includes(key)) continue;
                    if (key.startsWith('_')) continue;

                    if (typeof value === 'string') {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${processText(value)}</div>`;
                    } else if (Array.isArray(value)) {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<ul style="margin-left: 20px;">`;
                        value.forEach(item => {
                            html += `<li>${processText(String(item))}</li>`;
                        });
                        html += `</ul>`;
                    } else if (typeof value === 'object' && value) {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<div class="nested-object">${renderObject(value, key)}</div>`;
                    }
                }

                html += `</div>`;
            });

            return html;
        }

        function renderGebeden(gebeden) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Gebeden</div>`;

            gebeden.forEach(gebed => {
                if (typeof gebed === 'object') {
                    html += `<div class="gebed-block">`;
                    if (gebed.titel || gebed.type) {
                        html += `<div class="gebed-titel">${processText(gebed.titel || gebed.type || '')}</div>`;
                    }
                    if (gebed.tekst) {
                        html += processText(gebed.tekst);
                    } else if (gebed.inhoud) {
                        html += processText(gebed.inhoud);
                    }
                    html += `</div>`;
                } else if (typeof gebed === 'string') {
                    html += `<div class="gebed-block">${processText(gebed)}</div>`;
                }
            });

            html += `</div>`;
            return html;
        }

        function renderFocusFunctie(opties) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Hieronder een drietal mogelijkheden:</div>`;

            opties.forEach((optie, index) => {
                html += `<div id="section-10_focus_en_functie-optie-${optie.nummer || (index + 1)}" class="subsection-anchor"></div>`;
                html += `<div class="focus-card">`;

                // Header with number and title
                html += `<div class="focus-card-header">`;
                html += `<div class="focus-card-number">${optie.nummer || ''}</div>`;
                html += `<div>`;
                html += `<div class="focus-card-title">${processText(optie.korte_titel || '')}</div>`;
                if (optie.type_insteek) {
                    html += `<span class="focus-card-type">${processText(optie.type_insteek)}</span>`;
                }
                html += `</div></div>`;

                // Two-column layout: left for short content, right for longer content
                html += `<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-top: 10px;">`;

                // Left column: Focus section (usually shorter)
                html += `<div style="display: flex; flex-direction: column; gap: 10px;">`;
                if (optie.focus) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Focus</div>`;
                    // Show the complete focus sentence with the beginning part if not already included
                    let focusContent = '';
                    if (typeof optie.focus === 'string') {
                        focusContent = optie.focus;
                    } else if (typeof optie.focus === 'object' && optie.focus.inhoud) {
                        focusContent = optie.focus.inhoud;
                    }
                    
                    if (focusContent && !focusContent.startsWith('Ik wil op grond van mijn exegese')) {
                        focusContent = `Ik wil op grond van mijn exegese van de tekst voor deze hoorders (in ${jsonData['00_meta']?.plaatsnaam || ''}, ${jsonData['00_meta']?.gemeente || ''}), in hun context, in deze dienst zeggen dat: ${focusContent}`;
                    }
                    html += `<div class="focus-section-content">${processText(focusContent)}</div>`;
                    html += `</div>`;
                }
                html += `</div>`; // end left column

                // Right column: Anticipatie and Functie sections (usually longer content)
                html += `<div style="display: flex; flex-direction: column; gap: 10px;">`;
                
                // Anticipatie logic
                if (optie.anticipatie || optie.anticipatie_analyse) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Anticipatie</div>`;
                    html += `<div class="focus-section-content">`;
                    
                    // 1. Render main string description if available
                    let anticipatieText = '';
                    if (typeof optie.anticipatie === 'string') {
                        anticipatieText = optie.anticipatie;
                    } else if (typeof optie.anticipatie === 'object' && optie.anticipatie.inhoud) {
                         anticipatieText = optie.anticipatie.inhoud;
                    }

                    if (anticipatieText) {
                         html += `<div style="margin-bottom: 10px; font-style: italic;">${processText(anticipatieText)}</div>`;
                    }

                    // 2. Render analysis breakdown (weerstand, herkenning, vragen)
                    // Check both optie.anticipatie (legacy object) and optie.anticipatie_analyse (new separate object)
                    const analyse = optie.anticipatie_analyse || (typeof optie.anticipatie === 'object' ? optie.anticipatie : null);
                    
                    if (analyse) {
                        if (analyse.weerstand) html += `<div style="margin-bottom: 6px;"><strong>Weerstand:</strong> ${processText(analyse.weerstand)}</div>`;
                        if (analyse.herkenning) html += `<div style="margin-bottom: 6px;"><strong>Herkenning:</strong> ${processText(analyse.herkenning)}</div>`;
                        if (analyse.vragen && analyse.vragen.length) {
                            html += `<div><strong>Vragen:</strong><ul style="margin: 4px 0 0 16px;">`;
                            analyse.vragen.forEach(v => html += `<li>${processText(v)}</li>`);
                            html += `</ul></div>`;
                        }
                    }
                    html += `</div></div>`;
                }

                if (optie.functie) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Functie</div>`;
                    // Show the complete functie sentence with the beginning part if not already included
                    let functieContent = '';
                    if (typeof optie.functie === 'string') {
                        functieContent = optie.functie;
                    } else if (typeof optie.functie === 'object' && optie.functie.beoogd_effect) {
                        functieContent = optie.functie.beoogd_effect;
                    }

                    if (functieContent && !functieContent.startsWith('...waarmee ik rekening houd')) {
                        functieContent = `...waarmee ik rekening houd om te komen tot het doel dat de hoorders: ${functieContent}`;
                    }
                    html += `<div class="focus-section-content">${processText(functieContent)}</div>`;
                    html += `</div>`;
                }
                html += `</div>`; // end right column

                html += `</div>`; // end two-column layout

                // Toelichting
                if (optie.toelichting) {
                    html += `<div class="focus-toelichting">${processText(optie.toelichting)}</div>`;
                }

                html += `</div>`; // end focus-card
            });

            html += `</div>`;
            return html;
        }

        function renderKindermoment(opties, sectionKey = '15_kindermoment') {
            let html = '';

            opties.forEach((optie, index) => {
                html += `<div id="section-${sectionKey}-kindermoment-${index + 1}" class="subsection-anchor"></div>`;
                html += `<div class="focus-card">`;

                // Header with type and title
                html += `<div class="focus-card-header">`;
                html += `<div class="focus-card-number">${index + 1}</div>`;
                html += `<div>`;
                html += `<div class="focus-card-title">${processText(optie.titel || '')}</div>`;
                if (optie.type) {
                    html += `<span class="focus-card-type">${processText(mapKindermomentType(optie.type))}</span>`;
                }
                html += `</div></div>`;

                // Two-column layout: left for short content, right for long content (verhaal script)
                html += `<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-top: 10px;">`;

                // Left column: Object, Focus Schriftlezing, Afbeelding Idee (stacked)
                html += `<div style="display: flex; flex-direction: column; gap: 10px;">`;

                // Object section
                if (optie.object) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Object</div>`;
                    html += `<div class="focus-section-content"><strong>${processText(optie.object.naam || '')}</strong><br>${processText(optie.object.uitleg || '')}</div>`;
                    html += `</div>`;
                }

                // Focus Schriftlezing section
                if (optie.focus_schriftlezing) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Focus Schriftlezing</div>`;
                    html += `<div class="focus-section-content">${processText(optie.focus_schriftlezing)}</div>`;
                    html += `</div>`;
                }

                // Afbeelding Idee section
                if (optie.afbeelding_idee) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Afbeelding Idee</div>`;
                    html += `<div class="focus-section-content">${processText(optie.afbeelding_idee)}</div>`;
                    html += `</div>`;
                }

                html += `</div>`; // end left column

                // Right column: Verhaal Script (longer content)
                html += `<div>`;
                if (optie.verhaal_script) {
                    html += `<div class="focus-section" style="height: 100%;">`;
                    html += `<div class="focus-section-title">Verhaal Script</div>`;
                    html += `<div class="focus-section-content" style="height: 100%;">${processText(optie.verhaal_script)}</div>`;
                    html += `</div>`;
                }
                html += `</div>`; // end right column

                html += `</div>`; // end two-column layout
                html += `</div>`; // end focus-card
            });

            return html;
        }

        function renderPositieKerkelijkJaar(data) {
            let html = `<div class="data-group">`;
            html += `<div class="nested-object">`;

            // Create a copy of the data to modify
            const modifiedData = { ...data };

            // Combine leesrooster_jaar and dominant_evangelie if both exist
            if (modifiedData.leesrooster_jaar && modifiedData.dominant_evangelie) {
                modifiedData['Leesrooster & Evangelie'] = `${modifiedData.leesrooster_jaar} (${modifiedData.dominant_evangelie})`;
                // Remove the individual fields
                delete modifiedData.leesrooster_jaar;
                delete modifiedData.dominant_evangelie;
            }

            // Render the modified object
            for (const [key, value] of Object.entries(modifiedData)) {
                if (key.startsWith('_') || value === null || value === undefined) continue;

                if (Array.isArray(value)) {
                    html += `<div class="data-item">`;
                    html += `<div class="data-label">${escapeHtml(formatKey(key))}</div>`;
                    html += `<div class="data-value">${renderArray(value, key)}</div>`;
                    html += `</div>`;
                } else if (typeof value === 'object') {
                    html += `<div class="data-group">`;
                    html += `<div class="data-group-title">${escapeHtml(formatKey(key))}</div>`;
                    html += `<div class="nested-object">`;
                    html += renderObject(value, key);
                    html += `</div></div>`;
                } else {
                    html += `<div class="data-item">`;
                    html += `<div class="data-label">${escapeHtml(formatKey(key))}</div>`;
                    html += `<div class="data-value">${formatValue(value)}</div>`;
                    html += `</div>`;
                }
            }

            html += `</div></div>`;
            return html;
        }

        function renderMotivaction(key, milieus) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">${escapeHtml(formatKey(key))}</div>`;
            html += `<div class="motivaction-grid">`;

            milieus.forEach(milieu => {
                html += `<div class="motivaction-card">`;

                // Header
                html += `<div class="motivaction-header">`;
                html += `<div class="motivaction-title">${processText(milieu.milieu || '')}</div>`;
                if (milieu.geschat_percentage) {
                    html += `<span class="motivaction-percentage">${processText(milieu.geschat_percentage)}</span>`;
                }
                html += `</div>`;

                // Kenmerken
                if (milieu.kenmerken_lokaal) {
                    html += `<div class="motivaction-kenmerken">${processText(milieu.kenmerken_lokaal)}</div>`;
                }

                // Taal die resoneert
                if (milieu.taal_die_resoneert && milieu.taal_die_resoneert.length) {
                    html += `<div class="motivaction-label">Taal die resoneert</div>`;
                    html += `<div class="motivaction-tags">`;
                    milieu.taal_die_resoneert.forEach(t => html += `<span class="motivaction-tag">${processText(t)}</span>`);
                    html += `</div>`;
                }

                // Beelden die werken
                if (milieu.beelden_die_werken && milieu.beelden_die_werken.length) {
                    html += `<div class="motivaction-label">Beelden die werken</div>`;
                    html += `<div class="motivaction-tags">`;
                    milieu.beelden_die_werken.forEach(b => html += `<span class="motivaction-tag">${processText(b)}</span>`);
                    html += `</div>`;
                }

                html += `</div>`; // end motivaction-card
            });

            html += `</div></div>`;
            return html;
        }

        function renderKalender(dagen) {
            let html = '';

            dagen.forEach((dag, index) => {
                html += `<div id="section-11_kalender-dag-${index + 1}" class="subsection-anchor"></div>`;
                const isPreekzondag = dag.is_preekzondag === true;
                html += `<div class="kalender-dag ${isPreekzondag ? 'preekzondag' : ''}">`;
                html += `<div class="kalender-datum">${processText(dag.datum || '')}${isPreekzondag ? ' (Dag van de Viering)' : ''}</div>`;
                html += `<div class="kalender-content">`;

                // Helper to check if value has content
                const hasContent = (val) => {
                    if (val === null || val === undefined) return false;
                    if (Array.isArray(val)) return val.length > 0;
                    if (typeof val === 'object') {
                        return Object.values(val).some(v => v !== null && v !== undefined && v !== '');
                    }
                    return val !== '';
                };

                // Kerkelijk
                if (hasContent(dag.kerkelijk)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Kerkelijk</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.kerkelijk.forEach(k => {
                        html += `<li><strong>${processText(k.naam || '')}</strong>`;
                        if (k.toelichting) html += `<br><span style="font-size: 0.85em; color: var(--text-muted);">${processText(k.toelichting)}</span>`;
                        html += `</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Joods
                if (hasContent(dag.joods)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Joods</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.joods.hebreeuwse_datum) html += `<div>${processText(dag.joods.hebreeuwse_datum)}</div>`;
                    if (dag.joods.feestdag) html += `<div><strong>${processText(dag.joods.feestdag)}</strong></div>`;
                    if (dag.joods.parasja) html += `<div>Parasja: ${processText(dag.joods.parasja)}</div>`;
                    if (dag.joods.toelichting) html += `<div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">${processText(dag.joods.toelichting)}</div>`;
                    html += `</div></div>`;
                }

                // Vakantie
                if (hasContent(dag.vakantie)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Vakantie</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.vakantie.schoolvakantie) html += `<div><strong>${processText(dag.vakantie.schoolvakantie)}</strong></div>`;
                    if (dag.vakantie.regio) html += `<div style="font-size: 0.85em;">${processText(dag.vakantie.regio)}</div>`;
                    html += `</div></div>`;
                }

                // Weer
                if (hasContent(dag.weer)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Weer</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.weer.verwachting) html += `<div>${processText(dag.weer.verwachting)}</div>`;
                    if (dag.weer.temperatuur) html += `<div>${processText(dag.weer.temperatuur)}</div>`;
                    html += `</div></div>`;
                }

                // Astronomie
                if (hasContent(dag.astronomie)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Astronomie</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.astronomie.zonsopgang && dag.astronomie.zonsondergang) {
                        html += `<div>â˜€ ${processText(dag.astronomie.zonsopgang)} - ${processText(dag.astronomie.zonsondergang)}</div>`;
                    }
                    if (dag.astronomie.maanfase) html += `<div>ðŸŒ™ ${processText(dag.astronomie.maanfase)}</div>`;
                    if (dag.astronomie.bijzonderheden) html += `<div style="font-size: 0.85em; margin-top: 4px;">${processText(dag.astronomie.bijzonderheden)}</div>`;
                    html += `</div></div>`;
                }

                // Nationaal
                if (hasContent(dag.nationaal)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Nationaal</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.nationaal.forEach(n => {
                        html += `<li>${processText(n.naam || '')}</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Internationaal
                if (hasContent(dag.internationaal)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Internationaal</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.internationaal.forEach(i => {
                        html += `<li>${processText(i.naam || '')}</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Overig
                if (hasContent(dag.overig)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Overig</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.overig.forEach(o => {
                        html += `<li><strong>${processText(o.naam || '')}</strong>`;
                        if (o.toelichting) html += `<br><span style="font-size: 0.85em; color: var(--text-muted);">${processText(o.toelichting)}</span>`;
                        html += `</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                html += `</div></div>`; // end kalender-content, kalender-dag
            });

            return html;
        }

        function renderChapellBrug(data) {
            let html = '';
            const sectionKey = '13c_homiletische_fundering_chapell';

            // Extract the actual data from the nested structure
            const chapellData = data.homiletische_fundering_chapell || data;

            // Methodiek Uitleg (optional intro)
            if (data.methodiek_uitleg) {
                if (data.methodiek_uitleg.benadering) {
                    html += `<div class="quote-block">${processText(data.methodiek_uitleg.benadering)}</div>`;
                }
                if (data.methodiek_uitleg.afkortingen) {
                    html += `<div style="margin-top: 15px;"><strong>Afkortingen:</strong></div>`;
                    html += `<div class="data-pairs" style="margin-top: 10px;">`;
                    for (const [key, value] of Object.entries(data.methodiek_uitleg.afkortingen)) {
                        html += `<div class="data-pair">`;
                        html += `<div class="data-pair-label">${escapeHtml(key)}</div>`;
                        html += `<div class="data-pair-value">${processText(value)}</div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                }
            }

            // Add separator if methodiek_uitleg was shown
            if (data.methodiek_uitleg) {
                html += `<hr style="margin: 30px 0; border: none; border-top: 2px solid var(--border-light);">`;
            }

            // GCF Section (Gevallen Conditie Focus)
            if (chapellData.gcf) {
                html += `<div id="section-${sectionKey}-gcf" class="subsection-anchor"></div>`;
                html += `<div class="buttrick-move" style="border-left-color: #e57373;">`;
                html += `<div class="buttrick-move-header">`;
                html += `<div class="buttrick-move-badge" style="background: #e57373;">Gevallen Conditie Focus</div>`;
                html += `</div>`;
                html += `<div class="buttrick-move-content">`;
                if (chapellData.gcf.beschrijving) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-title">Beschrijving</div>`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.gcf.beschrijving)}</div>`;
                    html += `</div>`;
                }
                if (chapellData.gcf.waarom_vraag) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-title">Waarom-vraag</div>`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.gcf.waarom_vraag)}</div>`;
                    html += `</div>`;
                }
                html += `</div></div>`;
            }

            // Christocentrische Duiding
            if (chapellData.christocentrische_duiding) {
                html += `<div id="section-${sectionKey}-christocentrische_duiding" class="subsection-anchor"></div>`;
                html += `<div class="buttrick-move" style="border-left-color: #f57c00;">`;
                html += `<div class="buttrick-move-header">`;
                html += `<div class="buttrick-move-badge" style="background: #f57c00;">Christocentrische Duiding</div>`;
                html += `</div>`;
                html += `<div class="buttrick-move-content">`;
                if (chapellData.christocentrische_duiding.categorie) {
                    html += `<div class="buttrick-move-meta">`;
                    html += `<span class="buttrick-move-tag strategy">${processText(chapellData.christocentrische_duiding.categorie)}</span>`;
                    html += `</div>`;
                }
                if (chapellData.christocentrische_duiding.uitleg) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.christocentrische_duiding.uitleg)}</div>`;
                    html += `</div>`;
                }
                if (chapellData.christocentrische_duiding.motivatie_heiliging) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-title">Motivatie tot Heiliging</div>`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.christocentrische_duiding.motivatie_heiliging)}</div>`;
                    html += `</div>`;
                }
                html += `</div></div>`;
            }

            // Motivatie & Genade
            if (chapellData.motivatie_genade) {
                html += `<div id="section-${sectionKey}-motivatie_genade" class="subsection-anchor"></div>`;
                html += `<div class="buttrick-move" style="border-left-color: #81c784;">`;
                html += `<div class="buttrick-move-header">`;
                html += `<div class="buttrick-move-badge" style="background: #81c784;">Motivatie & Genade</div>`;
                html += `</div>`;
                html += `<div class="buttrick-move-content">`;
                if (chapellData.motivatie_genade.genade_indicatief) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-title">Genade (Indicatief)</div>`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.motivatie_genade.genade_indicatief)}</div>`;
                    html += `</div>`;
                }
                if (chapellData.motivatie_genade.motivatie_heiliging) {
                    html += `<div class="buttrick-move-section">`;
                    html += `<div class="buttrick-move-section-title">Motivatie (Heiliging)</div>`;
                    html += `<div class="buttrick-move-section-text">${processText(chapellData.motivatie_genade.motivatie_heiliging)}</div>`;
                    html += `</div>`;
                }
                html += `</div></div>`;
            }

            // Expositorisch Raamwerk (Double Helix)
            if (chapellData.expositorisch_raamwerk) {
                html += `<div id="section-${sectionKey}-expositorisch_raamwerk" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Expositorisch Raamwerk (Double Helix)</div>`;
                html += `<div class="buttrick-container">`;

                const points = Object.entries(chapellData.expositorisch_raamwerk)
                    .filter(([k]) => k.startsWith('hoofdpunt'))
                    .sort();

                const pointColors = ['#64b5f6', '#7986cb', '#9575cd', '#ba68c8', '#f06292', '#ff8a65'];

                points.forEach(([key, point], index) => {
                    const color = pointColors[index % pointColors.length];
                    html += `<div class="buttrick-move" style="border-left-color: ${color};">`;
                    html += `<div class="buttrick-move-header">`;
                    html += `<div class="buttrick-move-badge" style="background: ${color};">Hoofdpunt ${index + 1}</div>`;
                    html += `</div>`;
                    html += `<div class="buttrick-move-content">`;

                    if (point.tekst_basis) {
                        html += `<div class="buttrick-move-section">`;
                        html += `<div class="buttrick-move-section-title">Tekstbasis</div>`;
                        html += `<div class="buttrick-move-section-text">${processText(point.tekst_basis)}</div>`;
                        html += `</div>`;
                    }
                    if (point.relatie_fcf) {
                        html += `<div class="buttrick-move-section">`;
                        html += `<div class="buttrick-move-section-title">Relatie tot FCF</div>`;
                        html += `<div class="buttrick-move-section-text">${processText(point.relatie_fcf)}</div>`;
                        html += `</div>`;
                    }
                    if (point.beweging) {
                        html += `<div class="buttrick-move-section">`;
                        html += `<div class="buttrick-move-section-title">Beweging</div>`;
                        html += `<div class="buttrick-move-section-text">${processText(point.beweging)}</div>`;
                        html += `</div>`;
                    }
                    if (point.illustratie_idee) {
                        html += `<div class="buttrick-verbinding">${processText(point.illustratie_idee)}</div>`;
                    }

                    html += `</div></div>`;
                });

                html += `</div></div>`;
            }

            return html;
        }

        function renderPreekOnderdelen(onderdelen) {
            let html = '';

            // Handle array format (JÃ¼ngel, Brueggemann)
            if (Array.isArray(onderdelen)) {
                onderdelen.forEach((onderdeel, index) => {
                    const titel = onderdeel.titel || `Deel ${index + 1}`;
                    const inhoud = onderdeel.inhoud || '';

                    html += `<div class="gebed-card" style="margin-bottom: 30px;">`;
                    html += `<div class="gebed-card-header">`;
                    html += `<span class="gebed-type-badge">${onderdeel.volgorde || index + 1}</span>`;
                    html += `<span class="gebed-aanspraak">${processText(titel)}</span>`;
                    html += `</div>`;
                    html += `<div class="gebed-tekst">${processText(inhoud)}</div>`;

                    // Show toelichting if present
                    if (onderdeel.toelichting) {
                        html += `<div class="gebed-instructie" style="margin-top: 15px;">${processText(onderdeel.toelichting)}</div>`;
                    }

                    html += `</div>`;
                });
            } else {
                // Handle object format (SÃ¶lle, Noordmans)
                let counter = 1;
                for (const [key, value] of Object.entries(onderdelen)) {
                    if (!value || typeof value !== 'object') continue;

                    const titel = value.titel || formatKey(key);
                    const inhoud = value.inhoud || '';

                    html += `<div class="gebed-card" style="margin-bottom: 30px;">`;
                    html += `<div class="gebed-card-header">`;
                    html += `<span class="gebed-type-badge">${counter}</span>`;
                    html += `<span class="gebed-aanspraak">${processText(titel)}</span>`;
                    html += `</div>`;
                    html += `<div class="gebed-tekst">${processText(inhoud)}</div>`;
                    html += `</div>`;

                    counter++;
                }
            }

            return html;
        }

        function renderHomiletischePlot(plot) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Homiletische Plot</div>`;
            html += `<div class="plot-container">`;

            // Mapping of keys to Dutch abbreviations
            const plotStages = [
                { key: 'he_kwestie_oops', name: 'He' },
                { key: 'oei_verdieping_ugh', name: 'Oei' },
                { key: 'aha_wending_aha', name: 'Aha' },
                { key: 'ja_verkondiging_whee', name: 'Ja' },
                { key: 'zo_doorwerking_yeah', name: 'Zo' }
            ];

            plotStages.forEach(stage => {
                const data = plot[stage.key];
                if (!data) return;

                html += `<div class="plot-card">`;
                html += `<div class="plot-header">`;
                html += `<div class="plot-badge">${stage.name}</div>`;
                html += `<div>`;
                if (data.titel) {
                    // Extract only the part after " - " (e.g., "ZÃ“! (YEAH!) - De Doorwerking" â†’ "De Doorwerking")
                    const titelParts = data.titel.split(/\s*-\s*/);
                    const cleanTitel = titelParts.length > 1 ? titelParts.slice(1).join(' - ') : data.titel;
                    html += `<div class="plot-title">${processText(cleanTitel)}</div>`;
                }
                if (data.doel) {
                    html += `<div class="plot-doel">${processText(data.doel)}</div>`;
                }
                html += `</div></div>`;

                html += `<div class="plot-content">`;

                // Render all other fields
                for (const [key, value] of Object.entries(data)) {
                    if (['titel', 'doel'].includes(key)) continue;
                    if (key.startsWith('_')) continue;
                    if (value === null || value === undefined) continue;
                    if (typeof value === 'boolean') continue;

                    if (Array.isArray(value)) {
                        // Handle arrays (like waarom_keten)
                        if (value.length > 0 && typeof value[0] === 'object' && value[0].vraag) {
                            // Waarom-keten format
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong><ul style="margin-left: 16px; margin-top: 6px;">`;
                            value.forEach(item => {
                                html += `<li><strong>V:</strong> ${processText(item.vraag || '')}<br><strong>A:</strong> ${processText(item.antwoord || '')}</li>`;
                            });
                            html += `</ul></div>`;
                        } else if (value.every(v => typeof v === 'string')) {
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                        } else {
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong><ul style="margin-left: 16px; margin-top: 6px;">`;
                            value.forEach(item => {
                                html += `<li>${processText(typeof item === 'string' ? item : JSON.stringify(item))}</li>`;
                            });
                            html += `</ul></div>`;
                        }
                    } else if (typeof value === 'object') {
                        html += `<div><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<div style="margin-left: 16px;">`;
                        for (const [subKey, subVal] of Object.entries(value)) {
                            if (subVal !== null && subVal !== undefined && typeof subVal !== 'object' && typeof subVal !== 'boolean') {
                                html += `<div><strong>${escapeHtml(formatKey(subKey))}:</strong> ${processText(String(subVal))}</div>`;
                            }
                        }
                        html += `</div>`;
                    } else {
                        // Format the value for type_omkering to remove underscores and make it italic
                        if (key === 'type_omkering') {
                            const displayValue = formatKey(String(value));
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong> <em>${processText(displayValue)}</em></div>`;
                        } else {
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong> ${processText(String(value))}</div>`;
                        }
                    }
                }

                html += `</div></div>`; // end plot-content, plot-card
            });

            html += `</div></div>`; // end plot-container, data-group
            return html;
        }

        // Render Buttrick Moves & Structures
        function renderButtrickMoves(data) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Moves & Structures</div>`;
            html += `<div class="buttrick-container">`;

            // Render introductie if present
            if (data.introductie) {
                html += `<div class="buttrick-intro">`;
                html += `<div class="buttrick-intro-header">`;
                html += `<div class="buttrick-intro-badge">Intro</div>`;
                html += `<div>`;
                html += `<div class="buttrick-intro-title">Introductie</div>`;
                if (data.introductie.focus_beeld) {
                    html += `<div class="buttrick-intro-subtitle">${processText(data.introductie.focus_beeld)}</div>`;
                }
                html += `</div></div>`;
                if (data.introductie.uitgeschreven_tekst) {
                    html += `<div class="buttrick-text">${processText(data.introductie.uitgeschreven_tekst)}</div>`;
                }
                if (data.introductie.hermeneutische_orientatie) {
                    html += `<div class="buttrick-verbinding"><strong>Hermeneutische oriÃ«ntatie:</strong> ${processText(data.introductie.hermeneutische_orientatie)}</div>`;
                }
                html += `</div>`;
            }

            // Render moves
            if (data.moves && Array.isArray(data.moves)) {
                data.moves.forEach((move, index) => {
                    const moveNum = move.move_nummer || (index + 1);
                    html += `<div class="buttrick-move">`;
                    html += `<div class="buttrick-move-header">`;
                    html += `<div class="buttrick-move-badge">${moveNum}</div>`;
                    html += `<div class="buttrick-move-info">`;
                    if (move.kernidee) {
                        html += `<div class="buttrick-move-kernidee">${processText(move.kernidee)}</div>`;
                    }

                    // Meta tags
                    html += `<div class="buttrick-move-meta">`;
                    if (move.retorische_strategie) {
                        const strategyLabels = {
                            'bringing_out': 'Bringing Out',
                            'associating': 'Associating',
                            'dissociating': 'Dissociating'
                        };
                        const label = strategyLabels[move.retorische_strategie] || move.retorische_strategie;
                        html += `<span class="buttrick-move-tag strategy">${escapeHtml(label)}</span>`;
                    }
                    if (move.woorden_telling) {
                        html += `<span class="buttrick-move-tag">${move.woorden_telling} woorden</span>`;
                    }
                    html += `</div>`;

                    // Perspectief
                    if (move.perspectief && typeof move.perspectief === 'object') {
                        html += `<div class="buttrick-perspectief">`;
                        const perspLabels = {
                            'stance': 'Stance',
                            'orientation': 'OriÃ«ntatie',
                            'distance': 'Afstand',
                            'focal_field': 'Focusveld'
                        };
                        for (const [key, val] of Object.entries(move.perspectief)) {
                            if (val) {
                                html += `<div class="buttrick-perspectief-item">`;
                                html += `<div class="buttrick-perspectief-label">${perspLabels[key] || formatKey(key)}</div>`;
                                html += `<div class="buttrick-perspectief-value">${processText(String(val))}</div>`;
                                html += `</div>`;
                            }
                        }
                        html += `</div>`;
                    }
                    html += `</div></div>`; // end move-info, move-header

                    // Uitgeschreven tekst
                    html += `<div class="buttrick-move-content">`;
                    if (move.uitgeschreven_tekst && typeof move.uitgeschreven_tekst === 'object') {
                        const sections = ['opening', 'ontwikkeling', 'contrapuntaal', 'closure'];
                        const sectionLabels = {
                            'opening': 'Opening',
                            'ontwikkeling': 'Ontwikkeling',
                            'contrapuntaal': 'Contrapuntaal',
                            'closure': 'Closure'
                        };
                        sections.forEach(sec => {
                            if (move.uitgeschreven_tekst[sec]) {
                                html += `<div class="buttrick-move-section">`;
                                html += `<div class="buttrick-move-section-title">${sectionLabels[sec]}</div>`;
                                html += `<div class="buttrick-move-section-text">${processText(move.uitgeschreven_tekst[sec])}</div>`;
                                html += `</div>`;
                            }
                        });
                    }

                    // Verbindingen
                    if (move.verbinding_vorige || move.verbinding_volgende) {
                        html += `<div class="buttrick-verbinding">`;
                        if (move.verbinding_vorige) {
                            html += `<div><strong>â† Verbinding vorige:</strong> ${processText(move.verbinding_vorige)}</div>`;
                        }
                        if (move.verbinding_volgende) {
                            html += `<div><strong>â†’ Verbinding volgende:</strong> ${processText(move.verbinding_volgende)}</div>`;
                        }
                        html += `</div>`;
                    }

                    html += `</div></div>`; // end move-content, buttrick-move
                });
            }

            // Render conclusie
            if (data.conclusie) {
                html += `<div class="buttrick-conclusie">`;
                html += `<div class="buttrick-conclusie-header">`;
                html += `<div class="buttrick-conclusie-badge">Slot</div>`;
                html += `<div>`;
                html += `<div class="buttrick-conclusie-title">Conclusie</div>`;
                if (data.conclusie.intentie) {
                    html += `<div class="buttrick-conclusie-subtitle">${processText(data.conclusie.intentie)}</div>`;
                }
                html += `</div></div>`;
                if (data.conclusie.uitgeschreven_tekst) {
                    html += `<div class="buttrick-text">${processText(data.conclusie.uitgeschreven_tekst)}</div>`;
                }
                if (data.conclusie.verzamelde_beelden && Array.isArray(data.conclusie.verzamelde_beelden)) {
                    html += `<div class="buttrick-beelden">`;
                    data.conclusie.verzamelde_beelden.forEach(beeld => {
                        html += `<span class="buttrick-beeld-tag">${processText(beeld)}</span>`;
                    });
                    html += `</div>`;
                }
                html += `</div>`;
            }

            html += `</div></div>`; // end buttrick-container, data-group
            return html;
        }

        // Render Exegese section
        function renderExegeseSection(data, sectionKey = '08a_exegese') {
            let html = '';

            // Render per lezing
            if (data.per_lezing && Array.isArray(data.per_lezing)) {
                data.per_lezing.forEach((lezing, index) => {
                    html += `<div id="section-${sectionKey}-lezing-${index + 1}" class="subsection-anchor"></div>`;
                    html += `<div class="data-group">`;
                    html += `<div class="data-group-title">${escapeHtml(lezing.referentie || `Lezing ${index + 1}`)}</div>`;

                    // Afbakening vertaling
                    if (lezing.afbakening_vertaling) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Afbakening Vertaling</div>`;

                        if (lezing.afbakening_vertaling.vertaalvergelijking && Array.isArray(lezing.afbakening_vertaling.vertaalvergelijking)) {
                            html += `<div class="data-group"><div class="data-group-title">Vertaalvergelijking</div>`;
                            lezing.afbakening_vertaling.vertaalvergelijking.forEach(vergelijking => {
                                html += `<div class="nested-card">`;
                                html += `<div class="nested-card-title">${escapeHtml(vergelijking.vertaling)}</div>`;
                                html += `<div class="nested-card-content">${processText(vergelijking.significante_verschillen || '')}</div>`;
                                html += `</div>`;
                            });
                            html += `</div>`;
                        }

                        if (lezing.afbakening_vertaling.werkvertaling_cruciaal) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Werkvertaling</div>`;
                            html += `<div class="data-value">${processText(lezing.afbakening_vertaling.werkvertaling_cruciaal)}</div>`;
                            html += `</div>`;
                        }

                        html += `</div>`;
                    }

                    // Tekstkritiek
                    if (lezing.tekskritiek) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Tekstkritiek</div>`;

                        if (lezing.tekskritiek.relevante_varianten && Array.isArray(lezing.tekskritiek.relevante_varianten)) {
                            html += `<div class="data-group"><div class="data-group-title">Relevante Varianten</div>`;
                            lezing.tekskritiek.relevante_varianten.forEach(variant => {
                                html += `<div class="nested-card">`;
                                html += `<div class="nested-card-title">Vers ${variant.vers}</div>`;
                                html += `<div class="nested-card-content">`;
                                html += `<div><strong>Variant:</strong> ${processText(variant.variant || '')}</div>`;
                                html += `<div><strong>Handschriften:</strong> ${processText(variant.handschriften || '')}</div>`;
                                html += `<div><strong>Betekenis Impact:</strong> ${processText(variant.betekenis_impact || '')}</div>`;
                                html += `</div>`;
                                html += `</div>`;
                            });
                            html += `</div>`;
                        }

                        if (lezing.tekskritiek.conclusie) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Conclusie</div>`;
                            html += `<div class="data-value">${processText(lezing.tekskritiek.conclusie)}</div>`;
                            html += `</div>`;
                        }

                        html += `</div>`;
                    }

                    // Woordstudie
                    if (lezing.woordstudie && Array.isArray(lezing.woordstudie)) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Woordstudie</div>`;
                        html += `<div class="data-group"><div class="data-group-title">Woorden</div>`;

                        lezing.woordstudie.forEach(woord => {
                            html += `<div class="nested-card">`;
                            html += `<div class="nested-card-title">${escapeHtml(woord.woord_origineel || '')} (${escapeHtml(woord.transliteratie || '')})</div>`;
                            html += `<div class="nested-card-content">`;
                            html += `<div><strong>Vertaling:</strong> ${processText(woord.vertaling || '')}</div>`;
                            html += `<div><strong>Semantische Range:</strong> ${processText(woord.semantische_range || '')}</div>`;
                            html += `<div><strong>Gebruik Elders:</strong> ${processText(woord.gebruik_elders || '')}</div>`;
                            if (woord.meerduidigheid) {
                                html += `<div><strong>Meerduidigheid:</strong> ${processText(woord.meerduidigheid)}</div>`;
                            }
                            html += `</div>`;
                            html += `</div>`;
                        });

                        html += `</div></div>`;
                    }

                    // Literaire Analyse
                    if (lezing.literaire_analyse) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Literaire Analyse</div>`;

                        if (lezing.literaire_analyse.genre) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Genre</div>`;
                            html += `<div class="data-value">${processText(lezing.literaire_analyse.genre)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.literaire_analyse.genre_conventies) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Genre Conventies</div>`;
                            html += `<div class="data-value">${processText(lezing.literaire_analyse.genre_conventies)}</div>`;
                            html += `</div>`;
                        }

                        // Structuur
                        if (lezing.literaire_analyse.structuur) {
                            html += `<div class="data-group"><div class="data-group-title">Structuur</div>`;

                            if (lezing.literaire_analyse.structuur.opbouw) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Opbouw</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.structuur.opbouw)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.structuur.cesuren && Array.isArray(lezing.literaire_analyse.structuur.cesuren)) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Cesuren</div>`;
                                html += `<div class="data-value"><ul>`;
                                lezing.literaire_analyse.structuur.cesuren.forEach(cesuur => {
                                    html += `<li>${processText(cesuur)}</li>`;
                                });
                                html += `</ul></div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.structuur.centrum) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Centrum</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.structuur.centrum)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.structuur.chiasme_inclusio) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Chiasme/Inclusio</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.structuur.chiasme_inclusio)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        // Stijl & Retoriek
                        if (lezing.literaire_analyse.stijl_retoriek) {
                            html += `<div class="data-group"><div class="data-group-title">Stijl & Retoriek</div>`;

                            if (lezing.literaire_analyse.stijl_retoriek.literaire_middelen && Array.isArray(lezing.literaire_analyse.stijl_retoriek.literaire_middelen)) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Literaire Middelen</div>`;
                                html += `<div class="data-value"><ul>`;
                                lezing.literaire_analyse.stijl_retoriek.literaire_middelen.forEach(middel => {
                                    html += `<li>${processText(middel)}</li>`;
                                });
                                html += `</ul></div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.stijl_retoriek.retorische_strategie) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Retorische Strategie</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.stijl_retoriek.retorische_strategie)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.stijl_retoriek.effect_lezer) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Effect Lezer</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.stijl_retoriek.effect_lezer)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        // Karakters & Plot
                        if (lezing.literaire_analyse.karakters_plot) {
                            html += `<div class="data-group"><div class="data-group-title">Karakters & Plot</div>`;

                            if (lezing.literaire_analyse.karakters_plot.personages && Array.isArray(lezing.literaire_analyse.karakters_plot.personages)) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Personages</div>`;
                                html += `<div class="data-value"><ul>`;
                                lezing.literaire_analyse.karakters_plot.personages.forEach(personage => {
                                    html += `<li>${processText(personage)}</li>`;
                                });
                                html += `</ul></div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.karakters_plot.karakterisering) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Karakterisering</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.karakters_plot.karakterisering)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.karakters_plot.verhaallijn) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Verhaallijn</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.karakters_plot.verhaallijn)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.literaire_analyse.karakters_plot.verzwegen_gesuggereerd) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Verzwegen/Gesuggereerd</div>`;
                                html += `<div class="data-value">${processText(lezing.literaire_analyse.karakters_plot.verzwegen_gesuggereerd)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        html += `</div>`;
                    }

                    // Theologische Analyse
                    if (lezing.theologische_analyse) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Theologische Analyse</div>`;

                        if (lezing.theologische_analyse.centrale_boodschap) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Centrale Boodschap</div>`;
                            html += `<div class="data-value">${processText(lezing.theologische_analyse.centrale_boodschap)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.godsbeeld) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Godsbeeld</div>`;
                            html += `<div class="data-value">${processText(lezing.theologische_analyse.godsbeeld)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.mensbeeld_wereld_heil) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Mensbeeld/Wereld/Heil</div>`;
                            html += `<div class="data-value">${processText(lezing.theologische_analyse.mensbeeld_wereld_heil)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.bijbels_theologische_lijnen && Array.isArray(lezing.theologische_analyse.bijbels_theologische_lijnen)) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Bijbels Theologische Lijnen</div>`;
                            html += `<div class="data-value"><ul>`;
                            lezing.theologische_analyse.bijbels_theologische_lijnen.forEach(lijn => {
                                html += `<li>${processText(lijn)}</li>`;
                            });
                            html += `</ul></div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.plaats_heilsgeschiedenis) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Plaats in Heilsgeschiedenis</div>`;
                            html += `<div class="data-value">${processText(lezing.theologische_analyse.plaats_heilsgeschiedenis)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.spanning_andere_teksten) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Spanning met Andere Teksten</div>`;
                            html += `<div class="data-value">${processText(lezing.theologische_analyse.spanning_andere_teksten)}</div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.dogmatische_raakvlakken && Array.isArray(lezing.theologische_analyse.dogmatische_raakvlakken)) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Dogmatische Raakvlakken</div>`;
                            html += `<div class="data-value"><ul>`;
                            lezing.theologische_analyse.dogmatische_raakvlakken.forEach(raakvlak => {
                                html += `<li>${processText(raakvlak)}</li>`;
                            });
                            html += `</ul></div>`;
                            html += `</div>`;
                        }

                        if (lezing.theologische_analyse.theologische_controverses && Array.isArray(lezing.theologische_analyse.theologische_controverses)) {
                            html += `<div class="data-item">`;
                            html += `<div class="data-label">Theologische Controverses</div>`;
                            html += `<div class="data-value"><ul>`;
                            lezing.theologische_analyse.theologische_controverses.forEach(controverse => {
                                html += `<li>${processText(controverse)}</li>`;
                            });
                            html += `</ul></div>`;
                            html += `</div>`;
                        }

                        html += `</div>`;
                    }

                    // Zoekmodellen Snoek
                    if (lezing.zoekmodellen_snoek) {
                        html += `<div class="nested-object">`;
                        html += `<div class="nested-title">Zoekmodellen Snoek</div>`;

                        // Godsbeelden OT
                        if (lezing.zoekmodellen_snoek.godsbeelden_ot) {
                            html += `<div class="data-group"><div class="data-group-title">Godsbeelden OT</div>`;

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.werkwoordelijke_uitspraken) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Werkwoordelijke Uitspraken</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.werkwoordelijke_uitspraken)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.metaforische_uitspraken) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Metaforische Uitspraken</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.metaforische_uitspraken)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.overstijgende_eigenschappen) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Overstijgende Eigenschappen</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.overstijgende_eigenschappen)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.toebuigende_eigenschappen) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Toebuigende Eigenschappen</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.toebuigende_eigenschappen)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.dominante_categorie) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Dominante Categorie</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.dominante_categorie)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.spanning) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Spanning</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.spanning)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.godsbeelden_ot.relevantie_gemeente) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Relevantie Gemeente</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.godsbeelden_ot.relevantie_gemeente)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        // Mensbeelden OT
                        if (lezing.zoekmodellen_snoek.mensbeelden_ot) {
                            html += `<div class="data-group"><div class="data-group-title">Mensbeelden OT</div>`;

                            if (lezing.zoekmodellen_snoek.mensbeelden_ot.horizontale_as) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Horizontale As</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.mensbeelden_ot.horizontale_as)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.mensbeelden_ot.verticale_as) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Verticale As</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.mensbeelden_ot.verticale_as)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.mensbeelden_ot.personages_positie) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Personages Positie</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.mensbeelden_ot.personages_positie)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.mensbeelden_ot.karakterontwikkeling) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Karakterontwikkeling</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.mensbeelden_ot.karakterontwikkeling)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        // Jezusbeelden NT
                        if (lezing.zoekmodellen_snoek.jezusbeelden_nt) {
                            html += `<div class="data-group"><div class="data-group-title">Jezusbeelden NT</div>`;

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.van_achteren) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Van Achteren</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.van_achteren)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.van_boven) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Van Boven</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.van_boven)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.van_beneden) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Van Beneden</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.van_beneden)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.van_voren) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Van Voren</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.van_voren)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.dominant_perspectief) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Dominant Perspectief</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.dominant_perspectief)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.spanning_godheid_mensheid) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Spanning Godheid-Mensheid</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.spanning_godheid_mensheid)}</div>`;
                                html += `</div>`;
                            }

                            if (lezing.zoekmodellen_snoek.jezusbeelden_nt.betekenis_hoorders_nu) {
                                html += `<div class="data-item">`;
                                html += `<div class="data-label">Betekenis Hoorders Nu</div>`;
                                html += `<div class="data-value">${processText(lezing.zoekmodellen_snoek.jezusbeelden_nt.betekenis_hoorders_nu)}</div>`;
                                html += `</div>`;
                            }

                            html += `</div>`;
                        }

                        html += `</div>`;
                    }

                    html += `</div>`;
                });
            }

            // Samenhang lezingen
            if (data.samenhang_lezingen) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Samenhang Lezingen</div>`;

                if (data.samenhang_lezingen.rode_draad) {
                    html += `<div class="data-item">`;
                    html += `<div class="data-label">Rode Draad</div>`;
                    html += `<div class="data-value">${processText(data.samenhang_lezingen.rode_draad)}</div>`;
                    html += `</div>`;
                }

                if (data.samenhang_lezingen.versterkingen && Array.isArray(data.samenhang_lezingen.versterkingen)) {
                    html += `<div class="data-item">`;
                    html += `<div class="data-label">Versterkingen</div>`;
                    html += `<div class="data-value"><ul>`;
                    data.samenhang_lezingen.versterkingen.forEach(versterking => {
                        html += `<li>${processText(versterking)}</li>`;
                    });
                    html += `</ul></div>`;
                    html += `</div>`;
                }

                if (data.samenhang_lezingen.correcties && Array.isArray(data.samenhang_lezingen.correcties)) {
                    html += `<div class="data-item">`;
                    html += `<div class="data-label">Correcties</div>`;
                    html += `<div class="data-value"><ul>`;
                    data.samenhang_lezingen.correcties.forEach(correctie => {
                        html += `<li>${processText(correctie)}</li>`;
                    });
                    html += `</ul></div>`;
                    html += `</div>`;
                }

                html += `</div>`;
            }

            return html;
        }

        // Render Representatieve Hoorders section
        function renderHoordersSection(data) {
            let html = '';
            const personas = data.personas || [];

            personas.forEach(persona => {
                const naam = persona.naam ? `${persona.naam.voornaam} ${persona.naam.achternaam}` : 'Onbekend';
                const leeftijd = persona.leeftijd || '';
                const woonwijk = persona.basisgegevens?.woonwijk || '';

                html += `<div id="section-12_representatieve_hoorders-personas-${persona.nummer}" class="subsection-anchor"></div>`;
                html += `<div class="hoorder-card">`;

                // Header
                html += `<div class="hoorder-header">`;
                html += `<div class="hoorder-nummer">${persona.nummer || ''}</div>`;
                html += `<div class="hoorder-intro">`;
                html += `<div class="hoorder-naam">${smartQuotes(escapeHtml(naam))}</div>`;
                html += `<div class="hoorder-meta">${leeftijd} jaar${woonwijk ? ` Â· ${smartQuotes(escapeHtml(woonwijk))}` : ''}</div>`;
                html += `</div></div>`;

                // Kernschets
                if (persona.kernschets) {
                    html += `<div class="hoorder-kernschets">${processText(persona.kernschets)}</div>`;
                }

                html += `<div class="hoorder-content">`;
                html += `<div class="hoorder-grid">`;

                // Persoonlijk (basis + gezondheid)
                html += `<div class="hoorder-groep">`;
                html += `<div class="hoorder-groep-titel">Persoonlijk</div>`;
                if (persona.basisgegevens?.fysieke_verschijning) {
                    html += `<div class="hoorder-item">${processText(persona.basisgegevens.fysieke_verschijning)}</div>`;
                }
                if (persona.gezondheid) {
                    const gz = persona.gezondheid;
                    if (gz.lichamelijk) html += `<div class="hoorder-item"><span class="hoorder-item-label">Lichamelijk:</span> ${processText(gz.lichamelijk)}</div>`;
                    if (gz.mentaal) html += `<div class="hoorder-item"><span class="hoorder-item-label">Mentaal:</span> ${processText(gz.mentaal)}</div>`;
                    if (gz.leefstijl) html += `<div class="hoorder-item"><span class="hoorder-item-label">Leefstijl:</span> ${processText(gz.leefstijl)}</div>`;
                }
                html += `</div>`;

                // Relaties
                if (persona.relaties_sociaal) {
                    const rel = persona.relaties_sociaal;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Relaties & Sociaal</div>`;
                    const relInfo = [];
                    if (rel.relatiestatus) relInfo.push(rel.relatiestatus);
                    if (rel.woonsituatie) relInfo.push(rel.woonsituatie);
                    if (rel.kinderen) relInfo.push(rel.kinderen);
                    if (relInfo.length > 0) {
                        html += `<div class="hoorder-item">${processText(relInfo.join(' Â· '))}</div>`;
                    }
                    if (rel.familie_relatie) html += `<div class="hoorder-item">${processText(rel.familie_relatie)}</div>`;
                    if (rel.sociaal_netwerk) html += `<div class="hoorder-item">${processText(rel.sociaal_netwerk)}</div>`;
                    html += `</div>`;
                }

                // Werk & Opleiding
                if (persona.opleiding_werk) {
                    const ow = persona.opleiding_werk;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Werk & Opleiding</div>`;
                    if (ow.opleiding) html += `<div class="hoorder-item"><span class="hoorder-item-label">Opleiding:</span> ${processText(ow.opleiding)}</div>`;
                    if (ow.huidige_werk) html += `<div class="hoorder-item"><span class="hoorder-item-label">Werk:</span> ${processText(ow.huidige_werk)}</div>`;
                    if (ow.intelligentie_leerstijl) html += `<div class="hoorder-item"><span class="hoorder-item-label">Leerstijl:</span> ${processText(ow.intelligentie_leerstijl)}</div>`;
                    if (ow.financiele_situatie) html += `<div class="hoorder-item"><span class="hoorder-item-label">Financieel:</span> ${processText(ow.financiele_situatie)}</div>`;
                    html += `</div>`;
                }

                // Zorgen & Trauma's
                if (persona.traumas_zorgen) {
                    const tz = persona.traumas_zorgen;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Zorgen & Worstelingen</div>`;
                    
                    if (tz.verleden) {
                        const verledenText = Array.isArray(tz.verleden) ? tz.verleden.join('; ') : tz.verleden;
                        if (verledenText) {
                            html += `<div class="hoorder-item"><span class="hoorder-item-label">Verleden:</span> ${processText(verledenText)}</div>`;
                        }
                    }
                    
                    if (tz.heden) {
                        const hedenText = Array.isArray(tz.heden) ? tz.heden.join('; ') : tz.heden;
                        if (hedenText) {
                            html += `<div class="hoorder-item"><span class="hoorder-item-label">Heden:</span> ${processText(hedenText)}</div>`;
                        }
                    }
                    
                    if (tz.onverwerkt) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Onverwerkt:</span> ${processText(tz.onverwerkt)}</div>`;
                    }
                    html += `</div>`;
                }

                // Geloof
                if (persona.geloof_spiritualiteit) {
                    const gs = persona.geloof_spiritualiteit;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Geloof & Spiritualiteit</div>`;
                    if (gs.kerkelijke_achtergrond) html += `<div class="hoorder-item">${processText(gs.kerkelijke_achtergrond)}</div>`;
                    if (gs.huidige_betrokkenheid) html += `<div class="hoorder-item">${processText(gs.huidige_betrokkenheid)}</div>`;
                    if (gs.geloofsbeleving) html += `<div class="hoorder-item"><span class="hoorder-item-label">Beleving:</span> ${processText(gs.geloofsbeleving)}</div>`;
                    if (gs.geloofstaal) html += `<div class="hoorder-item"><span class="hoorder-item-label">Taal:</span> ${processText(gs.geloofstaal)}</div>`;
                    if (gs.twijfels_vragen && gs.twijfels_vragen.length > 0) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Vragen:</span><ul class="hoorder-lijst">`;
                        gs.twijfels_vragen.forEach(v => html += `<li>${processText(v)}</li>`);
                        html += `</ul></div>`;
                    }
                    if (gs.spirituele_behoeften) html += `<div class="hoorder-item"><span class="hoorder-item-label">Behoeften:</span> ${processText(gs.spirituele_behoeften)}</div>`;
                    html += `</div>`;
                }

                // Hobby's & Interesses
                if (persona.hobbys_interesses) {
                    const hi = persona.hobbys_interesses;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Interesses</div>`;
                    const alles = [];
                    if (hi.vrijetijd) alles.push(...hi.vrijetijd);
                    if (hi.media) alles.push(...hi.media);
                    if (hi.verenigingen) alles.push(...hi.verenigingen);
                    if (alles.length > 0) {
                        html += `<div class="hoorder-item">${processText(alles.join(' Â· '))}</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div>`; // end hoorder-grid

                // Aansluiting schriftlezingen
                if (persona.aansluiting_schriftlezingen) {
                    const as = persona.aansluiting_schriftlezingen;
                    html += `<div class="hoorder-schrift">`;
                    html += `<div class="hoorder-schrift-titel">Aansluiting bij de Schriftlezingen</div>`;
                    if (as.wat_raakt) {
                        html += `<div class="hoorder-schrift-item"><span class="hoorder-schrift-label">Wat raakt:</span><span class="hoorder-schrift-tekst">${processText(as.wat_raakt)}</span></div>`;
                    }
                    if (as.wat_afstoot) {
                        html += `<div class="hoorder-schrift-item"><span class="hoorder-schrift-label">Wat afstoot:</span><span class="hoorder-schrift-tekst">${processText(as.wat_afstoot)}</span></div>`;
                    }
                    if (as.existentiele_vraag) {
                        html += `<div class="hoorder-vraag">\u201C${processText(as.existentiele_vraag)}\u201D</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div></div>`; // end hoorder-content, hoorder-card
            });

            return html;
        }

        // Render Gebeden section with cleaner layout
        function renderGebedenSection(data) {
            let html = '';

            // Render each prayer
            const gebeden = data.gebeden || {};
            const gebedOrder = ['drempelgebed', 'kyrie', 'epiclese', 'dankgebed', 'voorbeden'];
            const gebedTitles = {
                'drempelgebed': 'Drempelgebed',
                'kyrie': 'Kyrie',
                'epiclese': 'Epiclese',
                'dankgebed': 'Dankgebed',
                'voorbeden': 'Voorbeden'
            };

            gebedOrder.forEach(key => {
                const gebed = gebeden[key];
                if (!gebed) return;

                html += `<div id="section-14_gebeden-gebeden-${key}" class="subsection-anchor"></div>`;
                html += `<div class="gebed-card">`;

                // Header with type and aanspraak
                html += `<div class="gebed-card-header">`;
                html += `<span class="gebed-type-badge">${escapeHtml(gebedTitles[key] || key)}</span>`;
                if (gebed.aanspraak) {
                    html += `<span class="gebed-aanspraak">${processText(gebed.aanspraak)}</span>`;
                }
                html += `</div>`;

                // Main prayer text
                if (gebed.tekst) {
                    html += `<div class="gebed-tekst">${processText(gebed.tekst)}</div>`;
                }

                // For voorbeden without main tekst - show cirkels
                if (!gebed.tekst && gebed.cirkels) {
                    html += `<div class="gebed-cirkels">`;
                    const cirkelOrder = ['wereld', 'kerk', 'naasten', 'eigen_gemeente'];
                    const cirkelTitles = {
                        'wereld': 'De wereld',
                        'kerk': 'De kerk',
                        'naasten': 'Onze naasten',
                        'eigen_gemeente': 'Onze gemeente'
                    };

                    cirkelOrder.forEach(cirkelKey => {
                        const cirkel = gebed.cirkels[cirkelKey];
                        if (!cirkel) return;

                        html += `<div class="gebed-cirkel">`;
                        html += `<div class="gebed-cirkel-header">${escapeHtml(cirkelTitles[cirkelKey] || cirkelKey)}</div>`;

                        if (cirkel.themas && Array.isArray(cirkel.themas)) {
                            html += `<div class="gebed-cirkel-themas">`;
                            cirkel.themas.forEach(thema => {
                                html += `<span class="gebed-cirkel-thema">${processText(thema)}</span>`;
                            });
                            html += `</div>`;
                        }

                        if (cirkel.tekst) {
                            html += `<div class="gebed-cirkel-tekst">${processText(cirkel.tekst)}</div>`;
                        }
                        html += `</div>`;
                    });

                    html += `</div>`;
                }

                // Stilte instructie
                if (gebed.stilte_instructie) {
                    html += `<div class="gebed-instructie">${processText(gebed.stilte_instructie)}</div>`;
                }

                // Overgang naar Onze Vader
                if (gebed.overgang_onze_vader) {
                    html += `<div class="gebed-instructie">${processText(gebed.overgang_onze_vader)}</div>`;
                }

                // Onze Vader
                if (gebed.onze_vader) {
                    html += `<div class="gebed-onze-vader">${processText(gebed.onze_vader)}</div>`;
                }

                // Echo schriftlezing
                if (gebed.echo_schriftlezing) {
                    html += `<div class="gebed-echo"><span class="gebed-echo-label">Echo Schriftlezing:</span>${processText(gebed.echo_schriftlezing)}</div>`;
                }

                html += `</div>`; // end gebed-card
            });

            // Poetische technieken
            if (data.poetische_technieken_gebruikt) {
                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Poetische technieken</div>`;
                html += `<div class="gebeden-technieken">`;

                for (const [techniek, items] of Object.entries(data.poetische_technieken_gebruikt)) {
                    if (!Array.isArray(items) || items.length === 0) continue;

                    html += `<div class="gebeden-techniek">`;
                    html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(techniek))}</div>`;
                    html += `<ul class="gebeden-techniek-items">`;
                    items.forEach(item => {
                        html += `<li>${processText(item)}</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div></div>`;
            }

            // Profetische elementen
            if (data.profetische_elementen) {
                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Profetische elementen</div>`;
                html += `<div class="gebeden-technieken">`;

                for (const [element, items] of Object.entries(data.profetische_elementen)) {
                    if (!Array.isArray(items) || items.length === 0) continue;

                    html += `<div class="gebeden-techniek">`;
                    html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(element))}</div>`;
                    html += `<ul class="gebeden-techniek-items">`;
                    items.forEach(item => {
                        html += `<li>${processText(item)}</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div></div>`;
            }

            // Dialogische elementen
            if (data.dialogische_elementen) {
                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Dialogische elementen</div>`;
                html += `<div class="gebeden-technieken">`;

                for (const [element, items] of Object.entries(data.dialogische_elementen)) {
                    if (!Array.isArray(items) || items.length === 0) continue;

                    html += `<div class="gebeden-techniek">`;
                    html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(element))}</div>`;
                    html += `<ul class="gebeden-techniek-items">`;
                    items.forEach(item => {
                        html += `<li>${processText(item)}</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div></div>`;
            }

            // Echo techniek samenvatting
            if (data.echo_techniek) {

                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Echo-techniek</div>`;

                if (data.echo_techniek.schriftlezing_thema) {
                    html += `<p style="margin-bottom: 15px;"><strong>Schriftlezing thema:</strong> ${processText(data.echo_techniek.schriftlezing_thema)}</p>`;
                }

                if (data.echo_techniek.echo_per_gebed) {
                    html += `<div class="gebeden-technieken">`;
                    for (const [gebedKey, echo] of Object.entries(data.echo_techniek.echo_per_gebed)) {
                        html += `<div class="gebeden-techniek">`;
                        html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(gebedKey))}</div>`;
                        html += `<div style="font-size: 0.9em; color: var(--text-secondary);">${processText(echo)}</div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div>`;
            }

            return html;
        }

        // Render Preekschets section
        function renderPreekschetsSection(data, sectionKey) {
            let html = '';

            // Render metadata in a card
            html += `<div class="gebed-card" style="margin-bottom: 30px;">`;

            // Title
            if (data.titel) {
                html += `<div class="data-item">`;
                html += `<div class="data-label">Titel</div>`;
                html += `<div class="data-value" style="font-size: 1.1em; font-weight: bold;">${processText(data.titel)}</div>`;
                html += `</div>`;
            }

            // Schriftlezing
            if (data.schriftlezing) {
                html += `<div class="data-item">`;
                html += `<div class="data-label">Schriftlezing</div>`;
                html += `<div class="data-value">${processText(data.schriftlezing)}</div>`;
                html += `</div>`;
            }

            // Kerntekst
            if (data.kerntekst) {
                html += `<div class="data-item">`;
                html += `<div class="data-label">Kerntekst</div>`;
                html += `<div class="data-value" style="font-style: italic;">${processText(data.kerntekst)}</div>`;
                html += `</div>`;
            }

            // Kernparadox (Noordmans)
            if (data.kernparadox) {
                html += `<div class="data-item">`;
                html += `<div class="data-label">Kernparadox</div>`;
                html += `<div class="data-value">${processText(data.kernparadox)}</div>`;
                html += `</div>`;
            }

            html += `</div>`;

            // Render preek_onderdelen
            if (data.preek_onderdelen) {
                html += renderPreekOnderdelen(data.preek_onderdelen);
            }

            // Render kernwoorden
            if (data.kernwoorden && Array.isArray(data.kernwoorden)) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Kernwoorden</div>`;
                html += `<div class="tag-list">`;
                data.kernwoorden.forEach(woord => {
                    html += `<span class="tag">${processText(woord)}</span>`;
                });
                html += `</div></div>`;
            }

            // Render gebed_om_actie (SÃ¶lle)
            if (data.gebed_om_actie) {
                html += `<div class="gebed-card" style="margin-top: 30px;">`;
                html += `<div class="gebed-card-header">`;
                html += `<span class="gebed-type-badge">Gebed om actie</span>`;
                html += `</div>`;
                html += `<div class="gebed-tekst">${processText(data.gebed_om_actie)}</div>`;
                html += `</div>`;
            }

            // Render theologische_beweging (JÃ¼ngel)
            if (data.theologische_beweging) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Theologische beweging</div>`;
                html += `<div class="data-value">${processText(data.theologische_beweging)}</div>`;
                html += `</div>`;
            }

            // Render profetische_beweging (Brueggemann)
            if (data.profetische_beweging) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Profetische beweging</div>`;
                html += `<div class="data-value">${processText(data.profetische_beweging)}</div>`;
                html += `</div>`;
            }

            return html;
        }

        // Render Homiletische Illustraties section
        function renderIllustratiesSection(data) {
            let html = '';

            // Render each illustration
            if (data.illustraties && Array.isArray(data.illustraties)) {
                data.illustraties.forEach((illustratie, index) => {
                    const nummer = illustratie.nummer || (index + 1);

                    // Add anchor for submenu navigation
                    html += `<div id="section-13b_homiletische_illustraties-illustratie-${nummer}" class="subsection-anchor"></div>`;

                    html += `<div class="gebed-card" style="margin-bottom: 30px;">`;

                    // Header with number and title
                    html += `<div class="gebed-card-header">`;
                    html += `<span class="gebed-type-badge">${nummer}</span>`;
                    if (illustratie.titel) {
                        html += `<span class="gebed-aanspraak">${processText(illustratie.titel)}</span>`;
                    }
                    html += `</div>`;

                    // Main illustration text
                    if (illustratie.illustratie_tekst) {
                        html += `<div class="gebed-tekst" style="font-style: normal;">${processText(illustratie.illustratie_tekst)}</div>`;
                    }

                    // Bridge to truth
                    if (illustratie.brug_naar_waarheid) {
                        html += `<div class="gebed-echo">`;
                        html += `<span class="gebed-echo-label">Brug naar waarheid:</span>`;
                        html += processText(illustratie.brug_naar_waarheid);
                        html += `</div>`;
                    }

                    // Metadata
                    if (illustratie.metadata) {
                        const meta = illustratie.metadata;
                        html += `<div class="hoorder-details" style="margin-top: 15px;">`;

                        if (meta.type) {
                            html += `<div class="hoorder-detail"><strong>Type:</strong> ${processText(meta.type)}</div>`;
                        }
                        if (meta.bron) {
                            html += `<div class="hoorder-detail"><strong>Bron:</strong> ${processText(meta.bron)}</div>`;
                        }
                        if (meta.toon) {
                            html += `<div class="hoorder-detail"><strong>Toon:</strong> ${processText(meta.toon)}</div>`;
                        }
                        if (meta.lowry_stadium) {
                            html += `<div class="hoorder-detail"><strong>Lowry stadium:</strong> ${processText(meta.lowry_stadium)}</div>`;
                        }
                        if (meta.buttrick_plaatsing) {
                            html += `<div class="hoorder-detail"><strong>Buttrick plaatsing:</strong> ${processText(meta.buttrick_plaatsing)}</div>`;
                        }
                        if (meta.retorische_functie) {
                            html += `<div class="hoorder-detail"><strong>Retorische functie:</strong> ${processText(meta.retorische_functie)}</div>`;
                        }

                        html += `</div>`;
                    }

                    // Usage notes
                    if (illustratie.gebruiksnotities) {
                        html += `<div class="gebed-instructie">${processText(illustratie.gebruiksnotities)}</div>`;
                    }

                    html += `</div>`;
                });
            }

            // Gebruiksadvies
            if (data.gebruiksadvies) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Gebruiksadvies</div>`;
                html += renderObjectCompact(data.gebruiksadvies);
                html += `</div>`;
            }

            return html;
        }

        function renderKlassiekeRetorica(data, sectionKey) {
            let html = '';

            // Meta section
            if (data.meta) {
                html += `<div id="section-${sectionKey}-meta" class="subsection-anchor"></div>`;
                html += renderObject(data.meta, 'meta');
            }

            // Aristotelische Appeals
            if (data.aristotelische_appeals) {
                html += `<div id="section-${sectionKey}-aristotelische_appeals" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Aristotelische Appeals</div>`;
                html += `<div class="card-grid">`;
                
                ['logos', 'pathos', 'ethos'].forEach(appeal => {
                    if (data.aristotelische_appeals[appeal]) {
                        html += `<div class="nested-card">`;
                        html += `<div class="nested-card-title">${escapeHtml(formatKey(appeal))}</div>`;
                        html += `<div class="nested-card-content">`;
                        html += renderObjectCompact(data.aristotelische_appeals[appeal]);
                        html += `</div></div>`;
                    }
                });
                
                html += `</div></div>`;
            }

            // Klassieke Dispositio
            if (data.klassieke_dispositio) {
                html += `<div id="section-${sectionKey}-klassieke_dispositio" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Klassieke Dispositio</div>`;
                html += `<div class="buttrick-container">`;

                const parts = ['exordium', 'narratio', 'propositio', 'partitio', 'confirmatio', 'refutatio', 'peroratio'];
                const partColors = ['#7986cb', '#4db6ac', '#689f38', '#f57c00', '#ff8a65', '#f06292', '#ba68c8'];

                parts.forEach((part, index) => {
                    if (data.klassieke_dispositio[part]) {
                        const color = partColors[index] || 'var(--accent)';
                        html += `<div class="buttrick-move" style="border-left-color: ${color};">`;
                        html += `<div class="buttrick-move-header">`;
                        html += `<div class="buttrick-move-badge" style="background: ${color};">${escapeHtml(formatKey(part))}</div>`;
                        html += `</div>`;
                        html += `<div class="buttrick-move-content">`;
                        html += renderObjectCompact(data.klassieke_dispositio[part]);
                        html += `</div></div>`;
                    }
                });

                html += `</div></div>`;
            }

            // Monroe's Motivated Sequence
            if (data.monroes_motivated_sequence) {
                html += `<div id="section-${sectionKey}-monroes_motivated_sequence" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Monroe's Motivated Sequence</div>`;
                html += `<div class="buttrick-container">`;

                const steps = ['attention', 'need', 'satisfaction', 'visualization', 'action'];
                
                steps.forEach((step, index) => {
                    if (data.monroes_motivated_sequence[step]) {
                        html += `<div class="buttrick-move">`;
                        html += `<div class="buttrick-move-header">`;
                        html += `<div class="buttrick-move-badge">${index + 1}</div>`;
                        html += `<div class="buttrick-move-info"><div class="buttrick-move-kernidee">${escapeHtml(formatKey(step))}</div></div>`;
                        html += `</div>`;
                        html += `<div class="buttrick-move-content">`;
                        html += renderObjectCompact(data.monroes_motivated_sequence[step]);
                        html += `</div></div>`;
                    }
                });

                html += `</div></div>`;
            }

            // Retorische Figuren
            if (data.retorische_figuren) {
                html += `<div id="section-${sectionKey}-retorische_figuren" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Retorische Figuren</div>`;
                
                if (data.retorische_figuren.aanbevolen_figuren) {
                    html += `<div class="nested-title">Aanbevolen</div>`;
                    html += renderArray(data.retorische_figuren.aanbevolen_figuren, 'aanbevolen_figuren');
                }
                
                if (data.retorische_figuren.te_vermijden_figuren) {
                    html += `<div class="nested-title" style="margin-top: 15px;">Te Vermijden</div>`;
                    html += renderArray(data.retorische_figuren.te_vermijden_figuren, 'te_vermijden_figuren');
                }
                
                html += `</div>`;
            }

            // Praktische Tips
            if (data.praktische_tips) {
                html += `<div id="section-${sectionKey}-praktische_tips" class="subsection-anchor"></div>`;
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">Praktische Tips</div>`;
                html += renderObject(data.praktische_tips, 'praktische_tips');
                html += `</div>`;
            }

            return html;
        }

        // Render all Bijbelteksten in liturgical order
        function renderBijbeltekstenSection(data) {
            // Get lezingen info to determine reading type and order
            const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen || {};
            const orderKeys = ['eerste_lezing', 'psalm', 'epistel', 'evangelie'];
            const lezingTypes = {
                'eerste_lezing': 'Eerste lezing',
                'psalm': 'Psalm',
                'epistel': 'Epistel',
                'evangelie': 'Evangelie'
            };

            // Build liturgical order array
            const lezingenOrder = [];
            orderKeys.forEach(lezingKey => {
                if (lezingen[lezingKey]) {
                    const lez = lezingen[lezingKey];
                    const boekCode = getBoekCode(lez.boek || lez.referentie);
                    const hoofdstuk = lez.hoofdstuk || lez.nummer;
                    if (boekCode && hoofdstuk) {
                        lezingenOrder.push({ book: boekCode, chapter: hoofdstuk, type: lezingTypes[lezingKey] });
                    }
                }
            });

            // Add alternative readings
            if (lezingen.alternatieve_lezingen && Array.isArray(lezingen.alternatieve_lezingen)) {
                lezingen.alternatieve_lezingen.forEach(alt => {
                    const boekCode = getBoekCode(alt.referentie);
                    const match = alt.referentie?.match(/(\d+)[,:.]/);
                    const hoofdstuk = match ? parseInt(match[1]) : null;
                    if (boekCode && hoofdstuk) {
                        lezingenOrder.push({ book: boekCode, chapter: hoofdstuk, type: 'Alternatieve lezing' });
                    }
                });
            }

            // Collect all perikopen from all translations
            const allPerikopen = [];
            const vertalingen = ['grondtekst', 'nbv21', 'naardense_bijbel'];

            vertalingen.forEach(vertalingKey => {
                if (data[vertalingKey] && Array.isArray(data[vertalingKey])) {
                    data[vertalingKey].forEach(perikoop => {
                        // Grondtekst uses book_original, NBV21/NB use book
                        const bookCode = perikoop.book || perikoop.book_original;

                        // For grondtekst, convert book_original to NBV21 code for matching
                        const normalizedBookCode = bhs2nbv21(bookCode) || bookCode;

                        // Find liturgical order index
                        let orderIndex = lezingenOrder.findIndex(l => {
                            return l.book === normalizedBookCode && l.chapter === perikoop.chapter;
                        });
                        // Fallback: match by book only (fixes split chapters like Sefanja 2 & 3)
                        if (orderIndex === -1) {
                             orderIndex = lezingenOrder.findIndex(l => l.book === normalizedBookCode);
                        }
                        if (orderIndex === -1) orderIndex = 999;

                        // Get reading type
                        const lezingInfo = lezingenOrder.find(l => {
                            return l.book === normalizedBookCode && l.chapter === perikoop.chapter;
                        });

                        allPerikopen.push({
                            ...perikoop,
                            book: bookCode,
                            normalizedBook: normalizedBookCode,
                            vertalingKey: vertalingKey,
                            orderIndex: orderIndex,
                            lezingType: lezingInfo?.type || ''
                        });
                    });
                }
            });

            // Sort by: 1) liturgical order, 2) translation order, 3) chapter
            const vertalingOrder = { 'grondtekst': 0, 'nbv21': 1, 'naardense_bijbel': 2 };
            allPerikopen.sort((a, b) => {
                if (a.orderIndex !== b.orderIndex) return a.orderIndex - b.orderIndex;
                if (a.vertalingKey !== b.vertalingKey) {
                     return (vertalingOrder[a.vertalingKey] || 99) - (vertalingOrder[b.vertalingKey] || 99);
                }
                return a.chapter - b.chapter;
            });

            // Group adjacent pericopes of same translation and book
            const groupedPerikopen = [];
            let currentGroup = null;

            allPerikopen.forEach(perikoop => {
                // Determine verse range for reference building
                const eersteVers = perikoop.verses[0]?.verse || 1;
                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                const verzenRef = eersteVers === laatsteVers ? eersteVers : `${eersteVers}-${laatsteVers}`;

                if (currentGroup && 
                    currentGroup.vertalingKey === perikoop.vertalingKey && 
                    currentGroup.book === perikoop.book) {
                    // Merge with current group
                    currentGroup.verses.push(...perikoop.verses);
                    currentGroup.parts.push({chapter: perikoop.chapter, verzen: verzenRef});
                } else {
                    // Start new group
                    currentGroup = {
                        ...perikoop,
                        parts: [{chapter: perikoop.chapter, verzen: verzenRef}],
                        verses: [...perikoop.verses] // Copy verses
                    };
                    groupedPerikopen.push(currentGroup);
                }
            });

            // Render grouped perikopen
            const vertalingNamen = {
                'naardense_bijbel': 'NB',
                'nbv21': 'NBV21',
                'grondtekst': 'Grondtekst'
            };

            let html = '';

            groupedPerikopen.forEach(perikoop => {
                const vertalingTitel = vertalingNamen[perikoop.vertalingKey] || perikoop.vertalingKey;
                const boekNaam = perikoop.book_nl || getBijbelboekNaam(perikoop.book);
                
                // Build combined reference string
                const refString = perikoop.parts.map(part => `${part.chapter}:${part.verzen}`).join('; ');

                // Anchor ID matches the submenu navigation (using first chunk's key)
                const anchorId = `section-Bijbelteksten-${perikoop.book}-${perikoop.chapter}-${perikoop.vertalingKey}`;

                // For grondtekst, include language attribute
                const language = perikoop.language || '';
                const languageAttr = language ? ` data-language="${escapeHtml(language)}"` : '';

                html += `<div id="${anchorId}" class="subsection-anchor"></div>`;
                html += `<div class="bijbel-perikoop"${languageAttr}>`;
                html += `<div class="bijbel-header">`;
                html += `<span class="bijbel-boek-badge${perikoop.vertalingKey === 'grondtekst' ? ' bijbel-grondtekst-badge' : ''}">${escapeHtml(vertalingTitel)}</span>`;
                html += `<span class="bijbel-referentie">${escapeHtml(boekNaam)} ${refString}</span>`;
                if (language) {
                    html += `<span class="bijbel-language-tag">${escapeHtml(language)}</span>`;
                }
                if (perikoop.lezingType) {
                    html += `<span class="bijbel-lezing-type">${escapeHtml(perikoop.lezingType)}</span>`;
                }
                html += `</div>`;

                html += `<div class="bijbel-verzen">`;
                perikoop.verses.forEach(vers => {
                    html += `<div class="bijbel-vers">`;
                    html += `<span class="bijbel-vers-nummer">${vers.verse}</span>`;
                    html += `<span class="bijbel-vers-tekst">${language === 'Hebreeuws' ? escapeHtml(vers.text) : processText(vers.text)}</span>`;
                    html += `</div>`;
                });
                html += `</div>`;

                html += `</div>`; // end bijbel-perikoop
            });

            return html;
        }

        // Helper function to get book code from Dutch name or reference
        function getBoekCode(boekNaam) {
            if (!boekNaam) return null;
            const naam = boekNaam.toLowerCase();

            const mapping = {
                'genesis': 'GEN', 'exodus': 'EXO', 'leviticus': 'LEV', 'numeri': 'NUM', 'deuteronomium': 'DEU',
                'jozua': 'JOS', 'richteren': 'JDG', 'ruth': 'RUT', 'samuel': '1SA', '1 samuel': '1SA', '2 samuel': '2SA',
                'koningen': '1KI', '1 koningen': '1KI', '2 koningen': '2KI',
                'kronieken': '1CH', '1 kronieken': '1CH', '2 kronieken': '2CH',
                'ezra': 'EZR', 'nehemia': 'NEH', 'ester': 'EST', 'job': 'JOB',
                'psalm': 'PSA', 'psalmen': 'PSA', 'spreuken': 'PRO', 'prediker': 'ECC', 'hooglied': 'SNG',
                'jesaja': 'ISA', 'jeremia': 'JER', 'klaagliederen': 'LAM',
                'ezechiel': 'EZK', 'ezekiel': 'EZK', 'daniel': 'DAN', 'daniÃ«l': 'DAN',
                'hosea': 'HOS', 'joel': 'JOL', 'joÃ«l': 'JOL', 'amos': 'AMO', 'obadja': 'OBA',
                'jona': 'JON', 'micha': 'MIC', 'nahum': 'NAM', 'habakuk': 'HAB',
                'sefanja': 'ZEP', 'haggai': 'HAG', 'haggaÃ¯': 'HAG', 'zacharia': 'ZEC', 'maleachi': 'MAL',
                'matteus': 'MAT', 'matteÃ¼s': 'MAT', 'mattheÃ¼s': 'MAT', 'marcus': 'MRK', 'lucas': 'LUK', 'lukas': 'LUK',
                'johannes': 'JHN', 'handelingen': 'ACT',
                'romeinen': 'ROM', 'korintiÃ«rs': '1CO', 'korintiers': '1CO',
                '1 korintiÃ«rs': '1CO', '2 korintiÃ«rs': '2CO', '1 korintiers': '1CO', '2 korintiers': '2CO',
                'galaten': 'GAL', 'efeziÃ«rs': 'EPH', 'efeziers': 'EPH', 'filippenzen': 'PHP',
                'kolossenzen': 'COL', 'tessalonicenzen': '1TH',
                '1 tessalonicenzen': '1TH', '2 tessalonicenzen': '2TH',
                'timoteÃ¼s': '1TI', 'timoteus': '1TI', '1 timoteÃ¼s': '1TI', '2 timoteÃ¼s': '2TI',
                '1 timoteus': '1TI', '2 timoteus': '2TI',
                'titus': 'TIT', 'filemon': 'PHM', 'hebreeÃ«n': 'HEB', 'hebreeen': 'HEB',
                'jakobus': 'JAS', 'petrus': '1PE', '1 petrus': '1PE', '2 petrus': '2PE',
                '1 johannes': '1JN', '2 johannes': '2JN', '3 johannes': '3JN',
                'judas': 'JUD', 'openbaring': 'REV',
                'sirach': 'SIR', 'ecclesiasticus': 'SIR', 'wijsheid': 'WIS', 'tobit': 'TOB',
                'judit': 'JDT', 'baruch': 'BAR', 'makkabeeen': '1MA', 'makkabeeÃ«n': '1MA',
                '1 makkabeeen': '1MA', '2 makkabeeen': '2MA', '1 makkabeeÃ«n': '1MA', '2 makkabeeÃ«n': '2MA'
            };

            // Try direct match
            for (const [key, code] of Object.entries(mapping)) {
                if (naam.includes(key)) {
                    return code;
                }
            }
            return null;
        }

        // Helper function for bible book names (used in nav and rendering)
        function getBijbelboekNaam(code) {
            const boekNamen = {
                // NBV21/NB codes
                'GEN': 'Genesis', 'EXO': 'Exodus', 'LEV': 'Leviticus', 'NUM': 'Numeri', 'DEU': 'Deuteronomium',
                'JOS': 'Jozua', 'JDG': 'Richteren', 'RUT': 'Ruth', '1SA': '1 Samuel', '2SA': '2 Samuel',
                '1KI': '1 Koningen', '2KI': '2 Koningen', '1CH': '1 Kronieken', '2CH': '2 Kronieken',
                'EZR': 'Ezra', 'NEH': 'Nehemia', 'EST': 'Ester', 'JOB': 'Job', 'PSA': 'Psalm',
                'PRO': 'Spreuken', 'ECC': 'Prediker', 'SNG': 'Hooglied', 'ISA': 'Jesaja', 'JER': 'Jeremia',
                'LAM': 'Klaagliederen', 'EZK': 'Ezechiel', 'DAN': 'Daniel', 'HOS': 'Hosea', 'JOL': 'Joel',
                'AMO': 'Amos', 'OBA': 'Obadja', 'JON': 'Jona', 'MIC': 'Micha', 'NAM': 'Nahum',
                'HAB': 'Habakuk', 'ZEP': 'Sefanja', 'HAG': 'Haggai', 'ZEC': 'Zacharia', 'MAL': 'Maleachi',
                'MAT': 'Matteus', 'MRK': 'Marcus', 'LUK': 'Lucas', 'JHN': 'Johannes', 'ACT': 'Handelingen',
                'ROM': 'Romeinen', '1CO': '1 Korintiers', '2CO': '2 Korintiers', 'GAL': 'Galaten',
                'EPH': 'Efeziers', 'PHP': 'Filippenzen', 'COL': 'Kolossenzen', '1TH': '1 Tessalonicenzen',
                '2TH': '2 Tessalonicenzen', '1TI': '1 Timoteus', '2TI': '2 Timoteus', 'TIT': 'Titus',
                'PHM': 'Filemon', 'HEB': 'Hebreeen', 'JAS': 'Jakobus', '1PE': '1 Petrus', '2PE': '2 Petrus',
                '1JN': '1 Johannes', '2JN': '2 Johannes', '3JN': '3 Johannes', 'JUD': 'Judas', 'REV': 'Openbaring',
                'SIR': 'Sirach', 'WIS': 'Wijsheid', 'TOB': 'Tobit', 'JDT': 'Judit', 'BAR': 'Baruch',
                '1MA': '1 Makkabeeen', '2MA': '2 Makkabeeen',
                // Grondtekst BHS codes (Hebrew)
                'Genesis': 'Genesis', 'Exodus': 'Exodus', 'Leviticus': 'Leviticus', 'Numeri': 'Numeri',
                'Deuteronomium': 'Deuteronomium', 'Josua': 'Jozua', 'Judices': 'Richteren', 'Ruth': 'Ruth',
                'Samuel_I': '1 Samuel', 'Samuel_II': '2 Samuel', 'Reges_I': '1 Koningen', 'Reges_II': '2 Koningen',
                'Chronica_I': '1 Kronieken', 'Chronica_II': '2 Kronieken', 'Esra': 'Ezra', 'Nehemia': 'Nehemia',
                'Esther': 'Ester', 'Iob': 'Job', 'Psalmi': 'Psalm', 'Proverbia': 'Spreuken',
                'Ecclesiastes': 'Prediker', 'Canticum': 'Hooglied', 'Jesaia': 'Jesaja', 'Jeremia': 'Jeremia',
                'Threni': 'Klaagliederen', 'Ezechiel': 'Ezechiel', 'Daniel': 'Daniel', 'Hosea': 'Hosea',
                'Joel': 'Joel', 'Amos': 'Amos', 'Obadia': 'Obadja', 'Jona': 'Jona', 'Micha': 'Micha',
                'Nahum': 'Nahum', 'Habakuk': 'Habakuk', 'Zephania': 'Sefanja', 'Haggai': 'Haggai',
                'Sacharia': 'Zacharia', 'Maleachi': 'Maleachi'
            };
            return boekNamen[code] || code;
        }

        function renderBijbelteksten(vertalingKey, perikopen) {
            const vertalingNamen = {
                'naardense_bijbel': 'NB',
                'nbv21': 'NBV21',
                'grondtekst': 'Grondtekst'
            };
            const vertalingTitel = vertalingNamen[vertalingKey] || vertalingKey;

            // Get lezingen info to determine reading type
            const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen || {};
            const lezingTypes = {
                'eerste_lezing': 'Eerste lezing',
                'psalm': 'Psalm',
                'epistel': 'Epistel',
                'evangelie': 'Evangelie'
            };

            // Build lookup: book+chapter -> reading type
            const lezingLookup = {};
            for (const [key, label] of Object.entries(lezingTypes)) {
                if (lezingen[key]) {
                    const lez = lezingen[key];
                    const boekCode = getBoekCode(lez.boek || lez.referentie);
                    const hoofdstuk = lez.hoofdstuk || lez.nummer;
                    if (boekCode && hoofdstuk) {
                        lezingLookup[`${boekCode}-${hoofdstuk}`] = label;
                    }
                }
            }
            // Check alternative readings
            if (lezingen.alternatieve_lezingen && Array.isArray(lezingen.alternatieve_lezingen)) {
                lezingen.alternatieve_lezingen.forEach(alt => {
                    const boekCode = getBoekCode(alt.referentie);
                    // Extract chapter from referentie like "1 Samuel 1,20-22.24-28"
                    const match = alt.referentie?.match(/(\d+)[,:.]/);
                    const hoofdstuk = match ? parseInt(match[1]) : null;
                    if (boekCode && hoofdstuk) {
                        lezingLookup[`${boekCode}-${hoofdstuk}`] = 'Alternatieve lezing';
                    }
                });
            }

            let html = '';

            perikopen.forEach(perikoop => {
                const boekNaam = perikoop.book_nl || getBijbelboekNaam(perikoop.book);
                const eersteVers = perikoop.verses[0]?.verse || 1;
                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                const verzenRef = eersteVers === laatsteVers ? eersteVers : `${eersteVers}-${laatsteVers}`;

                // Determine reading type
                const lezingType = lezingLookup[`${perikoop.book}-${perikoop.chapter}`] || '';

                // Anchor ID matches the submenu navigation: BOOK-CHAPTER-vertaling
                const anchorId = `section-Bijbelteksten-${perikoop.book}-${perikoop.chapter}-${vertalingKey}`;

                // For grondtekst, include language attribute
                const language = perikoop.language || '';
                const languageAttr = language ? ` data-language="${escapeHtml(language)}"` : '';

                html += `<div id="${anchorId}" class="subsection-anchor"></div>`;
                html += `<div class="bijbel-perikoop"${languageAttr}>`;
                html += `<div class="bijbel-header">`;
                html += `<span class="bijbel-boek-badge${vertalingKey === 'grondtekst' ? ' bijbel-grondtekst-badge' : ''}">${escapeHtml(vertalingTitel)}</span>`;
                html += `<span class="bijbel-referentie">${escapeHtml(boekNaam)} ${perikoop.chapter}:${verzenRef}</span>`;
                if (language) {
                    html += `<span class="bijbel-language-tag">${escapeHtml(language)}</span>`;
                }
                if (lezingType) {
                    html += `<span class="bijbel-lezing-type">${escapeHtml(lezingType)}</span>`;
                }
                html += `</div>`;

                html += `<div class="bijbel-verzen">`;
                perikoop.verses.forEach(vers => {
                    html += `<div class="bijbel-vers">`;
                    html += `<span class="bijbel-vers-nummer">${vers.verse}</span>`;
                    html += `<span class="bijbel-vers-tekst">${language === 'Hebreeuws' ? escapeHtml(vers.text) : processText(vers.text)}</span>`;
                    html += `</div>`;
                });
                html += `</div>`;

                html += `</div>`; // end bijbel-perikoop
            });

            return html;
        }

        function formatKey(key) {
            // Handle special cases
            let result;
            if (key === 'vijf_vs') {
                result = "Vijf V\u2019s";
            } else if (key === 'mesotrends_5_15_jaar') {
                result = "Mesotrends 5-15 jaar";
            } else if (key === 'microtrends_1_5_jaar') {
                result = "Microtrends 1-5 jaar";
            } else if (key === 'kernwords') {
                result = "Kernwoorden";
            } else if (key === 'prompt_nl') {
                result = "Prompt (Nederlands)";
            } else if (key === 'prompt_en') {
                result = "Prompt (Engels)";
            } else {
                result = key
                    .replace(/_/g, ' ')
                    .replace(/([a-z])([A-Z])/g, '$1 $2')
                    .replace(/^./, str => str.toUpperCase());
            }

            // Preserve abbreviations with multiple capitals
            const abbreviations = {
                'Nbv21': 'NBV21',
                'nbv21': 'NBV21',
                'Nbv': 'NBV',
                'nbv': 'NBV',
                ' Ot ': ' OT ',
                ' Nt ': ' NT ',
                ' ot ': ' OT ',
                ' nt ': ' NT ',
                'Pkn': 'PKN',
                'pkn': 'PKN'
            };

            for (const [wrong, correct] of Object.entries(abbreviations)) {
                result = result.replace(new RegExp(wrong, 'gi'), correct);
            }

            // Dutch plural corrections (words ending in vowel + s need apostrophe)
            const pluralCorrections = {
                'themas': 'thema\u2019s',
                'Themas': 'Thema\u2019s',
                'schemas': 'schema\u2019s',
                'Schemas': 'Schema\u2019s',
                'dilemmas': 'dilemma\u2019s',
                'Dilemmas': 'Dilemma\u2019s',
                'traumas': 'trauma\u2019s',
                'Traumas': 'Trauma\u2019s',
                'panoramas': 'panorama\u2019s',
                'Panoramas': 'Panorama\u2019s'
            };

            for (const [wrong, correct] of Object.entries(pluralCorrections)) {
                result = result.replace(new RegExp(`\\b${wrong}\\b`, 'g'), correct);
            }

            return result;
        }

        function formatValue(value) {
            if (value === null || value === undefined) return '<em>-</em>';
            if (typeof value === 'boolean') return value ? 'Ja' : 'Nee';
            // Replace string "null" values
            if (value === 'null' || value === 'NULL') {
                return '<em>geen gegevens beschikbaar</em>';
            }
            if (typeof value === 'string') {
                // Check if it's a URL
                if (value.match(/^https?:\/\//)) {
                    return `<a href="${escapeHtml(value)}" target="_blank">${escapeHtml(value)}</a>`;
                }
                return processText(value);
            }
            return processText(String(value));
        }

        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Convert straight quotes to curly quotes
        function smartQuotes(text) {
            if (typeof text !== 'string') return text;
            return text
                // Double quotes
                .replace(/(^|[\s(\[{<])"(\S)/g, '$1\u201c$2')     // Opening double quote after space/start
                .replace(/(\S)"([\s)\]}>,.:;!?]|$)/g, '$1\u201d$2') // Closing double quote before space/end
                .replace(/"/g, '\u201d')                          // Remaining double quotes -> closing

                // Single quotes and apostrophes
                // Dutch contractions first: 's, 't, 'n, 'm (these are apostrophes, not opening quotes)
                .replace(/(^|[\s(\[{<])'([stnmSTNM])\b/g, '$1\u2019$2')
                // Apostrophe within words (don't, it's, etc.)
                .replace(/(\w)'(\w)/g, '$1\u2019$2')
                // Opening single quote after space/start (but not Dutch contractions)
                .replace(/(^|[\s(\[{<])'(\S)/g, '$1\u2018$2')
                // Closing single quote before space/end/punctuation
                .replace(/(\S)'([\s)\]}>,.:;!?]|$)/g, '$1\u2019$2')
                // Remaining single quotes -> apostrophe
                .replace(/'/g, '\u2019');
        }

        // Escape HTML and apply smart quotes (for nav labels and similar)
        function escapeAndSmartQuotes(text) {
            if (typeof text !== 'string') return text;
            return smartQuotes(escapeHtml(text));
        }

        // Process text: escape HTML, convert quotes, and handle newlines
        function processText(text) {
            if (typeof text !== 'string') return text;
            // First convert literal \n to actual newlines (before HTML escaping)
            let result = text.replace(/\\n/g, '\n');
            // Escape HTML special characters
            result = escapeHtml(result);
            // Convert **text** to bold (must come before single *)
            result = result.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            // Convert *text* to italic (stage directions, instructions)
            result = result.replace(/\*([^*]+)\*/g, '<em class="instruction">$1</em>');
            // Convert quotes to curly quotes
            result = smartQuotes(result);
            // Convert newlines to <br> tags
            result = result.replace(/\n/g, '<br>');
            return result;
        }

        // Scroll handling
        let ticking = false;
        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    handleScroll();
                    ticking = false;
                });
                ticking = true;
            }
        });

        function handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // Show/hide scroll to top button
            scrollTopBtn.classList.toggle('visible', scrollTop > 300);

            // Update active nav item
            updateActiveNav();
        }

        function updateActiveNav() {
            const sections = document.querySelectorAll('.section');
            let currentSection = '';

            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 150 && rect.bottom > 150) {
                    currentSection = section.id.replace('section-', '');
                }
            });

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === currentSection);
            });
        }

        // Scroll to top
        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Handle resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 900) {
                sidebar.classList.remove('visible');
                sidebar.classList.remove('hidden');
                mainContent.classList.remove('full-width');
                sidebarVisible = true;
            }
        });

        // --- NEW ---
        // Populate the file selector and load the default file
        function initialize() {
             jsonFiles.forEach(item => {
                 const option = document.createElement('option');
                 option.value = item.file;
                 option.textContent = item.label;
                 fileSelector.appendChild(option);
             });

             if (jsonFiles.length > 0) {
                 // Set the selector to the third file by default
                 const defaultFile = jsonFiles[3].file;
                 fileSelector.value = defaultFile;
                 loadFile(defaultFile);
             }
        }
        
        // Run initialization when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initialize);

        // Add event listener for the custom file load button
        document.getElementById('load-custom-btn').addEventListener('click', () => {
            document.getElementById('file-input').click();
        });

        // Add event listener for the file input
        document.getElementById('file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                if (file.type === 'application/json' || file.name.endsWith('.json')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            jsonData = JSON.parse(e.target.result);
                            renderContent();
                        } catch (error) {
                            alert('Fout bij het lezen van het JSON-bestand: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                } else {
                    alert('Alleen JSON-bestanden zijn toegestaan.');
                }
            }
        });

    </script>
</body>
</html>
