<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liturgische Analyse Viewer</title>
    <style>
        :root {
            /* Light mode - 90s inspired earth tones */
            --bg-primary: #f5f0e8;
            --bg-secondary: #e8e0d0;
            --bg-tertiary: #d8cfc0;
            --text-primary: #2c2416;
            --text-secondary: #4a3f30;
            --text-muted: #6b5d4d;
            --accent: #8b4513;
            --accent-light: #cd853f;
            --border-light: #c0b8a8;
            --border-dark: #887868;
            --shadow-light: #ffffff;
            --shadow-dark: #a09080;
            --link: #5d4037;
            --success: #2e7d32;
            --warning: #f57c00;
            --header-bg: linear-gradient(180deg, #d4c4b0 0%, #c8b8a0 50%, #bca890 100%);
            --menu-bg: #ebe3d8;
            --card-bg: #faf8f5;
            --bevel-light: #ffffff;
            --bevel-dark: #9a8a7a;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1814;
            --bg-secondary: #252118;
            --bg-tertiary: #302a20;
            --text-primary: #e8e0d0;
            --text-secondary: #c8c0b0;
            --text-muted: #9a9080;
            --accent: #cd853f;
            --accent-light: #daa06d;
            --border-light: #3a342a;
            --border-dark: #4a443a;
            --shadow-light: #302a20;
            --shadow-dark: #0a0806;
            --link: #daa06d;
            --success: #66bb6a;
            --warning: #ffb74d;
            --header-bg: linear-gradient(180deg, #302a20 0%, #282218 50%, #201a10 100%);
            --menu-bg: #222018;
            --card-bg: #2a2418;
            --bevel-light: #3a342a;
            --bevel-dark: #0a0806;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Classic 90s beveled frame effect */
        .bevel-raised {
            border: 2px solid;
            border-color: var(--bevel-light) var(--bevel-dark) var(--bevel-dark) var(--bevel-light);
            box-shadow:
                inset 1px 1px 0 var(--shadow-light),
                inset -1px -1px 0 var(--shadow-dark);
        }

        .bevel-inset {
            border: 2px solid;
            border-color: var(--bevel-dark) var(--bevel-light) var(--bevel-light) var(--bevel-dark);
            box-shadow:
                inset 1px 1px 3px var(--shadow-dark),
                inset -1px -1px 0 var(--shadow-light);
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: var(--header-bg);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease;
            border-bottom: 3px solid;
            border-color: var(--bevel-dark);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        header.hidden {
            transform: translateY(-100%);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            display: none;
            background: var(--bg-secondary);
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 20px;
        }

        .logo {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 1px 1px 0 var(--shadow-light);
            letter-spacing: 1px;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .load-btn {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .load-btn:hover {
            background: var(--accent);
            color: white;
        }

        .load-btn:active {
            border-color: var(--bevel-dark) var(--bevel-light) var(--bevel-light) var(--bevel-dark);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 65px;
            left: 0;
            width: 280px;
            height: calc(100vh - 65px);
            background: var(--menu-bg);
            overflow-y: auto;
            padding: 15px 0 60px 0;
            transition: transform 0.3s ease;
            z-index: 900;
            border-right: 2px solid var(--border-dark);
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 10px 20px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            font-weight: bold;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
        }

        .nav-item {
            display: block;
            padding: 10px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            font-size: 0.9em;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-left-color: var(--accent-light);
        }

        .nav-item.active {
            background: var(--bg-secondary);
            color: var(--accent);
            border-left-color: var(--accent);
            font-weight: bold;
        }

        .nav-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            text-align: center;
            line-height: 24px;
            margin-right: 8px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .nav-toggle {
            float: right;
            font-size: 0.7em;
            transition: transform 0.2s;
        }

        .nav-item.expanded .nav-toggle {
            transform: rotate(90deg);
        }

        .nav-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: var(--bg-primary);
        }

        .nav-submenu.open {
            max-height: 1000px;
        }

        .nav-subitem {
            display: block;
            padding: 6px 20px 6px 52px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8em;
            border-left: 4px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-subitem:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-left-color: var(--accent-light);
        }

        .nav-subitem.active {
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .subsection-anchor {
            scroll-margin-top: 80px;
        }

        /* Main content */
        main {
            margin-left: 280px;
            margin-top: 65px;
            padding: 30px;
            min-height: calc(100vh - 65px);
            transition: margin 0.3s ease;
        }

        main.full-width {
            margin-left: 0;
        }

        /* Content wrapper for max-width */
        .content-wrapper {
            max-width: 800px;
        }

        /* Welcome screen */
        .welcome {
            text-align: center;
            padding: 80px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome h1 {
            font-size: 2.2em;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .welcome p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .welcome-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        /* Content sections */
        .section {
            background: var(--card-bg);
            margin-bottom: 30px;
            padding: 25px;
            scroll-margin-top: 80px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .section-number {
            width: 40px;
            height: 40px;
            background: var(--accent);
            color: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
        }

        .section-title {
            font-size: 1.4em;
            color: var(--text-primary);
        }

        .section-meta {
            font-size: 0.85em;
            color: var(--text-muted);
            margin-left: auto;
        }

        /* Data display */
        .data-group {
            margin-bottom: 25px;
        }

        .data-group-title {
            font-size: 1.1em;
            color: var(--accent);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px dashed var(--border-light);
            text-transform: capitalize;
        }

        .data-item {
            display: flex;
            gap: 20px;
            margin-bottom: 8px;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .data-item:nth-child(odd) {
            background: var(--bg-tertiary);
        }

        .data-label {
            font-weight: bold;
            color: var(--text-secondary);
            min-width: 220px;
            flex-shrink: 0;
            text-transform: capitalize;
        }

        .data-value {
            color: var(--text-primary);
            flex: 1;
        }

        .data-value a {
            color: var(--link);
        }

        /* Nested objects */
        .nested-object {
            background: var(--bg-primary);
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid var(--accent-light);
        }

        .nested-title {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            text-transform: capitalize;
        }

        /* Arrays */
        .array-list {
            list-style: none;
            padding: 0;
        }

        .array-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-light);
        }

        .array-item:nth-child(odd) {
            background: var(--bg-tertiary);
        }

        /* Tags */
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: var(--accent);
            color: white;
            border-radius: 15px;
            font-size: 0.85em;
        }

        /* Lied items */
        .lied-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
            margin: 10px 0;
        }

        .lied-item {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-left: 4px solid var(--accent);
        }

        .lied-nummer {
            font-weight: bold;
            color: var(--accent);
            font-size: 1em;
        }

        .lied-titel {
            font-style: italic;
            margin: 3px 0;
            font-size: 0.95em;
        }

        .lied-regel {
            color: var(--text-muted);
            font-size: 0.85em;
        }

        .lied-toelichting {
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px dashed var(--border-light);
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 44px;
            height: 44px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-top.visible {
            opacity: 0.9;
            visibility: visible;
        }

        .scroll-top:hover {
            opacity: 1;
            background: var(--accent-light);
        }

        /* File input hidden */
        #file-input {
            display: none;
        }

        /* Meta info box */
        .meta-box {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .meta-box h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .meta-box .gemeente {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .meta-box .datum {
            font-size: 1.4em;
            margin: 10px 0;
        }

        .meta-box .adres {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .meta-box a {
            color: white;
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.visible {
                transform: translateX(0);
            }

            main {
                margin-left: 0;
            }

            .data-item {
                flex-direction: column;
            }

            .data-label {
                min-width: auto;
                margin-bottom: 4px;
            }
        }

        @media (max-width: 600px) {
            header {
                padding: 10px 15px;
            }

            .logo {
                font-size: 1.1em;
            }

            .load-btn span {
                display: none;
            }

            main {
                padding: 15px;
            }

            .section {
                padding: 15px;
            }

            .section-header {
                flex-wrap: wrap;
            }

            .section-meta {
                width: 100%;
                margin-left: 0;
                margin-top: 10px;
            }
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-muted);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid var(--border-light);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-toggle::after {
            content: 'â˜€ï¸';
            position: absolute;
            left: 3px;
            top: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        [data-theme="dark"] .theme-toggle::after {
            content: 'ðŸŒ™';
            left: 27px;
        }

        /* Quote blocks */
        .quote-block {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent);
            padding: 15px 20px;
            margin: 15px 0;
            font-style: italic;
        }

        /* Grid layout for cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .card-grid-narrow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        /* Compact nested card */
        .nested-card {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-left: 3px solid var(--accent-light);
        }

        .nested-card-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 0.95em;
            margin-bottom: 6px;
            text-transform: capitalize;
        }

        .nested-card-content {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        /* Inline data pairs */
        .data-pairs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
        }

        .data-pair {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: 4px;
        }

        .data-pair-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-pair-value {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Table-like display for lezingen */
        .lezing-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 4px solid var(--accent);
            display: flex;
            flex-direction: column;
        }

        .lezing-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .lezing-ref {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--accent);
        }

        .lezing-thema {
            margin-top: 8px;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.95em;
            flex-grow: 1;
        }

        /* Hoorder cards */
        .hoorder-card {
            background: var(--bg-secondary);
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid var(--border-light);
        }

        .hoorder-naam {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .hoorder-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .hoorder-detail {
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        /* Gebed blocks */
        .gebed-block {
            background: var(--bg-secondary);
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
            font-style: italic;
            line-height: 1.8;
        }

        .gebed-titel {
            font-weight: bold;
            font-style: normal;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* Stage directions / instructions */
        .instruction {
            font-style: italic;
            color: var(--text-muted);
        }

        /* Search terms */
        .search-term {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--link);
            background: var(--bg-tertiary);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 5px;
        }

        /* Focus en functie cards */
        .focus-card {
            background: var(--bg-secondary);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid var(--accent);
        }

        .focus-card-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }

        .focus-card-number {
            width: 36px;
            height: 36px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        .focus-card-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .focus-card-type {
            display: inline-block;
            padding: 2px 10px;
            background: var(--accent-light);
            color: white;
            border-radius: 12px;
            font-size: 0.75em;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .focus-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        @media (max-width: 900px) {
            .focus-sections {
                grid-template-columns: 1fr;
            }
        }

        .focus-section {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 4px;
        }

        .focus-section-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .focus-section-content {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .focus-toelichting {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-light);
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        /* Bijbelteksten */
        .bijbel-perikoop {
            background: var(--bg-secondary);
            padding: 20px 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
        }

        .bijbel-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .bijbel-boek-badge {
            background: var(--accent);
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        .bijbel-referentie {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .bijbel-verzen {
            line-height: 1.9;
            font-size: 1.05em;
        }

        .bijbel-vers {
            margin-bottom: 8px;
            text-align: justify;
            hyphens: auto;
        }

        .bijbel-vers-nummer {
            display: inline-block;
            font-size: 0.7em;
            font-weight: bold;
            color: var(--accent);
            vertical-align: super;
            margin-right: 3px;
            min-width: 1.5em;
        }

        .bijbel-vers-tekst {
            color: var(--text-primary);
        }

        .bijbel-lezing-type {
            margin-left: auto;
            font-size: 0.85em;
            font-style: italic;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 4px;
        }

        /* Gebeden styling */
        .gebed-card {
            background: var(--bg-secondary);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
        }

        .gebed-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .gebed-type-badge {
            background: var(--accent);
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            text-transform: capitalize;
        }

        .gebed-aanspraak {
            font-size: 1.2em;
            font-weight: bold;
            font-style: italic;
            color: var(--text-primary);
        }

        .gebed-tekst {
            font-size: 1.05em;
            line-height: 1.9;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .gebed-tekst p {
            margin-bottom: 12px;
        }

        .gebed-echo {
            margin-top: 15px;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-light);
            font-size: 0.9em;
            font-style: italic;
            color: var(--text-muted);
        }

        .gebed-echo-label {
            font-weight: bold;
            font-style: normal;
            color: var(--accent);
            margin-right: 8px;
        }

        .gebed-intenties {
            margin: 15px 0;
        }

        .gebed-intentie {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-light);
        }

        .gebed-intentie-voor {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .gebed-intentie-tekst {
            color: var(--text-secondary);
            font-style: italic;
        }

        .gebed-cirkels {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }

        .gebed-cirkel {
            padding: 15px;
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent);
        }

        .gebed-cirkel-header {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 8px;
            text-transform: capitalize;
        }

        .gebed-cirkel-themas {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .gebed-cirkel-thema {
            background: var(--bg-secondary);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .gebed-cirkel-tekst {
            font-style: italic;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .gebed-instructie {
            font-style: italic;
            color: var(--text-muted);
            margin: 15px 0;
            text-align: center;
        }

        .gebed-onze-vader {
            background: var(--bg-tertiary);
            padding: 20px;
            margin-top: 15px;
            font-style: italic;
            line-height: 1.8;
            text-align: center;
            border: 1px solid var(--border-light);
        }

        .gebeden-meta {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-light);
        }

        .gebeden-meta-title {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .gebeden-technieken {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .gebeden-techniek {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 3px solid var(--accent-light);
        }

        .gebeden-techniek-naam {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 8px;
            text-transform: capitalize;
        }

        .gebeden-techniek-items {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .gebeden-techniek-items li {
            margin-bottom: 4px;
        }

        /* Representatieve Hoorders */
        .hoorder-card {
            background: var(--bg-secondary);
            margin-bottom: 30px;
            border-left: 5px solid var(--accent);
            overflow: hidden;
        }

        .hoorder-header {
            background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 70%, black 30%));
            color: white;
            padding: 20px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .hoorder-nummer {
            background: rgba(255,255,255,0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .hoorder-intro {
            flex: 1;
        }

        .hoorder-naam {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .hoorder-meta {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .hoorder-kernschets {
            padding: 20px 25px;
            background: var(--bg-tertiary);
            font-style: italic;
            font-size: 1.05em;
            line-height: 1.7;
            border-bottom: 1px solid var(--border-light);
        }

        .hoorder-content {
            padding: 20px 25px;
        }

        .hoorder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .hoorder-groep {
            background: var(--bg-tertiary);
            padding: 15px;
            border-left: 3px solid var(--accent-light);
        }

        .hoorder-groep-titel {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hoorder-item {
            margin-bottom: 8px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .hoorder-item-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .hoorder-item-value {
            color: var(--text-primary);
        }

        .hoorder-lijst {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .hoorder-lijst li {
            padding: 4px 0;
            padding-left: 15px;
            position: relative;
        }

        .hoorder-lijst li::before {
            content: "â€¢";
            color: var(--accent);
            position: absolute;
            left: 0;
        }

        .hoorder-schrift {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
        }

        .hoorder-schrift-titel {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1em;
        }

        .hoorder-schrift-item {
            margin-bottom: 12px;
        }

        .hoorder-schrift-label {
            font-weight: 600;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 3px;
        }

        .hoorder-schrift-tekst {
            font-style: italic;
            line-height: 1.6;
        }

        .hoorder-vraag {
            margin-top: 15px;
            padding: 15px;
            background: var(--accent);
            color: white;
            font-style: italic;
            text-align: center;
            font-size: 1.05em;
        }

        /* Motivaction cards */
        .motivaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .motivaction-card {
            background: var(--bg-secondary);
            padding: 15px;
            border-left: 4px solid var(--accent);
        }

        .motivaction-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .motivaction-title {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.05em;
        }

        .motivaction-percentage {
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .motivaction-kenmerken {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .motivaction-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 10px;
            margin-bottom: 4px;
        }

        .motivaction-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .motivaction-tag {
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Homiletische Plot */
        .plot-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .plot-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-left: 5px solid var(--accent);
            position: relative;
        }

        .plot-card:nth-child(1) { border-left-color: #e57373; }
        .plot-card:nth-child(2) { border-left-color: #ffb74d; }
        .plot-card:nth-child(3) { border-left-color: #fff176; }
        .plot-card:nth-child(4) { border-left-color: #81c784; }
        .plot-card:nth-child(5) { border-left-color: #64b5f6; }

        .plot-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .plot-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            flex-shrink: 0;
        }

        .plot-card:nth-child(1) .plot-badge { background: #e57373; }
        .plot-card:nth-child(2) .plot-badge { background: #ffb74d; }
        .plot-card:nth-child(3) .plot-badge { background: #fff176; color: var(--text-primary); }
        .plot-card:nth-child(4) .plot-badge { background: #81c784; }
        .plot-card:nth-child(5) .plot-badge { background: #64b5f6; }

        .plot-title {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-primary);
        }

        .plot-doel {
            font-style: italic;
            color: var(--text-muted);
            font-size: 0.9em;
            margin-top: 4px;
        }

        .plot-content {
            font-size: 0.95em;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .plot-content > div {
            margin-bottom: 10px;
        }

        .plot-content strong {
            color: var(--text-primary);
        }

        /* Kalender */
        .kalender-dag {
            background: var(--bg-secondary);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .kalender-dag.preekzondag {
            border-left-color: var(--success);
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.1) 0%, var(--bg-secondary) 100%);
        }

        .kalender-datum {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .kalender-dag.preekzondag .kalender-datum {
            color: var(--success);
        }

        .kalender-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .kalender-item {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 4px;
        }

        .kalender-item-label {
            font-size: 0.75em;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .kalender-item-content {
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .kalender-item-content ul {
            margin: 0;
            padding-left: 16px;
        }

        .kalender-item-content li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <header id="header">
        <div class="header-left">
            <button class="menu-toggle bevel-raised" id="menu-toggle">â˜°</button>
            <div class="logo">Liturgische Analyse</div>
        </div>
        <div class="header-center">
            <button class="load-btn bevel-raised" id="load-btn">
                <span>ðŸ“‚</span> <span>JSON Laden</span>
            </button>
            <input type="file" id="file-input" accept=".json">
        </div>
        <div class="header-right">
            <div class="theme-toggle" id="theme-toggle" title="Dark mode"></div>
            <a href="https://github.com/wmotte/verkondiging" target="_blank" class="icon-btn bevel-raised" title="GitHub">i</a>
        </div>
    </header>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">Navigatie</div>
        <div id="nav-items">
            <!-- Nav items will be inserted here -->
        </div>
    </nav>

    <main id="main-content">
        <div class="welcome">
            <div class="welcome-icon">ðŸ“–</div>
            <h1>Welkom</h1>
            <p>Klik op de knop <strong>"JSON Laden"</strong> hierboven om een liturgische analyse te openen.</p>
            <p style="color: var(--text-muted); font-size: 0.9em;">Selecteer een <code>combined_output.json</code> bestand uit de output map.</p>
        </div>
    </main>

    <button class="scroll-top" id="scroll-top" title="Naar boven">&#9650;</button>

    <script>
        // State
        let jsonData = null;
        let lastScrollTop = 0;
        let sidebarVisible = window.innerWidth > 900;

        // DOM elements
        const header = document.getElementById('header');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const navItems = document.getElementById('nav-items');
        const loadBtn = document.getElementById('load-btn');
        const fileInput = document.getElementById('file-input');
        const themeToggle = document.getElementById('theme-toggle');
        const menuToggle = document.getElementById('menu-toggle');
        const scrollTopBtn = document.getElementById('scroll-top');

        // Section titles mapping
        const sectionTitles = {
            '00_meta': 'Metadata',
            '01_zondag_kerkelijk_jaar': 'Zondag Kerkelijk Jaar',
            '02_sociaal_maatschappelijke_context': 'Sociaal-Maatschappelijke Context',
            '03_waardenorientatie': 'WaardenoriÃ«ntatie',
            '04_geloofsorientatie': 'GeloofsoriÃ«ntatie',
            '05_interpretatieve_synthese': 'Interpretatieve Synthese',
            '06_actueel_wereldnieuws': 'Actueel Wereldnieuws',
            '07_politieke_orientatie': 'Politieke OriÃ«ntatie',
            '08_exegese': 'Exegese',
            '09_kunst_cultuur': 'Kunst & Cultuur',
            '10_focus_en_functie': 'Focus & Functie',
            '11_kalender': 'Kalender',
            '12_representatieve_hoorders': 'Representatieve Hoorders',
            '13_homiletische_analyse': 'Homiletische Analyse',
            '14_gebeden': 'Gebeden',
            'Bijbelteksten': 'Bijbelteksten'
        };

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        });

        // Menu toggle (mobile)
        menuToggle.addEventListener('click', () => {
            sidebarVisible = !sidebarVisible;
            sidebar.classList.toggle('visible', sidebarVisible);
        });

        // File loading
        loadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileLoad);

        async function handleFileLoad(e) {
            const file = e.target.files[0];
            if (!file) return;

            mainContent.innerHTML = '<div class="loading">Bestand laden...</div>';

            try {
                const text = await file.text();
                jsonData = JSON.parse(text);
                renderContent();
            } catch (err) {
                mainContent.innerHTML = `<div class="welcome"><h1>Fout</h1><p>Kon bestand niet laden: ${err.message}</p></div>`;
            }
        }

        // Render all content
        function renderContent() {
            if (!jsonData) return;

            let html = '';

            // Render meta box first
            if (jsonData['00_meta']) {
                const meta = jsonData['00_meta'];
                html += `
                    <div class="meta-box bevel-raised">
                        <h1>${escapeHtml(meta.plaatsnaam || 'Liturgische Analyse')}</h1>
                        <div class="gemeente">${escapeHtml(meta.gemeente || '')}</div>
                        <div class="datum">${escapeHtml(meta.datum || '')}</div>
                        <div class="adres">${escapeHtml(meta.adres || '')}</div>
                        ${meta.website ? `<a href="${escapeHtml(meta.website)}" target="_blank">${escapeHtml(meta.website)}</a>` : ''}
                    </div>
                `;
            }

            // Build nav and content
            let navHtml = '';
            const sections = Object.keys(jsonData).filter(k => k !== '00_meta').sort();

            sections.forEach((key, index) => {
                const title = sectionTitles[key] || formatKey(key);
                // Extract number from key like "01_zondag" or use index+15 for unnumbered sections
                const numMatch = key.match(/^(\d+)_/);
                const num = numMatch ? numMatch[1] : String(15 + index).padStart(2, '0');
                const sectionData = jsonData[key];

                // Special handling for Bijbelteksten - show bible references as submenu
                let subSections = [];
                let subSectionLabels = {};

                if (key === 'Bijbelteksten') {
                    // Get liturgical order from lezingen section
                    const lezingenOrder = [];
                    const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen;
                    if (lezingen) {
                        // Define liturgical order
                        const orderKeys = ['eerste_lezing', 'psalm', 'epistel', 'evangelie'];
                        orderKeys.forEach(lezingKey => {
                            if (lezingen[lezingKey]) {
                                const lez = lezingen[lezingKey];
                                // Map Dutch book names to codes
                                const boekCode = getBoekCode(lez.boek || lez.referentie);
                                const hoofdstuk = lez.hoofdstuk || lez.nummer;
                                if (boekCode && hoofdstuk) {
                                    lezingenOrder.push({ book: boekCode, chapter: hoofdstuk });
                                }
                            }
                        });
                    }

                    // Collect all perikopen with their liturgical order
                    const allPerikopen = [];

                    ['nbv21', 'naardense_bijbel'].forEach(vertaling => {
                        if (sectionData[vertaling] && Array.isArray(sectionData[vertaling])) {
                            sectionData[vertaling].forEach(perikoop => {
                                const eersteVers = perikoop.verses[0]?.verse || 1;
                                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                                const verzen = eersteVers === laatsteVers ? String(eersteVers) : `${eersteVers}-${laatsteVers}`;
                                const vertalingLabel = vertaling === 'nbv21' ? 'NBV21' : 'NB';

                                // Find liturgical order index
                                let orderIndex = lezingenOrder.findIndex(l =>
                                    l.book === perikoop.book && l.chapter === perikoop.chapter
                                );
                                if (orderIndex === -1) orderIndex = 999; // Unknown goes to end

                                allPerikopen.push({
                                    vertaling: vertalingLabel,
                                    vertalingKey: vertaling,
                                    book: perikoop.book,
                                    chapter: perikoop.chapter,
                                    verzen: verzen,
                                    orderIndex: orderIndex,
                                    subKey: `${perikoop.book}-${perikoop.chapter}-${vertaling}`
                                });
                            });
                        }
                    });

                    // Sort by liturgical order, then by translation (NBV21 first)
                    allPerikopen.sort((a, b) => {
                        if (a.orderIndex !== b.orderIndex) return a.orderIndex - b.orderIndex;
                        return a.vertalingKey === 'nbv21' ? -1 : 1;
                    });

                    // Build submenu items
                    allPerikopen.forEach(item => {
                        const boekNaam = getBijbelboekNaam(item.book);
                        const label = `${boekNaam} ${item.chapter}:${item.verzen} (${item.vertaling})`;
                        subSections.push(item.subKey);
                        subSectionLabels[item.subKey] = label;
                    });
                } else {
                    // Default: get subsections from top-level keys
                    subSections = Object.keys(sectionData)
                        .filter(k => !k.startsWith('_'))
                        .filter(k => {
                            const val = sectionData[k];
                            return val !== null && val !== undefined;
                        })
                        .slice(0, 12); // Limit to 12 subsections
                }

                navHtml += `
                    <div class="nav-group">
                        <div class="nav-item" data-section="${key}" data-has-submenu="${subSections.length > 0}">
                            <span class="nav-number">${num}</span>
                            ${escapeHtml(title)}
                            ${subSections.length > 0 ? '<span class="nav-toggle">â–¶</span>' : ''}
                        </div>
                        ${subSections.length > 0 ? `
                            <div class="nav-submenu" data-section="${key}">
                                ${subSections.map(subKey => `
                                    <a href="#section-${key}-${subKey}" class="nav-subitem" data-section="${key}" data-subsection="${subKey}">
                                        ${escapeHtml(subSectionLabels[subKey] || formatKey(subKey))}
                                    </a>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;

                html += renderSection(key, sectionData, index);
            });

            navItems.innerHTML = navHtml;
            mainContent.innerHTML = html;

            // Add click handlers to nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const sectionKey = item.dataset.section;
                    const hasSubmenu = item.dataset.hasSubmenu === 'true';

                    // Toggle submenu
                    if (hasSubmenu) {
                        item.classList.toggle('expanded');
                        const submenu = item.nextElementSibling;
                        if (submenu && submenu.classList.contains('nav-submenu')) {
                            submenu.classList.toggle('open');
                        }
                    }

                    // Navigate to section
                    const section = document.getElementById(`section-${sectionKey}`);
                    if (section) {
                        section.scrollIntoView({ behavior: 'smooth' });
                    }

                    // Close sidebar on mobile
                    if (window.innerWidth <= 900) {
                        sidebar.classList.remove('visible');
                        sidebarVisible = false;
                    }
                });
            });

            // Add click handlers to nav subitems
            document.querySelectorAll('.nav-subitem').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const sectionKey = item.dataset.section;
                    const subKey = item.dataset.subsection;

                    // Try to find the subsection element
                    let target = document.getElementById(`section-${sectionKey}-${subKey}`);
                    if (!target) {
                        // Fallback to main section
                        target = document.getElementById(`section-${sectionKey}`);
                    }

                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }

                    // Close sidebar on mobile
                    if (window.innerWidth <= 900) {
                        sidebar.classList.remove('visible');
                        sidebarVisible = false;
                    }
                });
            });
        }

        function renderSection(key, data, index) {
            const title = sectionTitles[key] || formatKey(key);
            // Extract number from key like "01_zondag" or use index+15 for unnumbered sections
            const numMatch = key.match(/^(\d+)_/);
            const num = numMatch ? numMatch[1] : String(15 + index).padStart(2, '0');
            const meta = data._meta || {};
            const generatedAt = meta.generated_at ? new Date(meta.generated_at).toLocaleString('nl-NL') : '';

            let contentHtml = '';

            // Render data without _meta
            const dataToRender = { ...data };
            delete dataToRender._meta;

            // Special handling for Bijbelteksten - render in liturgical order
            if (key === 'Bijbelteksten') {
                contentHtml = renderBijbeltekstenSection(dataToRender);
            } else if (key === '14_gebeden') {
                contentHtml = renderGebedenSection(dataToRender);
            } else if (key === '12_representatieve_hoorders') {
                contentHtml = renderHoordersSection(dataToRender);
            } else {
                contentHtml = renderObjectWithIds(dataToRender, key);
            }

            return `
                <section class="section bevel-raised" id="section-${key}">
                    <div class="section-header">
                        <div class="section-number">${num}</div>
                        <h2 class="section-title">${escapeHtml(title)}</h2>
                        ${generatedAt ? `<div class="section-meta">Gegenereerd: ${escapeHtml(generatedAt)}</div>` : ''}
                    </div>
                    <div class="section-content content-wrapper">
                        ${contentHtml}
                    </div>
                </section>
            `;
        }

        // Render object with IDs for navigation
        function renderObjectWithIds(obj, sectionKey) {
            if (!obj || typeof obj !== 'object') {
                return `<div class="data-value">${formatValue(obj)}</div>`;
            }

            let html = '';
            const entries = Object.entries(obj).filter(([k, v]) => !k.startsWith('_') && v !== null && v !== undefined);

            for (const [key, value] of entries) {
                const anchor = `<div id="section-${sectionKey}-${key}" class="subsection-anchor"></div>`;
                html += anchor + renderSingleEntry(key, value, sectionKey);
            }

            return html;
        }

        function renderObject(obj, parentKey = '') {
            if (!obj || typeof obj !== 'object') {
                return `<div class="data-value">${formatValue(obj)}</div>`;
            }

            let html = '';

            // Analyze object structure for smart rendering
            const entries = Object.entries(obj).filter(([k, v]) => !k.startsWith('_') && v !== null && v !== undefined);

            // Check if this object has multiple child objects with simple string values (good for grid)
            const childObjects = entries.filter(([k, v]) => typeof v === 'object' && !Array.isArray(v));
            const simpleValues = entries.filter(([k, v]) => typeof v !== 'object');

            // If we have multiple simple string values, render as compact data pairs
            if (simpleValues.length >= 3 && simpleValues.length <= 8 && childObjects.length === 0) {
                const shortValues = simpleValues.filter(([k, v]) => String(v).length < 100);
                if (shortValues.length >= 3) {
                    html += `<div class="data-pairs">`;
                    shortValues.forEach(([key, value]) => {
                        if (key === 'zoekterm') {
                            html += `<div class="data-pair"><div class="data-pair-label">${escapeHtml(formatKey(key))}</div><div class="data-pair-value"><span class="search-term">${escapeHtml(value)}</span></div></div>`;
                        } else {
                            html += `<div class="data-pair"><div class="data-pair-label">${escapeHtml(formatKey(key))}</div><div class="data-pair-value">${formatValue(value)}</div></div>`;
                        }
                    });
                    html += `</div>`;

                    // Render remaining non-simple values normally
                    const remaining = entries.filter(([k, v]) => typeof v === 'object' || String(v).length >= 100);
                    for (const [key, value] of remaining) {
                        html += renderSingleEntry(key, value, parentKey);
                    }
                    return html;
                }
            }

            // If we have multiple child objects, render as grid cards
            if (childObjects.length >= 2 && childObjects.length <= 6) {
                // Check if child objects are simple enough for cards
                const simpleChildObjects = childObjects.filter(([k, v]) => {
                    const childEntries = Object.entries(v).filter(([ck, cv]) => !ck.startsWith('_'));
                    return childEntries.every(([ck, cv]) => typeof cv !== 'object' || Array.isArray(cv));
                });

                if (simpleChildObjects.length >= 2) {
                    // Render simple values first
                    for (const [key, value] of simpleValues) {
                        html += renderSingleEntry(key, value, parentKey);
                    }

                    // Render child objects as grid
                    html += `<div class="card-grid">`;
                    for (const [key, value] of simpleChildObjects) {
                        html += `<div class="nested-card">`;
                        html += `<div class="nested-card-title">${escapeHtml(formatKey(key))}</div>`;
                        html += `<div class="nested-card-content">${renderObjectCompact(value)}</div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;

                    // Render remaining complex objects normally
                    const complexChildObjects = childObjects.filter(([k]) => !simpleChildObjects.find(([sk]) => sk === k));
                    for (const [key, value] of complexChildObjects) {
                        html += renderSingleEntry(key, value, parentKey);
                    }
                    return html;
                }
            }

            // Default rendering
            for (const [key, value] of entries) {
                html += renderSingleEntry(key, value, parentKey);
            }

            return html;
        }

        function renderSingleEntry(key, value, parentKey) {
            let html = '';
            const formattedKey = formatKey(key);

            // Special rendering for specific keys
            if (key === 'liedsuggesties' || key.includes('lied')) {
                return renderLiedsuggesties(key, value);
            }

            if (key === 'lezingen') {
                return renderLezingen(value);
            }

            if (key === 'hoorders' || parentKey === '12_representatieve_hoorders') {
                if (Array.isArray(value) && value.length > 0 && typeof value[0] === 'object' && value[0].naam) {
                    return renderHoorders(value);
                }
            }

            if (key === 'gebeden' && Array.isArray(value)) {
                return renderGebeden(value);
            }

            // Focus en functie opties
            if (key === 'opties' && parentKey === '10_focus_en_functie') {
                return renderFocusFunctie(value);
            }

            // Motivaction milieus
            if (key === 'waarschijnlijk_aanwezig' || key === 'motivaction_milieus') {
                if (Array.isArray(value) && value.length > 0 && value[0].milieu) {
                    return renderMotivaction(key, value);
                }
            }

            // Kalender dagen
            if (key === 'dagen' && Array.isArray(value) && value.length > 0 && value[0].datum) {
                return renderKalender(value);
            }

            // Homiletische Plot
            if (key === 'homiletical_plot' || key === 'homiletische_plot') {
                return renderHomiletischePlot(value);
            }

            // Bijbelteksten (Naardense Bijbel en NBV21)
            if ((key === 'naardense_bijbel' || key === 'nbv21') && Array.isArray(value)) {
                return renderBijbelteksten(key, value);
            }

            if (Array.isArray(value)) {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">${escapeHtml(formattedKey)}</div>`;
                html += renderArray(value, key);
                html += `</div>`;
            } else if (typeof value === 'object') {
                html += `<div class="data-group">`;
                html += `<div class="data-group-title">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="nested-object">`;
                html += renderObject(value, key);
                html += `</div></div>`;
            } else if (key === 'zoekterm') {
                html += `<div class="data-item">`;
                html += `<div class="data-label">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="data-value"><span class="search-term">${escapeHtml(value)}</span></div>`;
                html += `</div>`;
            } else {
                html += `<div class="data-item">`;
                html += `<div class="data-label">${escapeHtml(formattedKey)}</div>`;
                html += `<div class="data-value">${formatValue(value)}</div>`;
                html += `</div>`;
            }
            return html;
        }

        function renderObjectCompact(obj) {
            if (!obj || typeof obj !== 'object') {
                return formatValue(obj);
            }

            let html = '';
            for (const [key, value] of Object.entries(obj)) {
                if (key.startsWith('_')) continue;
                if (value === null || value === undefined) continue;

                if (Array.isArray(value)) {
                    if (value.every(v => typeof v === 'string')) {
                        html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                    } else {
                        html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += renderArray(value, key);
                    }
                } else if (typeof value === 'object') {
                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                    html += `<div style="margin-left: 10px;">${renderObjectCompact(value)}</div>`;
                } else if (key === 'zoekterm') {
                    html += `<div style="margin-bottom: 4px;"><span class="search-term">${escapeHtml(value)}</span></div>`;
                } else {
                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${formatValue(value)}</div>`;
                }
            }
            return html;
        }

        function renderArray(arr, parentKey = '') {
            if (arr.length === 0) return '<div class="data-value">Geen items</div>';

            // Check if it's a simple array of strings
            if (arr.every(item => typeof item === 'string' || typeof item === 'number')) {
                // Check if short enough for tags
                if (arr.every(item => String(item).length < 40) && arr.length <= 10) {
                    return `<div class="tag-list">${arr.map(item => `<span class="tag">${processText(String(item))}</span>`).join('')}</div>`;
                }
                return `<ul class="array-list">${arr.map(item => `<li class="array-item">${processText(String(item))}</li>`).join('')}</ul>`;
            }

            // Array of objects - check if suitable for grid
            if (arr.every(item => typeof item === 'object') && arr.length >= 2) {
                // Check if objects are simple enough for grid cards
                const isSimpleObjects = arr.every(item => {
                    const entries = Object.entries(item).filter(([k]) => !k.startsWith('_'));
                    const hasDeepNesting = entries.some(([k, v]) => typeof v === 'object' && !Array.isArray(v));
                    return entries.length <= 8 && !hasDeepNesting;
                });

                if (isSimpleObjects) {
                    let html = `<div class="card-grid">`;
                    arr.forEach(item => {
                        // Try to find a title field
                        const titleKey = Object.keys(item).find(k =>
                            ['titel', 'naam', 'name', 'title', 'gebeurtenis', 'trend', 'milieu'].includes(k.toLowerCase())
                        );
                        const title = titleKey ? item[titleKey] : null;

                        html += `<div class="nested-card">`;
                        if (title && typeof title === 'string') {
                            html += `<div class="nested-card-title">${processText(title)}</div>`;
                        }
                        html += `<div class="nested-card-content">`;

                        for (const [key, value] of Object.entries(item)) {
                            if (key.startsWith('_')) continue;
                            if (key === titleKey) continue; // Skip title, already shown
                            if (value === null || value === undefined) continue;

                            if (key === 'zoekterm') {
                                html += `<div style="margin-top: 6px;"><span class="search-term">${escapeHtml(value)}</span></div>`;
                            } else if (Array.isArray(value)) {
                                if (value.every(v => typeof v === 'string') && value.length <= 5) {
                                    html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                                }
                            } else if (typeof value !== 'object') {
                                html += `<div style="margin-bottom: 4px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${formatValue(value)}</div>`;
                            }
                        }

                        html += `</div></div>`;
                    });
                    html += `</div>`;
                    return html;
                }
            }

            // Default: render each object normally
            return arr.map((item, i) => {
                if (typeof item === 'object') {
                    return `<div class="nested-object">${renderObject(item, parentKey)}</div>`;
                }
                return `<div class="array-item">${formatValue(item)}</div>`;
            }).join('');
        }

        function renderLiedsuggesties(key, value) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">${escapeHtml(formatKey(key))}</div>`;

            if (typeof value === 'object' && !Array.isArray(value)) {
                for (const [category, liederen] of Object.entries(value)) {
                    if (category.startsWith('_')) continue;
                    if (!Array.isArray(liederen)) continue;

                    html += `<div style="margin-top: 15px; margin-bottom: 8px;"><strong>${escapeHtml(formatKey(category))}</strong></div>`;
                    html += `<div class="lied-grid">`;

                    liederen.forEach(lied => {
                        if (typeof lied === 'object') {
                            html += `<div class="lied-item">`;
                            if (lied.nummer) html += `<div class="lied-nummer">${processText(lied.nummer)}</div>`;
                            if (lied.titel) html += `<div class="lied-titel">${processText(lied.titel)}</div>`;
                            if (lied.eerste_regel) html += `<div class="lied-regel">\u201c${processText(lied.eerste_regel)}\u201d</div>`;
                            if (lied.toelichting) html += `<div class="lied-toelichting">${processText(lied.toelichting)}</div>`;
                            html += `</div>`;
                        }
                    });

                    html += `</div>`;
                }
            }

            html += `</div>`;
            return html;
        }

        function renderLezingen(value) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Lezingen</div>`;

            // Collect main readings for grid
            let gridCards = [];
            let altLezingen = null;
            let samenhang = null;

            for (const [key, lezing] of Object.entries(value)) {
                if (key.startsWith('_')) continue;

                if (key === 'thematische_samenhang') {
                    samenhang = lezing;
                    continue;
                }

                if (key === 'alternatieve_lezingen' && Array.isArray(lezing)) {
                    altLezingen = lezing;
                    continue;
                }

                if (typeof lezing !== 'object') continue;

                let card = `<div class="lezing-card">`;
                card += `<div class="lezing-label">${escapeHtml(formatKey(key))}</div>`;
                if (lezing.referentie) card += `<div class="lezing-ref">${processText(lezing.referentie)}</div>`;
                if (lezing.thema) card += `<div class="lezing-thema">${processText(lezing.thema)}</div>`;
                if (lezing.antifoon) card += `<div class="lezing-thema">Antifoon: \u201c${processText(lezing.antifoon)}\u201d</div>`;
                card += `</div>`;
                gridCards.push(card);
            }

            // Render main readings in grid
            if (gridCards.length > 0) {
                html += `<div class="card-grid">${gridCards.join('')}</div>`;
            }

            // Thematische samenhang
            if (samenhang && typeof samenhang === 'string') {
                html += `<div class="quote-block"><strong>Thematische samenhang:</strong><br>${processText(samenhang)}</div>`;
            }

            // Alternative readings
            if (altLezingen && altLezingen.length > 0) {
                html += `<div style="margin-top: 15px;"><strong>Alternatieve lezingen</strong></div>`;
                html += `<div class="card-grid">`;
                altLezingen.forEach(alt => {
                    html += `<div class="lezing-card">`;
                    html += `<div class="lezing-ref">${processText(alt.referentie || '')}</div>`;
                    if (alt.reden) html += `<div class="lezing-thema">${processText(alt.reden)}</div>`;
                    html += `</div>`;
                });
                html += `</div>`;
            }

            html += `</div>`;
            return html;
        }

        function renderHoorders(hoorders) {
            let html = '';

            hoorders.forEach(hoorder => {
                html += `<div class="hoorder-card">`;
                // Handle naam as object with voornaam/achternaam or as string
                let naamText = 'Onbekend';
                if (hoorder.naam) {
                    if (typeof hoorder.naam === 'object') {
                        naamText = [hoorder.naam.voornaam, hoorder.naam.achternaam].filter(Boolean).join(' ');
                    } else {
                        naamText = hoorder.naam;
                    }
                }
                html += `<div class="hoorder-naam">${processText(naamText)}</div>`;

                html += `<div class="hoorder-details">`;
                if (hoorder.leeftijd) html += `<div class="hoorder-detail"><strong>Leeftijd:</strong> ${processText(String(hoorder.leeftijd))}</div>`;
                if (hoorder.beroep) html += `<div class="hoorder-detail"><strong>Beroep:</strong> ${processText(hoorder.beroep)}</div>`;
                if (hoorder.gezinssituatie) html += `<div class="hoorder-detail"><strong>Gezin:</strong> ${processText(hoorder.gezinssituatie)}</div>`;
                if (hoorder.kerkelijke_betrokkenheid) html += `<div class="hoorder-detail"><strong>Kerkelijk:</strong> ${processText(hoorder.kerkelijke_betrokkenheid)}</div>`;
                html += `</div>`;

                // Other fields
                for (const [key, value] of Object.entries(hoorder)) {
                    if (['naam', 'leeftijd', 'beroep', 'gezinssituatie', 'kerkelijke_betrokkenheid'].includes(key)) continue;
                    if (key.startsWith('_')) continue;

                    if (typeof value === 'string') {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong> ${processText(value)}</div>`;
                    } else if (Array.isArray(value)) {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<ul style="margin-left: 20px;">`;
                        value.forEach(item => {
                            html += `<li>${processText(String(item))}</li>`;
                        });
                        html += `</ul>`;
                    } else if (typeof value === 'object' && value) {
                        html += `<div style="margin-top: 10px;"><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<div class="nested-object">${renderObject(value, key)}</div>`;
                    }
                }

                html += `</div>`;
            });

            return html;
        }

        function renderGebeden(gebeden) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Gebeden</div>`;

            gebeden.forEach(gebed => {
                if (typeof gebed === 'object') {
                    html += `<div class="gebed-block">`;
                    if (gebed.titel || gebed.type) {
                        html += `<div class="gebed-titel">${processText(gebed.titel || gebed.type || '')}</div>`;
                    }
                    if (gebed.tekst) {
                        html += processText(gebed.tekst);
                    } else if (gebed.inhoud) {
                        html += processText(gebed.inhoud);
                    }
                    html += `</div>`;
                } else if (typeof gebed === 'string') {
                    html += `<div class="gebed-block">${processText(gebed)}</div>`;
                }
            });

            html += `</div>`;
            return html;
        }

        function renderFocusFunctie(opties) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Opties</div>`;

            opties.forEach(optie => {
                html += `<div class="focus-card">`;

                // Header with number and title
                html += `<div class="focus-card-header">`;
                html += `<div class="focus-card-number">${optie.nummer || ''}</div>`;
                html += `<div>`;
                html += `<div class="focus-card-title">${processText(optie.korte_titel || '')}</div>`;
                if (optie.type_insteek) {
                    html += `<span class="focus-card-type">${processText(optie.type_insteek)}</span>`;
                }
                html += `</div></div>`;

                // Three sections: Focus, Anticipatie, Functie
                html += `<div class="focus-sections">`;

                // Focus section
                if (optie.focus) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Focus</div>`;
                    html += `<div class="focus-section-content">${processText(optie.focus.inhoud || '')}</div>`;
                    html += `</div>`;
                }

                // Anticipatie section
                if (optie.anticipatie) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Anticipatie</div>`;
                    html += `<div class="focus-section-content">`;
                    if (optie.anticipatie.weerstand) html += `<div style="margin-bottom: 6px;"><strong>Weerstand:</strong> ${processText(optie.anticipatie.weerstand)}</div>`;
                    if (optie.anticipatie.herkenning) html += `<div style="margin-bottom: 6px;"><strong>Herkenning:</strong> ${processText(optie.anticipatie.herkenning)}</div>`;
                    if (optie.anticipatie.vragen && optie.anticipatie.vragen.length) {
                        html += `<div><strong>Vragen:</strong><ul style="margin: 4px 0 0 16px;">`;
                        optie.anticipatie.vragen.forEach(v => html += `<li>${processText(v)}</li>`);
                        html += `</ul></div>`;
                    }
                    html += `</div></div>`;
                }

                // Functie section
                if (optie.functie) {
                    html += `<div class="focus-section">`;
                    html += `<div class="focus-section-title">Functie</div>`;
                    html += `<div class="focus-section-content">${processText(optie.functie.beoogd_effect || '')}</div>`;
                    html += `</div>`;
                }

                html += `</div>`; // end focus-sections

                // Toelichting
                if (optie.toelichting) {
                    html += `<div class="focus-toelichting">${processText(optie.toelichting)}</div>`;
                }

                html += `</div>`; // end focus-card
            });

            html += `</div>`;
            return html;
        }

        function renderMotivaction(key, milieus) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">${escapeHtml(formatKey(key))}</div>`;
            html += `<div class="motivaction-grid">`;

            milieus.forEach(milieu => {
                html += `<div class="motivaction-card">`;

                // Header
                html += `<div class="motivaction-header">`;
                html += `<div class="motivaction-title">${processText(milieu.milieu || '')}</div>`;
                if (milieu.geschat_percentage) {
                    html += `<span class="motivaction-percentage">${processText(milieu.geschat_percentage)}</span>`;
                }
                html += `</div>`;

                // Kenmerken
                if (milieu.kenmerken_lokaal) {
                    html += `<div class="motivaction-kenmerken">${processText(milieu.kenmerken_lokaal)}</div>`;
                }

                // Taal die resoneert
                if (milieu.taal_die_resoneert && milieu.taal_die_resoneert.length) {
                    html += `<div class="motivaction-label">Taal die resoneert</div>`;
                    html += `<div class="motivaction-tags">`;
                    milieu.taal_die_resoneert.forEach(t => html += `<span class="motivaction-tag">${processText(t)}</span>`);
                    html += `</div>`;
                }

                // Beelden die werken
                if (milieu.beelden_die_werken && milieu.beelden_die_werken.length) {
                    html += `<div class="motivaction-label">Beelden die werken</div>`;
                    html += `<div class="motivaction-tags">`;
                    milieu.beelden_die_werken.forEach(b => html += `<span class="motivaction-tag">${processText(b)}</span>`);
                    html += `</div>`;
                }

                html += `</div>`; // end motivaction-card
            });

            html += `</div></div>`;
            return html;
        }

        function renderKalender(dagen) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Dagen</div>`;

            dagen.forEach(dag => {
                const isPreekzondag = dag.is_preekzondag === true;
                html += `<div class="kalender-dag ${isPreekzondag ? 'preekzondag' : ''}">`;
                html += `<div class="kalender-datum">${processText(dag.datum || '')}${isPreekzondag ? ' (Preekzondag)' : ''}</div>`;
                html += `<div class="kalender-content">`;

                // Helper to check if value has content
                const hasContent = (val) => {
                    if (val === null || val === undefined) return false;
                    if (Array.isArray(val)) return val.length > 0;
                    if (typeof val === 'object') {
                        return Object.values(val).some(v => v !== null && v !== undefined && v !== '');
                    }
                    return val !== '';
                };

                // Kerkelijk
                if (hasContent(dag.kerkelijk)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Kerkelijk</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.kerkelijk.forEach(k => {
                        html += `<li><strong>${processText(k.naam || '')}</strong>`;
                        if (k.toelichting) html += `<br><span style="font-size: 0.85em; color: var(--text-muted);">${processText(k.toelichting)}</span>`;
                        html += `</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Joods
                if (hasContent(dag.joods)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Joods</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.joods.hebreeuwse_datum) html += `<div>${processText(dag.joods.hebreeuwse_datum)}</div>`;
                    if (dag.joods.feestdag) html += `<div><strong>${processText(dag.joods.feestdag)}</strong></div>`;
                    if (dag.joods.parasja) html += `<div>Parasja: ${processText(dag.joods.parasja)}</div>`;
                    if (dag.joods.toelichting) html += `<div style="font-size: 0.85em; color: var(--text-muted); margin-top: 4px;">${processText(dag.joods.toelichting)}</div>`;
                    html += `</div></div>`;
                }

                // Vakantie
                if (hasContent(dag.vakantie)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Vakantie</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.vakantie.schoolvakantie) html += `<div><strong>${processText(dag.vakantie.schoolvakantie)}</strong></div>`;
                    if (dag.vakantie.regio) html += `<div style="font-size: 0.85em;">${processText(dag.vakantie.regio)}</div>`;
                    html += `</div></div>`;
                }

                // Weer
                if (hasContent(dag.weer)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Weer</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.weer.verwachting) html += `<div>${processText(dag.weer.verwachting)}</div>`;
                    if (dag.weer.temperatuur) html += `<div>${processText(dag.weer.temperatuur)}</div>`;
                    html += `</div></div>`;
                }

                // Astronomie
                if (hasContent(dag.astronomie)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Astronomie</div>`;
                    html += `<div class="kalender-item-content">`;
                    if (dag.astronomie.zonsopgang && dag.astronomie.zonsondergang) {
                        html += `<div>â˜€ ${processText(dag.astronomie.zonsopgang)} - ${processText(dag.astronomie.zonsondergang)}</div>`;
                    }
                    if (dag.astronomie.maanfase) html += `<div>ðŸŒ™ ${processText(dag.astronomie.maanfase)}</div>`;
                    if (dag.astronomie.bijzonderheden) html += `<div style="font-size: 0.85em; margin-top: 4px;">${processText(dag.astronomie.bijzonderheden)}</div>`;
                    html += `</div></div>`;
                }

                // Nationaal
                if (hasContent(dag.nationaal)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Nationaal</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.nationaal.forEach(n => {
                        html += `<li>${processText(n.naam || '')}</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Internationaal
                if (hasContent(dag.internationaal)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Internationaal</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.internationaal.forEach(i => {
                        html += `<li>${processText(i.naam || '')}</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                // Overig
                if (hasContent(dag.overig)) {
                    html += `<div class="kalender-item">`;
                    html += `<div class="kalender-item-label">Overig</div>`;
                    html += `<div class="kalender-item-content"><ul>`;
                    dag.overig.forEach(o => {
                        html += `<li><strong>${processText(o.naam || '')}</strong>`;
                        if (o.toelichting) html += `<br><span style="font-size: 0.85em; color: var(--text-muted);">${processText(o.toelichting)}</span>`;
                        html += `</li>`;
                    });
                    html += `</ul></div></div>`;
                }

                html += `</div></div>`; // end kalender-content, kalender-dag
            });

            html += `</div>`;
            return html;
        }

        function renderHomiletischePlot(plot) {
            let html = `<div class="data-group">`;
            html += `<div class="data-group-title">Homiletische Plot</div>`;
            html += `<div class="plot-container">`;

            // Mapping of keys to Dutch abbreviations
            const plotStages = [
                { key: 'he_kwestie_oops', name: 'He' },
                { key: 'oei_verdieping_ugh', name: 'Oei' },
                { key: 'aha_wending_aha', name: 'Aha' },
                { key: 'ja_verkondiging_whee', name: 'Ja' },
                { key: 'zo_doorwerking_yeah', name: 'Zo' }
            ];

            plotStages.forEach(stage => {
                const data = plot[stage.key];
                if (!data) return;

                html += `<div class="plot-card">`;
                html += `<div class="plot-header">`;
                html += `<div class="plot-badge">${stage.name}</div>`;
                html += `<div>`;
                if (data.titel) {
                    // Extract only the part after " - " (e.g., "ZÃ“! (YEAH!) - De Doorwerking" â†’ "De Doorwerking")
                    const titelParts = data.titel.split(/\s*-\s*/);
                    const cleanTitel = titelParts.length > 1 ? titelParts.slice(1).join(' - ') : data.titel;
                    html += `<div class="plot-title">${processText(cleanTitel)}</div>`;
                }
                if (data.doel) {
                    html += `<div class="plot-doel">${processText(data.doel)}</div>`;
                }
                html += `</div></div>`;

                html += `<div class="plot-content">`;

                // Render all other fields
                for (const [key, value] of Object.entries(data)) {
                    if (['titel', 'doel'].includes(key)) continue;
                    if (key.startsWith('_')) continue;
                    if (value === null || value === undefined) continue;

                    if (Array.isArray(value)) {
                        // Handle arrays (like waarom_keten)
                        if (value.length > 0 && typeof value[0] === 'object' && value[0].vraag) {
                            // Waarom-keten format
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong><ul style="margin-left: 16px; margin-top: 6px;">`;
                            value.forEach(item => {
                                html += `<li><strong>V:</strong> ${processText(item.vraag || '')}<br><strong>A:</strong> ${processText(item.antwoord || '')}</li>`;
                            });
                            html += `</ul></div>`;
                        } else if (value.every(v => typeof v === 'string')) {
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong> ${value.map(v => processText(v)).join(', ')}</div>`;
                        } else {
                            html += `<div><strong>${escapeHtml(formatKey(key))}:</strong><ul style="margin-left: 16px; margin-top: 6px;">`;
                            value.forEach(item => {
                                html += `<li>${processText(typeof item === 'string' ? item : JSON.stringify(item))}</li>`;
                            });
                            html += `</ul></div>`;
                        }
                    } else if (typeof value === 'object') {
                        html += `<div><strong>${escapeHtml(formatKey(key))}:</strong></div>`;
                        html += `<div style="margin-left: 16px;">`;
                        for (const [subKey, subVal] of Object.entries(value)) {
                            if (subVal !== null && subVal !== undefined && typeof subVal !== 'object') {
                                html += `<div><strong>${escapeHtml(formatKey(subKey))}:</strong> ${processText(String(subVal))}</div>`;
                            }
                        }
                        html += `</div>`;
                    } else {
                        html += `<div><strong>${escapeHtml(formatKey(key))}:</strong> ${processText(String(value))}</div>`;
                    }
                }

                html += `</div></div>`; // end plot-content, plot-card
            });

            html += `</div></div>`; // end plot-container, data-group
            return html;
        }

        // Render Representatieve Hoorders section
        function renderHoordersSection(data) {
            let html = '';
            const personas = data.personas || [];

            personas.forEach(persona => {
                const naam = persona.naam ? `${persona.naam.voornaam} ${persona.naam.achternaam}` : 'Onbekend';
                const leeftijd = persona.leeftijd || '';
                const woonwijk = persona.basisgegevens?.woonwijk || '';

                html += `<div id="section-12_representatieve_hoorders-personas-${persona.nummer}" class="subsection-anchor"></div>`;
                html += `<div class="hoorder-card">`;

                // Header
                html += `<div class="hoorder-header">`;
                html += `<div class="hoorder-nummer">${persona.nummer || ''}</div>`;
                html += `<div class="hoorder-intro">`;
                html += `<div class="hoorder-naam">${escapeHtml(naam)}</div>`;
                html += `<div class="hoorder-meta">${leeftijd} jaar${woonwijk ? ` Â· ${escapeHtml(woonwijk)}` : ''}</div>`;
                html += `</div></div>`;

                // Kernschets
                if (persona.kernschets) {
                    html += `<div class="hoorder-kernschets">${processText(persona.kernschets)}</div>`;
                }

                html += `<div class="hoorder-content">`;
                html += `<div class="hoorder-grid">`;

                // Persoonlijk (basis + gezondheid)
                html += `<div class="hoorder-groep">`;
                html += `<div class="hoorder-groep-titel">Persoonlijk</div>`;
                if (persona.basisgegevens?.fysieke_verschijning) {
                    html += `<div class="hoorder-item">${processText(persona.basisgegevens.fysieke_verschijning)}</div>`;
                }
                if (persona.gezondheid) {
                    const gz = persona.gezondheid;
                    if (gz.lichamelijk) html += `<div class="hoorder-item"><span class="hoorder-item-label">Lichamelijk:</span> ${processText(gz.lichamelijk)}</div>`;
                    if (gz.mentaal) html += `<div class="hoorder-item"><span class="hoorder-item-label">Mentaal:</span> ${processText(gz.mentaal)}</div>`;
                    if (gz.leefstijl) html += `<div class="hoorder-item"><span class="hoorder-item-label">Leefstijl:</span> ${processText(gz.leefstijl)}</div>`;
                }
                html += `</div>`;

                // Relaties
                if (persona.relaties_sociaal) {
                    const rel = persona.relaties_sociaal;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Relaties & Sociaal</div>`;
                    const relInfo = [];
                    if (rel.relatiestatus) relInfo.push(rel.relatiestatus);
                    if (rel.woonsituatie) relInfo.push(rel.woonsituatie);
                    if (rel.kinderen) relInfo.push(rel.kinderen);
                    if (relInfo.length > 0) {
                        html += `<div class="hoorder-item">${processText(relInfo.join(' Â· '))}</div>`;
                    }
                    if (rel.familie_relatie) html += `<div class="hoorder-item">${processText(rel.familie_relatie)}</div>`;
                    if (rel.sociaal_netwerk) html += `<div class="hoorder-item">${processText(rel.sociaal_netwerk)}</div>`;
                    html += `</div>`;
                }

                // Werk & Opleiding
                if (persona.opleiding_werk) {
                    const ow = persona.opleiding_werk;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Werk & Opleiding</div>`;
                    if (ow.opleiding) html += `<div class="hoorder-item"><span class="hoorder-item-label">Opleiding:</span> ${processText(ow.opleiding)}</div>`;
                    if (ow.huidige_werk) html += `<div class="hoorder-item"><span class="hoorder-item-label">Werk:</span> ${processText(ow.huidige_werk)}</div>`;
                    if (ow.intelligentie_leerstijl) html += `<div class="hoorder-item"><span class="hoorder-item-label">Leerstijl:</span> ${processText(ow.intelligentie_leerstijl)}</div>`;
                    if (ow.financiele_situatie) html += `<div class="hoorder-item"><span class="hoorder-item-label">Financieel:</span> ${processText(ow.financiele_situatie)}</div>`;
                    html += `</div>`;
                }

                // Zorgen & Trauma's
                if (persona.traumas_zorgen) {
                    const tz = persona.traumas_zorgen;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Zorgen & Worstelingen</div>`;
                    if (tz.verleden && tz.verleden.length > 0) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Verleden:</span> ${processText(tz.verleden.join('; '))}</div>`;
                    }
                    if (tz.heden && tz.heden.length > 0) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Heden:</span> ${processText(tz.heden.join('; '))}</div>`;
                    }
                    if (tz.onverwerkt) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Onverwerkt:</span> ${processText(tz.onverwerkt)}</div>`;
                    }
                    html += `</div>`;
                }

                // Geloof
                if (persona.geloof_spiritualiteit) {
                    const gs = persona.geloof_spiritualiteit;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Geloof & Spiritualiteit</div>`;
                    if (gs.kerkelijke_achtergrond) html += `<div class="hoorder-item">${processText(gs.kerkelijke_achtergrond)}</div>`;
                    if (gs.huidige_betrokkenheid) html += `<div class="hoorder-item">${processText(gs.huidige_betrokkenheid)}</div>`;
                    if (gs.geloofsbeleving) html += `<div class="hoorder-item"><span class="hoorder-item-label">Beleving:</span> ${processText(gs.geloofsbeleving)}</div>`;
                    if (gs.geloofstaal) html += `<div class="hoorder-item"><span class="hoorder-item-label">Taal:</span> ${processText(gs.geloofstaal)}</div>`;
                    if (gs.twijfels_vragen && gs.twijfels_vragen.length > 0) {
                        html += `<div class="hoorder-item"><span class="hoorder-item-label">Vragen:</span><ul class="hoorder-lijst">`;
                        gs.twijfels_vragen.forEach(v => html += `<li>${processText(v)}</li>`);
                        html += `</ul></div>`;
                    }
                    if (gs.spirituele_behoeften) html += `<div class="hoorder-item"><span class="hoorder-item-label">Behoeften:</span> ${processText(gs.spirituele_behoeften)}</div>`;
                    html += `</div>`;
                }

                // Hobby's & Interesses
                if (persona.hobbys_interesses) {
                    const hi = persona.hobbys_interesses;
                    html += `<div class="hoorder-groep">`;
                    html += `<div class="hoorder-groep-titel">Interesses</div>`;
                    const alles = [];
                    if (hi.vrijetijd) alles.push(...hi.vrijetijd);
                    if (hi.media) alles.push(...hi.media);
                    if (hi.verenigingen) alles.push(...hi.verenigingen);
                    if (alles.length > 0) {
                        html += `<div class="hoorder-item">${processText(alles.join(' Â· '))}</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div>`; // end hoorder-grid

                // Aansluiting schriftlezingen
                if (persona.aansluiting_schriftlezingen) {
                    const as = persona.aansluiting_schriftlezingen;
                    html += `<div class="hoorder-schrift">`;
                    html += `<div class="hoorder-schrift-titel">Aansluiting bij de Schriftlezingen</div>`;
                    if (as.wat_raakt) {
                        html += `<div class="hoorder-schrift-item"><span class="hoorder-schrift-label">Wat raakt:</span><span class="hoorder-schrift-tekst">${processText(as.wat_raakt)}</span></div>`;
                    }
                    if (as.wat_afstoot) {
                        html += `<div class="hoorder-schrift-item"><span class="hoorder-schrift-label">Wat afstoot:</span><span class="hoorder-schrift-tekst">${processText(as.wat_afstoot)}</span></div>`;
                    }
                    if (as.existentiele_vraag) {
                        html += `<div class="hoorder-vraag">"${processText(as.existentiele_vraag)}"</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div></div>`; // end hoorder-content, hoorder-card
            });

            return html;
        }

        // Render Gebeden section with cleaner layout
        function renderGebedenSection(data) {
            let html = '';

            // Show chosen scenario
            if (data.gekozen_scenario) {
                html += `<div class="data-item"><div class="data-label">Gekozen scenario</div><div class="data-value">${processText(data.gekozen_scenario)}</div></div>`;
            }

            // Render each prayer
            const gebeden = data.gebeden || {};
            const gebedOrder = ['drempelgebed', 'kyrie', 'epiclese', 'dankgebed', 'voorbeden'];
            const gebedTitles = {
                'drempelgebed': 'Drempelgebed',
                'kyrie': 'Kyrie',
                'epiclese': 'Epiclese',
                'dankgebed': 'Dankgebed',
                'voorbeden': 'Voorbeden'
            };

            gebedOrder.forEach(key => {
                const gebed = gebeden[key];
                if (!gebed) return;

                html += `<div id="section-14_gebeden-gebeden-${key}" class="subsection-anchor"></div>`;
                html += `<div class="gebed-card">`;

                // Header with type and aanspraak
                html += `<div class="gebed-card-header">`;
                html += `<span class="gebed-type-badge">${escapeHtml(gebedTitles[key] || key)}</span>`;
                if (gebed.aanspraak) {
                    html += `<span class="gebed-aanspraak">${processText(gebed.aanspraak)}</span>`;
                }
                html += `</div>`;

                // Main prayer text
                if (gebed.tekst) {
                    html += `<div class="gebed-tekst">${processText(gebed.tekst)}</div>`;
                }

                // For voorbeden without main tekst - show cirkels
                if (!gebed.tekst && gebed.cirkels) {
                    html += `<div class="gebed-cirkels">`;
                    const cirkelOrder = ['wereld', 'kerk', 'naasten', 'eigen_gemeente'];
                    const cirkelTitles = {
                        'wereld': 'De wereld',
                        'kerk': 'De kerk',
                        'naasten': 'Onze naasten',
                        'eigen_gemeente': 'Onze gemeente'
                    };

                    cirkelOrder.forEach(cirkelKey => {
                        const cirkel = gebed.cirkels[cirkelKey];
                        if (!cirkel) return;

                        html += `<div class="gebed-cirkel">`;
                        html += `<div class="gebed-cirkel-header">${escapeHtml(cirkelTitles[cirkelKey] || cirkelKey)}</div>`;

                        if (cirkel.themas && Array.isArray(cirkel.themas)) {
                            html += `<div class="gebed-cirkel-themas">`;
                            cirkel.themas.forEach(thema => {
                                html += `<span class="gebed-cirkel-thema">${processText(thema)}</span>`;
                            });
                            html += `</div>`;
                        }

                        if (cirkel.tekst) {
                            html += `<div class="gebed-cirkel-tekst">${processText(cirkel.tekst)}</div>`;
                        }
                        html += `</div>`;
                    });

                    html += `</div>`;
                }

                // Stilte instructie
                if (gebed.stilte_instructie) {
                    html += `<div class="gebed-instructie">${processText(gebed.stilte_instructie)}</div>`;
                }

                // Overgang naar Onze Vader
                if (gebed.overgang_onze_vader) {
                    html += `<div class="gebed-instructie">${processText(gebed.overgang_onze_vader)}</div>`;
                }

                // Onze Vader
                if (gebed.onze_vader) {
                    html += `<div class="gebed-onze-vader">${processText(gebed.onze_vader)}</div>`;
                }

                // Echo schriftlezing
                if (gebed.echo_schriftlezing) {
                    html += `<div class="gebed-echo"><span class="gebed-echo-label">Echo Schriftlezing:</span>${processText(gebed.echo_schriftlezing)}</div>`;
                }

                html += `</div>`; // end gebed-card
            });

            // Poetische technieken
            if (data.poetische_technieken_gebruikt) {
                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Poetische technieken</div>`;
                html += `<div class="gebeden-technieken">`;

                for (const [techniek, items] of Object.entries(data.poetische_technieken_gebruikt)) {
                    if (!Array.isArray(items) || items.length === 0) continue;

                    html += `<div class="gebeden-techniek">`;
                    html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(techniek))}</div>`;
                    html += `<ul class="gebeden-techniek-items">`;
                    items.forEach(item => {
                        html += `<li>${processText(item)}</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div></div>`;
            }

            // Echo techniek samenvatting
            if (data.echo_techniek) {
                html += `<div class="gebeden-meta">`;
                html += `<div class="gebeden-meta-title">Echo-techniek</div>`;

                if (data.echo_techniek.schriftlezing_thema) {
                    html += `<p style="margin-bottom: 15px;"><strong>Schriftlezing thema:</strong> ${processText(data.echo_techniek.schriftlezing_thema)}</p>`;
                }

                if (data.echo_techniek.echo_per_gebed) {
                    html += `<div class="gebeden-technieken">`;
                    for (const [gebedKey, echo] of Object.entries(data.echo_techniek.echo_per_gebed)) {
                        html += `<div class="gebeden-techniek">`;
                        html += `<div class="gebeden-techniek-naam">${escapeHtml(formatKey(gebedKey))}</div>`;
                        html += `<div style="font-size: 0.9em; color: var(--text-secondary);">${processText(echo)}</div>`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                }

                html += `</div>`;
            }

            return html;
        }

        // Render all Bijbelteksten in liturgical order
        function renderBijbeltekstenSection(data) {
            // Get lezingen info to determine reading type and order
            const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen || {};
            const orderKeys = ['eerste_lezing', 'psalm', 'epistel', 'evangelie'];
            const lezingTypes = {
                'eerste_lezing': 'Eerste lezing',
                'psalm': 'Psalm',
                'epistel': 'Epistel',
                'evangelie': 'Evangelie'
            };

            // Build liturgical order array
            const lezingenOrder = [];
            orderKeys.forEach(lezingKey => {
                if (lezingen[lezingKey]) {
                    const lez = lezingen[lezingKey];
                    const boekCode = getBoekCode(lez.boek || lez.referentie);
                    const hoofdstuk = lez.hoofdstuk || lez.nummer;
                    if (boekCode && hoofdstuk) {
                        lezingenOrder.push({ book: boekCode, chapter: hoofdstuk, type: lezingTypes[lezingKey] });
                    }
                }
            });

            // Add alternative readings
            if (lezingen.alternatieve_lezingen && Array.isArray(lezingen.alternatieve_lezingen)) {
                lezingen.alternatieve_lezingen.forEach(alt => {
                    const boekCode = getBoekCode(alt.referentie);
                    const match = alt.referentie?.match(/(\d+)[,:.]/);
                    const hoofdstuk = match ? parseInt(match[1]) : null;
                    if (boekCode && hoofdstuk) {
                        lezingenOrder.push({ book: boekCode, chapter: hoofdstuk, type: 'Alternatieve lezing' });
                    }
                });
            }

            // Collect all perikopen from both translations
            const allPerikopen = [];
            const vertalingen = ['nbv21', 'naardense_bijbel'];

            vertalingen.forEach(vertalingKey => {
                if (data[vertalingKey] && Array.isArray(data[vertalingKey])) {
                    data[vertalingKey].forEach(perikoop => {
                        // Find liturgical order index
                        let orderIndex = lezingenOrder.findIndex(l =>
                            l.book === perikoop.book && l.chapter === perikoop.chapter
                        );
                        if (orderIndex === -1) orderIndex = 999;

                        // Get reading type
                        const lezingInfo = lezingenOrder.find(l =>
                            l.book === perikoop.book && l.chapter === perikoop.chapter
                        );

                        allPerikopen.push({
                            ...perikoop,
                            vertalingKey: vertalingKey,
                            orderIndex: orderIndex,
                            lezingType: lezingInfo?.type || ''
                        });
                    });
                }
            });

            // Sort by liturgical order, then by translation (NBV21 first)
            allPerikopen.sort((a, b) => {
                if (a.orderIndex !== b.orderIndex) return a.orderIndex - b.orderIndex;
                return a.vertalingKey === 'nbv21' ? -1 : 1;
            });

            // Render all perikopen
            const vertalingNamen = {
                'naardense_bijbel': 'NB',
                'nbv21': 'NBV21'
            };

            let html = '';

            allPerikopen.forEach(perikoop => {
                const vertalingTitel = vertalingNamen[perikoop.vertalingKey] || perikoop.vertalingKey;
                const boekNaam = getBijbelboekNaam(perikoop.book);
                const eersteVers = perikoop.verses[0]?.verse || 1;
                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                const verzenRef = eersteVers === laatsteVers ? eersteVers : `${eersteVers}-${laatsteVers}`;

                // Anchor ID matches the submenu navigation
                const anchorId = `section-Bijbelteksten-${perikoop.book}-${perikoop.chapter}-${perikoop.vertalingKey}`;

                html += `<div id="${anchorId}" class="subsection-anchor"></div>`;
                html += `<div class="bijbel-perikoop">`;
                html += `<div class="bijbel-header">`;
                html += `<span class="bijbel-boek-badge">${escapeHtml(vertalingTitel)}</span>`;
                html += `<span class="bijbel-referentie">${escapeHtml(boekNaam)} ${perikoop.chapter}:${verzenRef}</span>`;
                if (perikoop.lezingType) {
                    html += `<span class="bijbel-lezing-type">${escapeHtml(perikoop.lezingType)}</span>`;
                }
                html += `</div>`;

                html += `<div class="bijbel-verzen">`;
                perikoop.verses.forEach(vers => {
                    html += `<div class="bijbel-vers">`;
                    html += `<span class="bijbel-vers-nummer">${vers.verse}</span>`;
                    html += `<span class="bijbel-vers-tekst">${processText(vers.text)}</span>`;
                    html += `</div>`;
                });
                html += `</div>`;

                html += `</div>`; // end bijbel-perikoop
            });

            return html;
        }

        // Helper function to get book code from Dutch name or reference
        function getBoekCode(boekNaam) {
            if (!boekNaam) return null;
            const naam = boekNaam.toLowerCase();

            const mapping = {
                'genesis': 'GEN', 'exodus': 'EXO', 'leviticus': 'LEV', 'numeri': 'NUM', 'deuteronomium': 'DEU',
                'jozua': 'JOS', 'richteren': 'JDG', 'ruth': 'RUT', 'samuel': '1SA', '1 samuel': '1SA', '2 samuel': '2SA',
                'koningen': '1KI', '1 koningen': '1KI', '2 koningen': '2KI',
                'kronieken': '1CH', '1 kronieken': '1CH', '2 kronieken': '2CH',
                'ezra': 'EZR', 'nehemia': 'NEH', 'ester': 'EST', 'job': 'JOB',
                'psalm': 'PSA', 'psalmen': 'PSA', 'spreuken': 'PRO', 'prediker': 'ECC', 'hooglied': 'SNG',
                'jesaja': 'ISA', 'jeremia': 'JER', 'klaagliederen': 'LAM',
                'ezechiel': 'EZK', 'ezekiel': 'EZK', 'daniel': 'DAN', 'daniÃ«l': 'DAN',
                'hosea': 'HOS', 'joel': 'JOL', 'joÃ«l': 'JOL', 'amos': 'AMO', 'obadja': 'OBA',
                'jona': 'JON', 'micha': 'MIC', 'nahum': 'NAM', 'habakuk': 'HAB',
                'sefanja': 'ZEP', 'haggai': 'HAG', 'haggaÃ¯': 'HAG', 'zacharia': 'ZEC', 'maleachi': 'MAL',
                'matteus': 'MAT', 'matteÃ¼s': 'MAT', 'mattheÃ¼s': 'MAT', 'marcus': 'MRK', 'lucas': 'LUK', 'lukas': 'LUK',
                'johannes': 'JHN', 'handelingen': 'ACT',
                'romeinen': 'ROM', 'korintiÃ«rs': '1CO', 'korintiers': '1CO',
                '1 korintiÃ«rs': '1CO', '2 korintiÃ«rs': '2CO', '1 korintiers': '1CO', '2 korintiers': '2CO',
                'galaten': 'GAL', 'efeziÃ«rs': 'EPH', 'efeziers': 'EPH', 'filippenzen': 'PHP',
                'kolossenzen': 'COL', 'tessalonicenzen': '1TH',
                '1 tessalonicenzen': '1TH', '2 tessalonicenzen': '2TH',
                'timoteÃ¼s': '1TI', 'timoteus': '1TI', '1 timoteÃ¼s': '1TI', '2 timoteÃ¼s': '2TI',
                '1 timoteus': '1TI', '2 timoteus': '2TI',
                'titus': 'TIT', 'filemon': 'PHM', 'hebreeÃ«n': 'HEB', 'hebreeen': 'HEB',
                'jakobus': 'JAS', 'petrus': '1PE', '1 petrus': '1PE', '2 petrus': '2PE',
                '1 johannes': '1JN', '2 johannes': '2JN', '3 johannes': '3JN',
                'judas': 'JUD', 'openbaring': 'REV',
                'sirach': 'SIR', 'ecclesiasticus': 'SIR', 'wijsheid': 'WIS', 'tobit': 'TOB',
                'judit': 'JDT', 'baruch': 'BAR', 'makkabeeen': '1MA', 'makkabeeÃ«n': '1MA',
                '1 makkabeeen': '1MA', '2 makkabeeen': '2MA', '1 makkabeeÃ«n': '1MA', '2 makkabeeÃ«n': '2MA'
            };

            // Try direct match
            for (const [key, code] of Object.entries(mapping)) {
                if (naam.includes(key)) {
                    return code;
                }
            }
            return null;
        }

        // Helper function for bible book names (used in nav and rendering)
        function getBijbelboekNaam(code) {
            const boekNamen = {
                'GEN': 'Genesis', 'EXO': 'Exodus', 'LEV': 'Leviticus', 'NUM': 'Numeri', 'DEU': 'Deuteronomium',
                'JOS': 'Jozua', 'JDG': 'Richteren', 'RUT': 'Ruth', '1SA': '1 Samuel', '2SA': '2 Samuel',
                '1KI': '1 Koningen', '2KI': '2 Koningen', '1CH': '1 Kronieken', '2CH': '2 Kronieken',
                'EZR': 'Ezra', 'NEH': 'Nehemia', 'EST': 'Ester', 'JOB': 'Job', 'PSA': 'Psalmen',
                'PRO': 'Spreuken', 'ECC': 'Prediker', 'SNG': 'Hooglied', 'ISA': 'Jesaja', 'JER': 'Jeremia',
                'LAM': 'Klaagliederen', 'EZK': 'Ezechiel', 'DAN': 'Daniel', 'HOS': 'Hosea', 'JOL': 'Joel',
                'AMO': 'Amos', 'OBA': 'Obadja', 'JON': 'Jona', 'MIC': 'Micha', 'NAM': 'Nahum',
                'HAB': 'Habakuk', 'ZEP': 'Sefanja', 'HAG': 'Haggai', 'ZEC': 'Zacharia', 'MAL': 'Maleachi',
                'MAT': 'Matteus', 'MRK': 'Marcus', 'LUK': 'Lucas', 'JHN': 'Johannes', 'ACT': 'Handelingen',
                'ROM': 'Romeinen', '1CO': '1 Korintiers', '2CO': '2 Korintiers', 'GAL': 'Galaten',
                'EPH': 'Efeziers', 'PHP': 'Filippenzen', 'COL': 'Kolossenzen', '1TH': '1 Tessalonicenzen',
                '2TH': '2 Tessalonicenzen', '1TI': '1 Timoteus', '2TI': '2 Timoteus', 'TIT': 'Titus',
                'PHM': 'Filemon', 'HEB': 'Hebreeen', 'JAS': 'Jakobus', '1PE': '1 Petrus', '2PE': '2 Petrus',
                '1JN': '1 Johannes', '2JN': '2 Johannes', '3JN': '3 Johannes', 'JUD': 'Judas', 'REV': 'Openbaring',
                'SIR': 'Sirach', 'WIS': 'Wijsheid', 'TOB': 'Tobit', 'JDT': 'Judit', 'BAR': 'Baruch',
                '1MA': '1 Makkabeeen', '2MA': '2 Makkabeeen'
            };
            return boekNamen[code] || code;
        }

        function renderBijbelteksten(vertalingKey, perikopen) {
            const vertalingNamen = {
                'naardense_bijbel': 'NB',
                'nbv21': 'NBV21'
            };
            const vertalingTitel = vertalingNamen[vertalingKey] || vertalingKey;

            // Get lezingen info to determine reading type
            const lezingen = jsonData['01_zondag_kerkelijk_jaar']?.lezingen || {};
            const lezingTypes = {
                'eerste_lezing': 'Eerste lezing',
                'psalm': 'Psalm',
                'epistel': 'Epistel',
                'evangelie': 'Evangelie'
            };

            // Build lookup: book+chapter -> reading type
            const lezingLookup = {};
            for (const [key, label] of Object.entries(lezingTypes)) {
                if (lezingen[key]) {
                    const lez = lezingen[key];
                    const boekCode = getBoekCode(lez.boek || lez.referentie);
                    const hoofdstuk = lez.hoofdstuk || lez.nummer;
                    if (boekCode && hoofdstuk) {
                        lezingLookup[`${boekCode}-${hoofdstuk}`] = label;
                    }
                }
            }
            // Check alternative readings
            if (lezingen.alternatieve_lezingen && Array.isArray(lezingen.alternatieve_lezingen)) {
                lezingen.alternatieve_lezingen.forEach(alt => {
                    const boekCode = getBoekCode(alt.referentie);
                    // Extract chapter from referentie like "1 Samuel 1,20-22.24-28"
                    const match = alt.referentie?.match(/(\d+)[,:.]/);
                    const hoofdstuk = match ? parseInt(match[1]) : null;
                    if (boekCode && hoofdstuk) {
                        lezingLookup[`${boekCode}-${hoofdstuk}`] = 'Alternatieve lezing';
                    }
                });
            }

            let html = '';

            perikopen.forEach(perikoop => {
                const boekNaam = getBijbelboekNaam(perikoop.book);
                const eersteVers = perikoop.verses[0]?.verse || 1;
                const laatsteVers = perikoop.verses[perikoop.verses.length - 1]?.verse || eersteVers;
                const verzenRef = eersteVers === laatsteVers ? eersteVers : `${eersteVers}-${laatsteVers}`;

                // Determine reading type
                const lezingType = lezingLookup[`${perikoop.book}-${perikoop.chapter}`] || '';

                // Anchor ID matches the submenu navigation: BOOK-CHAPTER-vertaling
                const anchorId = `section-Bijbelteksten-${perikoop.book}-${perikoop.chapter}-${vertalingKey}`;

                html += `<div id="${anchorId}" class="subsection-anchor"></div>`;
                html += `<div class="bijbel-perikoop">`;
                html += `<div class="bijbel-header">`;
                html += `<span class="bijbel-boek-badge">${escapeHtml(vertalingTitel)}</span>`;
                html += `<span class="bijbel-referentie">${escapeHtml(boekNaam)} ${perikoop.chapter}:${verzenRef}</span>`;
                if (lezingType) {
                    html += `<span class="bijbel-lezing-type">${escapeHtml(lezingType)}</span>`;
                }
                html += `</div>`;

                html += `<div class="bijbel-verzen">`;
                perikoop.verses.forEach(vers => {
                    html += `<div class="bijbel-vers">`;
                    html += `<span class="bijbel-vers-nummer">${vers.verse}</span>`;
                    html += `<span class="bijbel-vers-tekst">${processText(vers.text)}</span>`;
                    html += `</div>`;
                });
                html += `</div>`;

                html += `</div>`; // end bijbel-perikoop
            });

            return html;
        }

        function formatKey(key) {
            let result = key
                .replace(/_/g, ' ')
                .replace(/([a-z])([A-Z])/g, '$1 $2')
                .replace(/^./, str => str.toUpperCase());

            // Preserve abbreviations with multiple capitals
            const abbreviations = {
                'Nbv21': 'NBV21',
                'nbv21': 'NBV21',
                'Nbv': 'NBV',
                'nbv': 'NBV',
                ' Ot ': ' OT ',
                ' Nt ': ' NT ',
                ' ot ': ' OT ',
                ' nt ': ' NT ',
                'Pkn': 'PKN',
                'pkn': 'PKN'
            };

            for (const [wrong, correct] of Object.entries(abbreviations)) {
                result = result.replace(new RegExp(wrong, 'gi'), correct);
            }

            // Dutch plural corrections (words ending in vowel + s need apostrophe)
            const pluralCorrections = {
                'themas': 'thema\u2019s',
                'Themas': 'Thema\u2019s',
                'schemas': 'schema\u2019s',
                'Schemas': 'Schema\u2019s',
                'dilemmas': 'dilemma\u2019s',
                'Dilemmas': 'Dilemma\u2019s',
                'traumas': 'trauma\u2019s',
                'Traumas': 'Trauma\u2019s',
                'panoramas': 'panorama\u2019s',
                'Panoramas': 'Panorama\u2019s',
                'milieus': 'milieu\u2019s',
                'Milieus': 'Milieu\u2019s'
            };

            for (const [wrong, correct] of Object.entries(pluralCorrections)) {
                result = result.replace(new RegExp(`\\b${wrong}\\b`, 'g'), correct);
            }

            return result;
        }

        function formatValue(value) {
            if (value === null || value === undefined) return '<em>-</em>';
            if (typeof value === 'boolean') return value ? 'Ja' : 'Nee';
            if (typeof value === 'string') {
                // Check if it's a URL
                if (value.match(/^https?:\/\//)) {
                    return `<a href="${escapeHtml(value)}" target="_blank">${escapeHtml(value)}</a>`;
                }
                return processText(value);
            }
            return processText(String(value));
        }

        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Convert straight quotes to curly quotes
        function smartQuotes(text) {
            if (typeof text !== 'string') return text;
            return text
                // Double quotes
                .replace(/(^|[\s(\[{<])"(\S)/g, '$1\u201c$2')     // Opening double quote after space/start
                .replace(/(\S)"([\s)\]}>,.:;!?]|$)/g, '$1\u201d$2') // Closing double quote before space/end
                .replace(/"/g, '\u201d')                          // Remaining double quotes -> closing

                // Single quotes and apostrophes
                // Dutch contractions first: 's, 't, 'n, 'm (these are apostrophes, not opening quotes)
                .replace(/(^|[\s(\[{<])'([stnmSTNM])\b/g, '$1\u2019$2')
                // Apostrophe within words (don't, it's, etc.)
                .replace(/(\w)'(\w)/g, '$1\u2019$2')
                // Opening single quote after space/start (but not Dutch contractions)
                .replace(/(^|[\s(\[{<])'(\S)/g, '$1\u2018$2')
                // Closing single quote before space/end/punctuation
                .replace(/(\S)'([\s)\]}>,.:;!?]|$)/g, '$1\u2019$2')
                // Remaining single quotes -> apostrophe
                .replace(/'/g, '\u2019');
        }

        // Process text: escape HTML, convert quotes, and handle newlines
        function processText(text) {
            if (typeof text !== 'string') return text;
            // First convert literal \n to actual newlines (before HTML escaping)
            let result = text.replace(/\\n/g, '\n');
            // Escape HTML special characters
            result = escapeHtml(result);
            // Convert **text** to bold (must come before single *)
            result = result.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            // Convert *text* to italic (stage directions, instructions)
            result = result.replace(/\*([^*]+)\*/g, '<em class="instruction">$1</em>');
            // Convert quotes to curly quotes
            result = smartQuotes(result);
            // Convert newlines to <br> tags
            result = result.replace(/\n/g, '<br>');
            return result;
        }

        // Scroll handling
        let ticking = false;
        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    handleScroll();
                    ticking = false;
                });
                ticking = true;
            }
        });

        function handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // Show/hide scroll to top button
            scrollTopBtn.classList.toggle('visible', scrollTop > 300);

            // Update active nav item
            updateActiveNav();
        }

        function updateActiveNav() {
            const sections = document.querySelectorAll('.section');
            let currentSection = '';

            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 150 && rect.bottom > 150) {
                    currentSection = section.id.replace('section-', '');
                }
            });

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === currentSection);
            });
        }

        // Scroll to top
        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Handle resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 900) {
                sidebar.classList.remove('visible');
                sidebar.classList.remove('hidden');
                mainContent.classList.remove('full-width');
                sidebarVisible = true;
            }
        });
    </script>
</body>
</html>
